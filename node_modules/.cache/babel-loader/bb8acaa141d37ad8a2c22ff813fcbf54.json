{"ast":null,"code":"var _jsxFileName = \"D:\\\\Amardeep\\\\tarek_project\\\\ftw-product\\\\src\\\\containers\\\\ListingPage\\\\ListingPageHeroImage.js\";\nimport React, { Component } from 'react';\nimport { array, arrayOf, bool, func, shape, string, oneOf, object } from 'prop-types';\nimport { compose } from 'redux';\nimport { connect } from 'react-redux';\nimport { withRouter } from 'react-router-dom';\nimport config from '../../config';\nimport routeConfiguration from '../../routing/routeConfiguration';\nimport { FormattedMessage, intlShape, injectIntl } from '../../util/reactIntl';\nimport { findOptionsForSelectFilter } from '../../util/search';\nimport { LISTING_STATE_PENDING_APPROVAL, LISTING_STATE_CLOSED, propTypes } from '../../util/types';\nimport { types as sdkTypes } from '../../util/sdkLoader';\nimport { LISTING_PAGE_DRAFT_VARIANT, LISTING_PAGE_PENDING_APPROVAL_VARIANT, LISTING_PAGE_PARAM_TYPE_DRAFT, LISTING_PAGE_PARAM_TYPE_EDIT, createSlug } from '../../util/urlHelpers';\nimport { formatMoney, convertMoneyToNumber } from '../../util/currency';\nimport { createResourceLocatorString, findRouteByRouteName } from '../../util/routes';\nimport { ensureListing, ensureOwnListing, ensureUser, userDisplayNameAsString } from '../../util/data';\nimport { richText } from '../../util/richText';\nimport { getMarketplaceEntities } from '../../ducks/marketplaceData.duck';\nimport { manageDisableScrolling, isScrollingDisabled } from '../../ducks/UI.duck';\nimport { initializeCardPaymentData } from '../../ducks/stripe.duck.js';\nimport { Page, NamedLink, NamedRedirect, LayoutSingleColumn, LayoutWrapperTopbar, LayoutWrapperMain, LayoutWrapperFooter, Footer, OrderPanel } from '../../components';\nimport TopbarContainer from '../../containers/TopbarContainer/TopbarContainer';\nimport NotFoundPage from '../../containers/NotFoundPage/NotFoundPage';\nimport { sendEnquiry, fetchTransactionLineItems, setInitialValues } from './ListingPage.duck';\nimport SectionImages from './SectionImages';\nimport SectionAvatar from './SectionAvatar';\nimport SectionHeading from './SectionHeading';\nimport SectionDescriptionMaybe from './SectionDescriptionMaybe';\nimport SectionDetailsMaybe from './SectionDetailsMaybe';\nimport SectionFeaturesMaybe from './SectionFeaturesMaybe';\nimport SectionReviews from './SectionReviews';\nimport SectionAuthorMaybe from './SectionAuthorMaybe';\nimport SectionRulesMaybe from './SectionRulesMaybe';\nimport SectionMapMaybe from './SectionMapMaybe';\nimport css from './ListingPage.module.css';\nconst MIN_LENGTH_FOR_LONG_WORDS_IN_TITLE = 16;\nconst {\n  UUID\n} = sdkTypes;\n\nconst priceData = (price, intl) => {\n  if (price && price.currency === config.currency) {\n    const formattedPrice = formatMoney(intl, price);\n    return {\n      formattedPrice,\n      priceTitle: formattedPrice\n    };\n  } else if (price) {\n    return {\n      formattedPrice: `(${price.currency})`,\n      priceTitle: `Unsupported currency (${price.currency})`\n    };\n  }\n\n  return {};\n};\n\nconst categoryLabel = (categories, key) => {\n  const cat = categories.find(c => c.key === key);\n  return cat ? cat.label : key;\n};\n\nexport class ListingPageComponent extends Component {\n  constructor(props) {\n    super(props);\n    const {\n      enquiryModalOpenForListingId,\n      params\n    } = props;\n    this.state = {\n      pageClassNames: [],\n      imageCarouselOpen: false,\n      enquiryModalOpen: enquiryModalOpenForListingId === params.id\n    };\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.onContactUser = this.onContactUser.bind(this);\n    this.onSubmitEnquiry = this.onSubmitEnquiry.bind(this);\n  }\n\n  handleSubmit(values) {\n    const {\n      history,\n      getListing,\n      params,\n      callSetInitialValues,\n      onInitializeCardPaymentData\n    } = this.props;\n    const listingId = new UUID(params.id);\n    const listing = getListing(listingId);\n    const {\n      bookingDates,\n      ...otherOrderData\n    } = values;\n    const bookingDatesMaybe = bookingDates ? {\n      bookingDates: {\n        bookingStart: bookingDates.startDate,\n        bookingEnd: bookingDates.endDate\n      }\n    } : {};\n    const initialValues = {\n      listing,\n      orderData: { ...bookingDatesMaybe,\n        ...otherOrderData\n      },\n      confirmPaymentError: null\n    };\n    const saveToSessionStorage = !this.props.currentUser;\n    const routes = routeConfiguration(); // Customize checkout page state with current listing and selected orderData\n\n    const {\n      setInitialValues\n    } = findRouteByRouteName('CheckoutPage', routes);\n    callSetInitialValues(setInitialValues, initialValues, saveToSessionStorage); // Clear previous Stripe errors from store if there is any\n\n    onInitializeCardPaymentData(); // Redirect to CheckoutPage\n\n    history.push(createResourceLocatorString('CheckoutPage', routes, {\n      id: listing.id.uuid,\n      slug: createSlug(listing.attributes.title)\n    }, {}));\n  }\n\n  onContactUser() {\n    const {\n      currentUser,\n      history,\n      callSetInitialValues,\n      params,\n      location\n    } = this.props;\n\n    if (!currentUser) {\n      const state = {\n        from: `${location.pathname}${location.search}${location.hash}`\n      }; // We need to log in before showing the modal, but first we need to ensure\n      // that modal does open when user is redirected back to this listingpage\n\n      callSetInitialValues(setInitialValues, {\n        enquiryModalOpenForListingId: params.id\n      }); // signup and return back to listingPage.\n\n      history.push(createResourceLocatorString('SignupPage', routeConfiguration(), {}, {}), state);\n    } else {\n      this.setState({\n        enquiryModalOpen: true\n      });\n    }\n  }\n\n  onSubmitEnquiry(values) {\n    const {\n      history,\n      params,\n      onSendEnquiry\n    } = this.props;\n    const routes = routeConfiguration();\n    const listingId = new UUID(params.id);\n    const {\n      message\n    } = values;\n    onSendEnquiry(listingId, message.trim()).then(txId => {\n      this.setState({\n        enquiryModalOpen: false\n      }); // Redirect to OrderDetailsPage\n\n      history.push(createResourceLocatorString('OrderDetailsPage', routes, {\n        id: txId.uuid\n      }, {}));\n    }).catch(() => {// Ignore, error handling in duck file\n    });\n  }\n\n  render() {\n    var _currentListing$attri, _currentListing$attri2, _currentListing$curre, _currentListing$curre2;\n\n    const {\n      unitType,\n      isAuthenticated,\n      currentUser,\n      getListing,\n      getOwnListing,\n      intl,\n      onManageDisableScrolling,\n      params: rawParams,\n      location,\n      scrollingDisabled,\n      showListingError,\n      reviews,\n      fetchReviewsError,\n      sendEnquiryInProgress,\n      sendEnquiryError,\n      timeSlots,\n      fetchTimeSlotsError,\n      customConfig,\n      onFetchTransactionLineItems,\n      lineItems,\n      fetchLineItemsInProgress,\n      fetchLineItemsError\n    } = this.props;\n    const listingId = new UUID(rawParams.id);\n    const isPendingApprovalVariant = rawParams.variant === LISTING_PAGE_PENDING_APPROVAL_VARIANT;\n    const isDraftVariant = rawParams.variant === LISTING_PAGE_DRAFT_VARIANT;\n    const currentListing = isPendingApprovalVariant || isDraftVariant ? ensureOwnListing(getOwnListing(listingId)) : ensureListing(getListing(listingId));\n    const listingSlug = rawParams.slug || createSlug(currentListing.attributes.title || '');\n    const params = {\n      slug: listingSlug,\n      ...rawParams\n    };\n    const listingType = isDraftVariant ? LISTING_PAGE_PARAM_TYPE_DRAFT : LISTING_PAGE_PARAM_TYPE_EDIT;\n    const listingTab = isDraftVariant ? 'photos' : 'details';\n    const isApproved = currentListing.id && currentListing.attributes.state !== LISTING_STATE_PENDING_APPROVAL;\n    const pendingIsApproved = isPendingApprovalVariant && isApproved; // If a /pending-approval URL is shared, the UI requires\n    // authentication and attempts to fetch the listing from own\n    // listings. This will fail with 403 Forbidden if the author is\n    // another user. We use this information to try to fetch the\n    // public listing.\n\n    const pendingOtherUsersListing = (isPendingApprovalVariant || isDraftVariant) && showListingError && showListingError.status === 403;\n    const shouldShowPublicListingPage = pendingIsApproved || pendingOtherUsersListing;\n\n    if (shouldShowPublicListingPage) {\n      return /*#__PURE__*/React.createElement(NamedRedirect, {\n        name: \"ListingPage\",\n        params: params,\n        search: location.search,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 14\n        }\n      });\n    }\n\n    const {\n      description = '',\n      geolocation = null,\n      price = null,\n      title = '',\n      publicData\n    } = currentListing.attributes;\n    const richTitle = /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 7\n      }\n    }, richText(title, {\n      longWordMinLength: MIN_LENGTH_FOR_LONG_WORDS_IN_TITLE,\n      longWordClass: css.longWord\n    }));\n    const bookingTitle = /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: \"ListingPage.bookingTitle\",\n      values: {\n        title: richTitle\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 7\n      }\n    });\n    const bookingSubTitle = intl.formatMessage({\n      id: 'ListingPage.bookingSubTitle'\n    });\n    const topbar = /*#__PURE__*/React.createElement(TopbarContainer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 20\n      }\n    });\n\n    if (showListingError && showListingError.status === 404) {\n      // 404 listing not found\n      return /*#__PURE__*/React.createElement(NotFoundPage, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 14\n        }\n      });\n    } else if (showListingError) {\n      // Other error in fetching listing\n      const errorTitle = intl.formatMessage({\n        id: 'ListingPage.errorLoadingListingTitle'\n      });\n      return /*#__PURE__*/React.createElement(Page, {\n        title: errorTitle,\n        scrollingDisabled: scrollingDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(LayoutSingleColumn, {\n        className: css.pageRoot,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(LayoutWrapperTopbar, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 13\n        }\n      }, topbar), /*#__PURE__*/React.createElement(LayoutWrapperMain, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        className: css.errorText,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(FormattedMessage, {\n        id: \"ListingPage.errorLoadingListingMessage\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 17\n        }\n      }))), /*#__PURE__*/React.createElement(LayoutWrapperFooter, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Footer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 15\n        }\n      }))));\n    } else if (!currentListing.id) {\n      // Still loading the listing\n      const loadingTitle = intl.formatMessage({\n        id: 'ListingPage.loadingListingTitle'\n      });\n      return /*#__PURE__*/React.createElement(Page, {\n        title: loadingTitle,\n        scrollingDisabled: scrollingDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(LayoutSingleColumn, {\n        className: css.pageRoot,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(LayoutWrapperTopbar, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 13\n        }\n      }, topbar), /*#__PURE__*/React.createElement(LayoutWrapperMain, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        className: css.loadingText,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(FormattedMessage, {\n        id: \"ListingPage.loadingListingMessage\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 17\n        }\n      }))), /*#__PURE__*/React.createElement(LayoutWrapperFooter, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Footer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 15\n        }\n      }))));\n    }\n\n    const handleViewPhotosClick = e => {\n      // Stop event from bubbling up to prevent image click handler\n      // trying to open the carousel as well.\n      e.stopPropagation();\n      this.setState({\n        imageCarouselOpen: true\n      });\n    };\n\n    const authorAvailable = currentListing && currentListing.author;\n    const userAndListingAuthorAvailable = !!(currentUser && authorAvailable);\n    const isOwnListing = userAndListingAuthorAvailable && currentListing.author.id.uuid === currentUser.id.uuid;\n    const showContactUser = authorAvailable && (!currentUser || currentUser && !isOwnListing);\n    const currentAuthor = authorAvailable ? currentListing.author : null;\n    const ensuredAuthor = ensureUser(currentAuthor); // When user is banned or deleted the listing is also deleted.\n    // Because listing can be never showed with banned or deleted user we don't have to provide\n    // banned or deleted display names for the function\n\n    const authorDisplayName = userDisplayNameAsString(ensuredAuthor, '');\n    const {\n      formattedPrice,\n      priceTitle\n    } = priceData(price, intl);\n\n    const handleOrderSubmit = values => {\n      const isCurrentlyClosed = currentListing.attributes.state === LISTING_STATE_CLOSED;\n\n      if (isOwnListing || isCurrentlyClosed) {\n        window.scrollTo(0, 0);\n      } else {\n        this.handleSubmit(values);\n      }\n    };\n\n    const listingImages = (listing, variantName) => (listing.images || []).map(image => {\n      const variants = image.attributes.variants;\n      const variant = variants ? variants[variantName] : null; // deprecated\n      // for backwards combatility only\n\n      const sizes = image.attributes.sizes;\n      const size = sizes ? sizes.find(i => i.name === variantName) : null;\n      return variant || size;\n    }).filter(variant => variant != null);\n\n    const facebookImages = listingImages(currentListing, 'facebook');\n    const twitterImages = listingImages(currentListing, 'twitter');\n    const schemaImages = listingImages(currentListing, `${config.listing.variantPrefix}-2x`).map(img => img.url);\n    const siteTitle = config.siteTitle;\n    const schemaTitle = intl.formatMessage({\n      id: 'ListingPage.schemaTitle'\n    }, {\n      title,\n      price: formattedPrice,\n      siteTitle\n    }); // You could add reviews, sku, etc. into page schema\n    // Read more about product schema\n    // https://developers.google.com/search/docs/advanced/structured-data/product\n\n    const productURL = `${config.canonicalRootURL}${location.pathname}${location.search}${location.hash}`;\n    const brand = currentListing === null || currentListing === void 0 ? void 0 : (_currentListing$attri = currentListing.attributes) === null || _currentListing$attri === void 0 ? void 0 : (_currentListing$attri2 = _currentListing$attri.publicData) === null || _currentListing$attri2 === void 0 ? void 0 : _currentListing$attri2.brand;\n    const brandMaybe = brand ? {\n      brand: {\n        '@type': 'Brand',\n        name: brand\n      }\n    } : {};\n    const schemaPriceNumber = intl.formatNumber(convertMoneyToNumber(price), {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2\n    });\n    const currentStock = ((_currentListing$curre = currentListing.currentStock) === null || _currentListing$curre === void 0 ? void 0 : (_currentListing$curre2 = _currentListing$curre.attributes) === null || _currentListing$curre2 === void 0 ? void 0 : _currentListing$curre2.quantity) || 0;\n    const schemaAvailability = currentStock > 0 ? 'https://schema.org/InStock' : 'https://schema.org/OutOfStock';\n    const authorLink = /*#__PURE__*/React.createElement(NamedLink, {\n      className: css.authorNameLink,\n      name: \"ListingPage\",\n      params: params,\n      to: {\n        hash: '#author'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 7\n      }\n    }, authorDisplayName);\n    const amenityOptions = findOptionsForSelectFilter('amenities', customConfig.filters);\n    const categoryOptions = findOptionsForSelectFilter('category', customConfig.filters);\n    const category = publicData && publicData.category ? /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 409,\n        columnNumber: 9\n      }\n    }, categoryLabel(categoryOptions, publicData.category), /*#__PURE__*/React.createElement(\"span\", {\n      className: css.separator,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 11\n      }\n    }, \"\\u2022\")) : null;\n    return /*#__PURE__*/React.createElement(Page, {\n      title: schemaTitle,\n      scrollingDisabled: scrollingDisabled,\n      author: authorDisplayName,\n      contentType: \"website\",\n      description: description,\n      facebookImages: facebookImages,\n      twitterImages: twitterImages,\n      schema: {\n        '@context': 'http://schema.org',\n        '@type': 'Product',\n        description: description,\n        name: schemaTitle,\n        image: schemaImages,\n        ...brandMaybe,\n        offers: {\n          '@type': 'Offer',\n          url: productURL,\n          priceCurrency: price.currency,\n          price: schemaPriceNumber,\n          availability: schemaAvailability\n        }\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 416,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(LayoutSingleColumn, {\n      className: css.pageRoot,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 440,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(LayoutWrapperTopbar, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 441,\n        columnNumber: 11\n      }\n    }, topbar), /*#__PURE__*/React.createElement(LayoutWrapperMain, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 442,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 443,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(SectionImages, {\n      title: title,\n      listing: currentListing,\n      isOwnListing: isOwnListing,\n      editParams: {\n        id: listingId.uuid,\n        slug: listingSlug,\n        type: listingType,\n        tab: listingTab\n      },\n      imageCarouselOpen: this.state.imageCarouselOpen,\n      onImageCarouselClose: () => this.setState({\n        imageCarouselOpen: false\n      }),\n      handleViewPhotosClick: handleViewPhotosClick,\n      onManageDisableScrolling: onManageDisableScrolling,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 444,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: css.contentWrapperForHeroLayout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 459,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(SectionAvatar, {\n      user: currentAuthor,\n      params: params,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 460,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: css.mainColumnForHeroLayout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(SectionHeading, {\n      priceTitle: priceTitle,\n      formattedPrice: formattedPrice,\n      richTitle: richTitle,\n      category: category,\n      authorLink: authorLink,\n      showContactUser: showContactUser,\n      onContactUser: this.onContactUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 462,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(SectionDescriptionMaybe, {\n      description: description,\n      listingTitle: richTitle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(SectionDetailsMaybe, {\n      publicData: publicData,\n      customConfig: customConfig,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 472,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(SectionFeaturesMaybe, {\n      extendedDataKey: \"amenities\",\n      options: amenityOptions,\n      publicData: publicData,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 473,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(SectionRulesMaybe, {\n      publicData: publicData,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 478,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(SectionMapMaybe, {\n      geolocation: geolocation,\n      publicData: publicData,\n      listingId: currentListing.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 479,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(SectionReviews, {\n      reviews: reviews,\n      fetchReviewsError: fetchReviewsError,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(SectionAuthorMaybe, {\n      title: title,\n      listing: currentListing,\n      authorDisplayName: authorDisplayName,\n      onContactUser: this.onContactUser,\n      isEnquiryModalOpen: isAuthenticated && this.state.enquiryModalOpen,\n      onCloseEnquiryModal: () => this.setState({\n        enquiryModalOpen: false\n      }),\n      sendEnquiryError: sendEnquiryError,\n      sendEnquiryInProgress: sendEnquiryInProgress,\n      onSubmitEnquiry: this.onSubmitEnquiry,\n      currentUser: currentUser,\n      onManageDisableScrolling: onManageDisableScrolling,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 485,\n        columnNumber: 19\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: css.orderColumnForHeroLayout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 499,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(OrderPanel, {\n      className: css.orderPanel,\n      listing: currentListing,\n      isOwnListing: isOwnListing,\n      unitType: unitType,\n      onSubmit: handleOrderSubmit,\n      title: bookingTitle,\n      subTitle: bookingSubTitle,\n      authorDisplayName: authorDisplayName,\n      onManageDisableScrolling: onManageDisableScrolling,\n      timeSlots: timeSlots,\n      fetchTimeSlotsError: fetchTimeSlotsError,\n      onFetchTransactionLineItems: onFetchTransactionLineItems,\n      onContactUser: this.onContactUser,\n      lineItems: lineItems,\n      fetchLineItemsInProgress: fetchLineItemsInProgress,\n      fetchLineItemsError: fetchLineItemsError,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 500,\n        columnNumber: 19\n      }\n    }))))), /*#__PURE__*/React.createElement(LayoutWrapperFooter, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 522,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Footer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 523,\n        columnNumber: 13\n      }\n    }))));\n  }\n\n}\nListingPageComponent.defaultProps = {\n  unitType: config.lineItemUnitType,\n  currentUser: null,\n  enquiryModalOpenForListingId: null,\n  showListingError: null,\n  reviews: [],\n  fetchReviewsError: null,\n  timeSlots: null,\n  fetchTimeSlotsError: null,\n  sendEnquiryError: null,\n  customConfig: config.custom,\n  lineItems: null,\n  fetchLineItemsError: null\n};\nListingPageComponent.propTypes = {\n  // from withRouter\n  history: shape({\n    push: func.isRequired\n  }).isRequired,\n  location: shape({\n    search: string\n  }).isRequired,\n  unitType: propTypes.lineItemUnitType,\n  // from injectIntl\n  intl: intlShape.isRequired,\n  params: shape({\n    id: string.isRequired,\n    slug: string,\n    variant: oneOf([LISTING_PAGE_DRAFT_VARIANT, LISTING_PAGE_PENDING_APPROVAL_VARIANT])\n  }).isRequired,\n  isAuthenticated: bool.isRequired,\n  currentUser: propTypes.currentUser,\n  getListing: func.isRequired,\n  getOwnListing: func.isRequired,\n  onManageDisableScrolling: func.isRequired,\n  scrollingDisabled: bool.isRequired,\n  enquiryModalOpenForListingId: string,\n  showListingError: propTypes.error,\n  callSetInitialValues: func.isRequired,\n  reviews: arrayOf(propTypes.review),\n  fetchReviewsError: propTypes.error,\n  timeSlots: arrayOf(propTypes.timeSlot),\n  fetchTimeSlotsError: propTypes.error,\n  sendEnquiryInProgress: bool.isRequired,\n  sendEnquiryError: propTypes.error,\n  onSendEnquiry: func.isRequired,\n  onInitializeCardPaymentData: func.isRequired,\n  customConfig: object,\n  onFetchTransactionLineItems: func.isRequired,\n  lineItems: array,\n  fetchLineItemsInProgress: bool.isRequired,\n  fetchLineItemsError: propTypes.error\n};\n\nconst mapStateToProps = state => {\n  const {\n    isAuthenticated\n  } = state.Auth;\n  const {\n    showListingError,\n    reviews,\n    fetchReviewsError,\n    timeSlots,\n    fetchTimeSlotsError,\n    sendEnquiryInProgress,\n    sendEnquiryError,\n    lineItems,\n    fetchLineItemsInProgress,\n    fetchLineItemsError,\n    enquiryModalOpenForListingId\n  } = state.ListingPage;\n  const {\n    currentUser\n  } = state.user;\n\n  const getListing = id => {\n    const ref = {\n      id,\n      type: 'listing'\n    };\n    const listings = getMarketplaceEntities(state, [ref]);\n    return listings.length === 1 ? listings[0] : null;\n  };\n\n  const getOwnListing = id => {\n    const ref = {\n      id,\n      type: 'ownListing'\n    };\n    const listings = getMarketplaceEntities(state, [ref]);\n    return listings.length === 1 ? listings[0] : null;\n  };\n\n  return {\n    isAuthenticated,\n    currentUser,\n    getListing,\n    getOwnListing,\n    scrollingDisabled: isScrollingDisabled(state),\n    enquiryModalOpenForListingId,\n    showListingError,\n    reviews,\n    fetchReviewsError,\n    timeSlots,\n    fetchTimeSlotsError,\n    lineItems,\n    fetchLineItemsInProgress,\n    fetchLineItemsError,\n    sendEnquiryInProgress,\n    sendEnquiryError\n  };\n};\n\nconst mapDispatchToProps = dispatch => ({\n  onManageDisableScrolling: (componentId, disableScrolling) => dispatch(manageDisableScrolling(componentId, disableScrolling)),\n  callSetInitialValues: (setInitialValues, values, saveToSessionStorage) => dispatch(setInitialValues(values, saveToSessionStorage)),\n  onFetchTransactionLineItems: (orderData, listingId, isOwnListing) => dispatch(fetchTransactionLineItems(orderData, listingId, isOwnListing)),\n  onSendEnquiry: (listingId, message) => dispatch(sendEnquiry(listingId, message)),\n  onInitializeCardPaymentData: () => dispatch(initializeCardPaymentData())\n}); // Note: it is important that the withRouter HOC is **outside** the\n// connect HOC, otherwise React Router won't rerender any Route\n// components since connect implements a shouldComponentUpdate\n// lifecycle hook.\n//\n// See: https://github.com/ReactTraining/react-router/issues/4671\n\n\nconst ListingPage = compose(withRouter, connect(mapStateToProps, mapDispatchToProps), injectIntl)(ListingPageComponent);\nexport default ListingPage;","map":{"version":3,"sources":["D:/Amardeep/tarek_project/ftw-product/src/containers/ListingPage/ListingPageHeroImage.js"],"names":["React","Component","array","arrayOf","bool","func","shape","string","oneOf","object","compose","connect","withRouter","config","routeConfiguration","FormattedMessage","intlShape","injectIntl","findOptionsForSelectFilter","LISTING_STATE_PENDING_APPROVAL","LISTING_STATE_CLOSED","propTypes","types","sdkTypes","LISTING_PAGE_DRAFT_VARIANT","LISTING_PAGE_PENDING_APPROVAL_VARIANT","LISTING_PAGE_PARAM_TYPE_DRAFT","LISTING_PAGE_PARAM_TYPE_EDIT","createSlug","formatMoney","convertMoneyToNumber","createResourceLocatorString","findRouteByRouteName","ensureListing","ensureOwnListing","ensureUser","userDisplayNameAsString","richText","getMarketplaceEntities","manageDisableScrolling","isScrollingDisabled","initializeCardPaymentData","Page","NamedLink","NamedRedirect","LayoutSingleColumn","LayoutWrapperTopbar","LayoutWrapperMain","LayoutWrapperFooter","Footer","OrderPanel","TopbarContainer","NotFoundPage","sendEnquiry","fetchTransactionLineItems","setInitialValues","SectionImages","SectionAvatar","SectionHeading","SectionDescriptionMaybe","SectionDetailsMaybe","SectionFeaturesMaybe","SectionReviews","SectionAuthorMaybe","SectionRulesMaybe","SectionMapMaybe","css","MIN_LENGTH_FOR_LONG_WORDS_IN_TITLE","UUID","priceData","price","intl","currency","formattedPrice","priceTitle","categoryLabel","categories","key","cat","find","c","label","ListingPageComponent","constructor","props","enquiryModalOpenForListingId","params","state","pageClassNames","imageCarouselOpen","enquiryModalOpen","id","handleSubmit","bind","onContactUser","onSubmitEnquiry","values","history","getListing","callSetInitialValues","onInitializeCardPaymentData","listingId","listing","bookingDates","otherOrderData","bookingDatesMaybe","bookingStart","startDate","bookingEnd","endDate","initialValues","orderData","confirmPaymentError","saveToSessionStorage","currentUser","routes","push","uuid","slug","attributes","title","location","from","pathname","search","hash","setState","onSendEnquiry","message","trim","then","txId","catch","render","unitType","isAuthenticated","getOwnListing","onManageDisableScrolling","rawParams","scrollingDisabled","showListingError","reviews","fetchReviewsError","sendEnquiryInProgress","sendEnquiryError","timeSlots","fetchTimeSlotsError","customConfig","onFetchTransactionLineItems","lineItems","fetchLineItemsInProgress","fetchLineItemsError","isPendingApprovalVariant","variant","isDraftVariant","currentListing","listingSlug","listingType","listingTab","isApproved","pendingIsApproved","pendingOtherUsersListing","status","shouldShowPublicListingPage","description","geolocation","publicData","richTitle","longWordMinLength","longWordClass","longWord","bookingTitle","bookingSubTitle","formatMessage","topbar","errorTitle","pageRoot","errorText","loadingTitle","loadingText","handleViewPhotosClick","e","stopPropagation","authorAvailable","author","userAndListingAuthorAvailable","isOwnListing","showContactUser","currentAuthor","ensuredAuthor","authorDisplayName","handleOrderSubmit","isCurrentlyClosed","window","scrollTo","listingImages","variantName","images","map","image","variants","sizes","size","i","name","filter","facebookImages","twitterImages","schemaImages","variantPrefix","img","url","siteTitle","schemaTitle","productURL","canonicalRootURL","brand","brandMaybe","schemaPriceNumber","formatNumber","minimumFractionDigits","maximumFractionDigits","currentStock","quantity","schemaAvailability","authorLink","authorNameLink","amenityOptions","filters","categoryOptions","category","separator","offers","priceCurrency","availability","type","tab","contentWrapperForHeroLayout","mainColumnForHeroLayout","orderColumnForHeroLayout","orderPanel","defaultProps","lineItemUnitType","custom","isRequired","error","review","timeSlot","mapStateToProps","Auth","ListingPage","user","ref","listings","length","mapDispatchToProps","dispatch","componentId","disableScrolling"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,KAAT,EAAgBC,OAAhB,EAAyBC,IAAzB,EAA+BC,IAA/B,EAAqCC,KAArC,EAA4CC,MAA5C,EAAoDC,KAApD,EAA2DC,MAA3D,QAAyE,YAAzE;AACA,SAASC,OAAT,QAAwB,OAAxB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AAEA,OAAOC,MAAP,MAAmB,cAAnB;AACA,OAAOC,kBAAP,MAA+B,kCAA/B;AACA,SAASC,gBAAT,EAA2BC,SAA3B,EAAsCC,UAAtC,QAAwD,sBAAxD;AACA,SAASC,0BAAT,QAA2C,mBAA3C;AACA,SAASC,8BAAT,EAAyCC,oBAAzC,EAA+DC,SAA/D,QAAgF,kBAAhF;AACA,SAASC,KAAK,IAAIC,QAAlB,QAAkC,sBAAlC;AACA,SACEC,0BADF,EAEEC,qCAFF,EAGEC,6BAHF,EAIEC,4BAJF,EAKEC,UALF,QAMO,uBANP;AAOA,SAASC,WAAT,EAAsBC,oBAAtB,QAAkD,qBAAlD;AACA,SAASC,2BAAT,EAAsCC,oBAAtC,QAAkE,mBAAlE;AACA,SACEC,aADF,EAEEC,gBAFF,EAGEC,UAHF,EAIEC,uBAJF,QAKO,iBALP;AAMA,SAASC,QAAT,QAAyB,qBAAzB;AACA,SAASC,sBAAT,QAAuC,kCAAvC;AACA,SAASC,sBAAT,EAAiCC,mBAAjC,QAA4D,qBAA5D;AACA,SAASC,yBAAT,QAA0C,4BAA1C;AAEA,SACEC,IADF,EAEEC,SAFF,EAGEC,aAHF,EAIEC,kBAJF,EAKEC,mBALF,EAMEC,iBANF,EAOEC,mBAPF,EAQEC,MARF,EASEC,UATF,QAUO,kBAVP;AAWA,OAAOC,eAAP,MAA4B,kDAA5B;AACA,OAAOC,YAAP,MAAyB,4CAAzB;AAEA,SAASC,WAAT,EAAsBC,yBAAtB,EAAiDC,gBAAjD,QAAyE,oBAAzE;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,uBAAP,MAAoC,2BAApC;AACA,OAAOC,mBAAP,MAAgC,uBAAhC;AACA,OAAOC,oBAAP,MAAiC,wBAAjC;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,kBAAP,MAA+B,sBAA/B;AACA,OAAOC,iBAAP,MAA8B,qBAA9B;AACA,OAAOC,eAAP,MAA4B,mBAA5B;AACA,OAAOC,GAAP,MAAgB,0BAAhB;AAEA,MAAMC,kCAAkC,GAAG,EAA3C;AAEA,MAAM;AAAEC,EAAAA;AAAF,IAAW7C,QAAjB;;AAEA,MAAM8C,SAAS,GAAG,CAACC,KAAD,EAAQC,IAAR,KAAiB;AACjC,MAAID,KAAK,IAAIA,KAAK,CAACE,QAAN,KAAmB3D,MAAM,CAAC2D,QAAvC,EAAiD;AAC/C,UAAMC,cAAc,GAAG5C,WAAW,CAAC0C,IAAD,EAAOD,KAAP,CAAlC;AACA,WAAO;AAAEG,MAAAA,cAAF;AAAkBC,MAAAA,UAAU,EAAED;AAA9B,KAAP;AACD,GAHD,MAGO,IAAIH,KAAJ,EAAW;AAChB,WAAO;AACLG,MAAAA,cAAc,EAAG,IAAGH,KAAK,CAACE,QAAS,GAD9B;AAELE,MAAAA,UAAU,EAAG,yBAAwBJ,KAAK,CAACE,QAAS;AAF/C,KAAP;AAID;;AACD,SAAO,EAAP;AACD,CAXD;;AAaA,MAAMG,aAAa,GAAG,CAACC,UAAD,EAAaC,GAAb,KAAqB;AACzC,QAAMC,GAAG,GAAGF,UAAU,CAACG,IAAX,CAAgBC,CAAC,IAAIA,CAAC,CAACH,GAAF,KAAUA,GAA/B,CAAZ;AACA,SAAOC,GAAG,GAAGA,GAAG,CAACG,KAAP,GAAeJ,GAAzB;AACD,CAHD;;AAKA,OAAO,MAAMK,oBAAN,SAAmCjF,SAAnC,CAA6C;AAClDkF,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,UAAM;AAAEC,MAAAA,4BAAF;AAAgCC,MAAAA;AAAhC,QAA2CF,KAAjD;AACA,SAAKG,KAAL,GAAa;AACXC,MAAAA,cAAc,EAAE,EADL;AAEXC,MAAAA,iBAAiB,EAAE,KAFR;AAGXC,MAAAA,gBAAgB,EAAEL,4BAA4B,KAAKC,MAAM,CAACK;AAH/C,KAAb;AAMA,SAAKC,YAAL,GAAoB,KAAKA,YAAL,CAAkBC,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKC,aAAL,GAAqB,KAAKA,aAAL,CAAmBD,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKE,eAAL,GAAuB,KAAKA,eAAL,CAAqBF,IAArB,CAA0B,IAA1B,CAAvB;AACD;;AAEDD,EAAAA,YAAY,CAACI,MAAD,EAAS;AACnB,UAAM;AACJC,MAAAA,OADI;AAEJC,MAAAA,UAFI;AAGJZ,MAAAA,MAHI;AAIJa,MAAAA,oBAJI;AAKJC,MAAAA;AALI,QAMF,KAAKhB,KANT;AAOA,UAAMiB,SAAS,GAAG,IAAIjC,IAAJ,CAASkB,MAAM,CAACK,EAAhB,CAAlB;AACA,UAAMW,OAAO,GAAGJ,UAAU,CAACG,SAAD,CAA1B;AAEA,UAAM;AAAEE,MAAAA,YAAF;AAAgB,SAAGC;AAAnB,QAAsCR,MAA5C;AACA,UAAMS,iBAAiB,GAAGF,YAAY,GAClC;AACEA,MAAAA,YAAY,EAAE;AACZG,QAAAA,YAAY,EAAEH,YAAY,CAACI,SADf;AAEZC,QAAAA,UAAU,EAAEL,YAAY,CAACM;AAFb;AADhB,KADkC,GAOlC,EAPJ;AASA,UAAMC,aAAa,GAAG;AACpBR,MAAAA,OADoB;AAEpBS,MAAAA,SAAS,EAAE,EACT,GAAGN,iBADM;AAET,WAAGD;AAFM,OAFS;AAMpBQ,MAAAA,mBAAmB,EAAE;AAND,KAAtB;AASA,UAAMC,oBAAoB,GAAG,CAAC,KAAK7B,KAAL,CAAW8B,WAAzC;AAEA,UAAMC,MAAM,GAAGrG,kBAAkB,EAAjC,CAhCmB,CAiCnB;;AACA,UAAM;AAAEyC,MAAAA;AAAF,QAAuBvB,oBAAoB,CAAC,cAAD,EAAiBmF,MAAjB,CAAjD;AAEAhB,IAAAA,oBAAoB,CAAC5C,gBAAD,EAAmBuD,aAAnB,EAAkCG,oBAAlC,CAApB,CApCmB,CAsCnB;;AACAb,IAAAA,2BAA2B,GAvCR,CAyCnB;;AACAH,IAAAA,OAAO,CAACmB,IAAR,CACErF,2BAA2B,CACzB,cADyB,EAEzBoF,MAFyB,EAGzB;AAAExB,MAAAA,EAAE,EAAEW,OAAO,CAACX,EAAR,CAAW0B,IAAjB;AAAuBC,MAAAA,IAAI,EAAE1F,UAAU,CAAC0E,OAAO,CAACiB,UAAR,CAAmBC,KAApB;AAAvC,KAHyB,EAIzB,EAJyB,CAD7B;AAQD;;AAED1B,EAAAA,aAAa,GAAG;AACd,UAAM;AAAEoB,MAAAA,WAAF;AAAejB,MAAAA,OAAf;AAAwBE,MAAAA,oBAAxB;AAA8Cb,MAAAA,MAA9C;AAAsDmC,MAAAA;AAAtD,QAAmE,KAAKrC,KAA9E;;AAEA,QAAI,CAAC8B,WAAL,EAAkB;AAChB,YAAM3B,KAAK,GAAG;AAAEmC,QAAAA,IAAI,EAAG,GAAED,QAAQ,CAACE,QAAS,GAAEF,QAAQ,CAACG,MAAO,GAAEH,QAAQ,CAACI,IAAK;AAA/D,OAAd,CADgB,CAGhB;AACA;;AACA1B,MAAAA,oBAAoB,CAAC5C,gBAAD,EAAmB;AAAE8B,QAAAA,4BAA4B,EAAEC,MAAM,CAACK;AAAvC,OAAnB,CAApB,CALgB,CAOhB;;AACAM,MAAAA,OAAO,CAACmB,IAAR,CAAarF,2BAA2B,CAAC,YAAD,EAAejB,kBAAkB,EAAjC,EAAqC,EAArC,EAAyC,EAAzC,CAAxC,EAAsFyE,KAAtF;AACD,KATD,MASO;AACL,WAAKuC,QAAL,CAAc;AAAEpC,QAAAA,gBAAgB,EAAE;AAApB,OAAd;AACD;AACF;;AAEDK,EAAAA,eAAe,CAACC,MAAD,EAAS;AACtB,UAAM;AAAEC,MAAAA,OAAF;AAAWX,MAAAA,MAAX;AAAmByC,MAAAA;AAAnB,QAAqC,KAAK3C,KAAhD;AACA,UAAM+B,MAAM,GAAGrG,kBAAkB,EAAjC;AACA,UAAMuF,SAAS,GAAG,IAAIjC,IAAJ,CAASkB,MAAM,CAACK,EAAhB,CAAlB;AACA,UAAM;AAAEqC,MAAAA;AAAF,QAAchC,MAApB;AAEA+B,IAAAA,aAAa,CAAC1B,SAAD,EAAY2B,OAAO,CAACC,IAAR,EAAZ,CAAb,CACGC,IADH,CACQC,IAAI,IAAI;AACZ,WAAKL,QAAL,CAAc;AAAEpC,QAAAA,gBAAgB,EAAE;AAApB,OAAd,EADY,CAGZ;;AACAO,MAAAA,OAAO,CAACmB,IAAR,CACErF,2BAA2B,CAAC,kBAAD,EAAqBoF,MAArB,EAA6B;AAAExB,QAAAA,EAAE,EAAEwC,IAAI,CAACd;AAAX,OAA7B,EAAgD,EAAhD,CAD7B;AAGD,KARH,EASGe,KATH,CASS,MAAM,CACX;AACD,KAXH;AAYD;;AAEDC,EAAAA,MAAM,GAAG;AAAA;;AACP,UAAM;AACJC,MAAAA,QADI;AAEJC,MAAAA,eAFI;AAGJrB,MAAAA,WAHI;AAIJhB,MAAAA,UAJI;AAKJsC,MAAAA,aALI;AAMJjE,MAAAA,IANI;AAOJkE,MAAAA,wBAPI;AAQJnD,MAAAA,MAAM,EAAEoD,SARJ;AASJjB,MAAAA,QATI;AAUJkB,MAAAA,iBAVI;AAWJC,MAAAA,gBAXI;AAYJC,MAAAA,OAZI;AAaJC,MAAAA,iBAbI;AAcJC,MAAAA,qBAdI;AAeJC,MAAAA,gBAfI;AAgBJC,MAAAA,SAhBI;AAiBJC,MAAAA,mBAjBI;AAkBJC,MAAAA,YAlBI;AAmBJC,MAAAA,2BAnBI;AAoBJC,MAAAA,SApBI;AAqBJC,MAAAA,wBArBI;AAsBJC,MAAAA;AAtBI,QAuBF,KAAKnE,KAvBT;AAyBA,UAAMiB,SAAS,GAAG,IAAIjC,IAAJ,CAASsE,SAAS,CAAC/C,EAAnB,CAAlB;AACA,UAAM6D,wBAAwB,GAAGd,SAAS,CAACe,OAAV,KAAsBhI,qCAAvD;AACA,UAAMiI,cAAc,GAAGhB,SAAS,CAACe,OAAV,KAAsBjI,0BAA7C;AACA,UAAMmI,cAAc,GAClBH,wBAAwB,IAAIE,cAA5B,GACIxH,gBAAgB,CAACsG,aAAa,CAACnC,SAAD,CAAd,CADpB,GAEIpE,aAAa,CAACiE,UAAU,CAACG,SAAD,CAAX,CAHnB;AAKA,UAAMuD,WAAW,GAAGlB,SAAS,CAACpB,IAAV,IAAkB1F,UAAU,CAAC+H,cAAc,CAACpC,UAAf,CAA0BC,KAA1B,IAAmC,EAApC,CAAhD;AACA,UAAMlC,MAAM,GAAG;AAAEgC,MAAAA,IAAI,EAAEsC,WAAR;AAAqB,SAAGlB;AAAxB,KAAf;AAEA,UAAMmB,WAAW,GAAGH,cAAc,GAC9BhI,6BAD8B,GAE9BC,4BAFJ;AAGA,UAAMmI,UAAU,GAAGJ,cAAc,GAAG,QAAH,GAAc,SAA/C;AAEA,UAAMK,UAAU,GACdJ,cAAc,CAAChE,EAAf,IAAqBgE,cAAc,CAACpC,UAAf,CAA0BhC,KAA1B,KAAoCpE,8BAD3D;AAGA,UAAM6I,iBAAiB,GAAGR,wBAAwB,IAAIO,UAAtD,CA7CO,CA+CP;AACA;AACA;AACA;AACA;;AACA,UAAME,wBAAwB,GAC5B,CAACT,wBAAwB,IAAIE,cAA7B,KACAd,gBADA,IAEAA,gBAAgB,CAACsB,MAAjB,KAA4B,GAH9B;AAIA,UAAMC,2BAA2B,GAAGH,iBAAiB,IAAIC,wBAAzD;;AAEA,QAAIE,2BAAJ,EAAiC;AAC/B,0BAAO,oBAAC,aAAD;AAAe,QAAA,IAAI,EAAC,aAApB;AAAkC,QAAA,MAAM,EAAE7E,MAA1C;AAAkD,QAAA,MAAM,EAAEmC,QAAQ,CAACG,MAAnE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AACD;;AAED,UAAM;AACJwC,MAAAA,WAAW,GAAG,EADV;AAEJC,MAAAA,WAAW,GAAG,IAFV;AAGJ/F,MAAAA,KAAK,GAAG,IAHJ;AAIJkD,MAAAA,KAAK,GAAG,EAJJ;AAKJ8C,MAAAA;AALI,QAMFX,cAAc,CAACpC,UANnB;AAQA,UAAMgD,SAAS,gBACb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGlI,QAAQ,CAACmF,KAAD,EAAQ;AACfgD,MAAAA,iBAAiB,EAAErG,kCADJ;AAEfsG,MAAAA,aAAa,EAAEvG,GAAG,CAACwG;AAFJ,KAAR,CADX,CADF;AASA,UAAMC,YAAY,gBAChB,oBAAC,gBAAD;AAAkB,MAAA,EAAE,EAAC,0BAArB;AAAgD,MAAA,MAAM,EAAE;AAAEnD,QAAAA,KAAK,EAAE+C;AAAT,OAAxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF;AAGA,UAAMK,eAAe,GAAGrG,IAAI,CAACsG,aAAL,CAAmB;AAAElF,MAAAA,EAAE,EAAE;AAAN,KAAnB,CAAxB;AAEA,UAAMmF,MAAM,gBAAG,oBAAC,eAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAf;;AAEA,QAAIlC,gBAAgB,IAAIA,gBAAgB,CAACsB,MAAjB,KAA4B,GAApD,EAAyD;AACvD;AAEA,0BAAO,oBAAC,YAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AACD,KAJD,MAIO,IAAItB,gBAAJ,EAAsB;AAC3B;AAEA,YAAMmC,UAAU,GAAGxG,IAAI,CAACsG,aAAL,CAAmB;AACpClF,QAAAA,EAAE,EAAE;AADgC,OAAnB,CAAnB;AAIA,0BACE,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAEoF,UAAb;AAAyB,QAAA,iBAAiB,EAAEpC,iBAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,kBAAD;AAAoB,QAAA,SAAS,EAAEzE,GAAG,CAAC8G,QAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAsBF,MAAtB,CADF,eAEE,oBAAC,iBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAG,QAAA,SAAS,EAAE5G,GAAG,CAAC+G,SAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,gBAAD;AAAkB,QAAA,EAAE,EAAC,wCAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CADF,CAFF,eAOE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAPF,CADF,CADF;AAeD,KAtBM,MAsBA,IAAI,CAACtB,cAAc,CAAChE,EAApB,EAAwB;AAC7B;AAEA,YAAMuF,YAAY,GAAG3G,IAAI,CAACsG,aAAL,CAAmB;AACtClF,QAAAA,EAAE,EAAE;AADkC,OAAnB,CAArB;AAIA,0BACE,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAEuF,YAAb;AAA2B,QAAA,iBAAiB,EAAEvC,iBAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,kBAAD;AAAoB,QAAA,SAAS,EAAEzE,GAAG,CAAC8G,QAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAsBF,MAAtB,CADF,eAEE,oBAAC,iBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAG,QAAA,SAAS,EAAE5G,GAAG,CAACiH,WAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,gBAAD;AAAkB,QAAA,EAAE,EAAC,mCAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CADF,CAFF,eAOE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAPF,CADF,CADF;AAeD;;AAED,UAAMC,qBAAqB,GAAGC,CAAC,IAAI;AACjC;AACA;AACAA,MAAAA,CAAC,CAACC,eAAF;AACA,WAAKxD,QAAL,CAAc;AACZrC,QAAAA,iBAAiB,EAAE;AADP,OAAd;AAGD,KAPD;;AAQA,UAAM8F,eAAe,GAAG5B,cAAc,IAAIA,cAAc,CAAC6B,MAAzD;AACA,UAAMC,6BAA6B,GAAG,CAAC,EAAEvE,WAAW,IAAIqE,eAAjB,CAAvC;AACA,UAAMG,YAAY,GAChBD,6BAA6B,IAAI9B,cAAc,CAAC6B,MAAf,CAAsB7F,EAAtB,CAAyB0B,IAAzB,KAAkCH,WAAW,CAACvB,EAAZ,CAAe0B,IADpF;AAEA,UAAMsE,eAAe,GAAGJ,eAAe,KAAK,CAACrE,WAAD,IAAiBA,WAAW,IAAI,CAACwE,YAAtC,CAAvC;AAEA,UAAME,aAAa,GAAGL,eAAe,GAAG5B,cAAc,CAAC6B,MAAlB,GAA2B,IAAhE;AACA,UAAMK,aAAa,GAAG1J,UAAU,CAACyJ,aAAD,CAAhC,CAvJO,CAyJP;AACA;AACA;;AACA,UAAME,iBAAiB,GAAG1J,uBAAuB,CAACyJ,aAAD,EAAgB,EAAhB,CAAjD;AAEA,UAAM;AAAEpH,MAAAA,cAAF;AAAkBC,MAAAA;AAAlB,QAAiCL,SAAS,CAACC,KAAD,EAAQC,IAAR,CAAhD;;AAEA,UAAMwH,iBAAiB,GAAG/F,MAAM,IAAI;AAClC,YAAMgG,iBAAiB,GAAGrC,cAAc,CAACpC,UAAf,CAA0BhC,KAA1B,KAAoCnE,oBAA9D;;AACA,UAAIsK,YAAY,IAAIM,iBAApB,EAAuC;AACrCC,QAAAA,MAAM,CAACC,QAAP,CAAgB,CAAhB,EAAmB,CAAnB;AACD,OAFD,MAEO;AACL,aAAKtG,YAAL,CAAkBI,MAAlB;AACD;AACF,KAPD;;AASA,UAAMmG,aAAa,GAAG,CAAC7F,OAAD,EAAU8F,WAAV,KACpB,CAAC9F,OAAO,CAAC+F,MAAR,IAAkB,EAAnB,EACGC,GADH,CACOC,KAAK,IAAI;AACZ,YAAMC,QAAQ,GAAGD,KAAK,CAAChF,UAAN,CAAiBiF,QAAlC;AACA,YAAM/C,OAAO,GAAG+C,QAAQ,GAAGA,QAAQ,CAACJ,WAAD,CAAX,GAA2B,IAAnD,CAFY,CAIZ;AACA;;AACA,YAAMK,KAAK,GAAGF,KAAK,CAAChF,UAAN,CAAiBkF,KAA/B;AACA,YAAMC,IAAI,GAAGD,KAAK,GAAGA,KAAK,CAAC1H,IAAN,CAAW4H,CAAC,IAAIA,CAAC,CAACC,IAAF,KAAWR,WAA3B,CAAH,GAA6C,IAA/D;AAEA,aAAO3C,OAAO,IAAIiD,IAAlB;AACD,KAXH,EAYGG,MAZH,CAYUpD,OAAO,IAAIA,OAAO,IAAI,IAZhC,CADF;;AAeA,UAAMqD,cAAc,GAAGX,aAAa,CAACxC,cAAD,EAAiB,UAAjB,CAApC;AACA,UAAMoD,aAAa,GAAGZ,aAAa,CAACxC,cAAD,EAAiB,SAAjB,CAAnC;AACA,UAAMqD,YAAY,GAAGb,aAAa,CAACxC,cAAD,EAAkB,GAAE9I,MAAM,CAACyF,OAAP,CAAe2G,aAAc,KAAjD,CAAb,CAAoEX,GAApE,CACnBY,GAAG,IAAIA,GAAG,CAACC,GADQ,CAArB;AAGA,UAAMC,SAAS,GAAGvM,MAAM,CAACuM,SAAzB;AACA,UAAMC,WAAW,GAAG9I,IAAI,CAACsG,aAAL,CAClB;AAAElF,MAAAA,EAAE,EAAE;AAAN,KADkB,EAElB;AAAE6B,MAAAA,KAAF;AAASlD,MAAAA,KAAK,EAAEG,cAAhB;AAAgC2I,MAAAA;AAAhC,KAFkB,CAApB,CA9LO,CAkMP;AACA;AACA;;AACA,UAAME,UAAU,GAAI,GAAEzM,MAAM,CAAC0M,gBAAiB,GAAE9F,QAAQ,CAACE,QAAS,GAAEF,QAAQ,CAACG,MAAO,GAAEH,QAAQ,CAACI,IAAK,EAApG;AACA,UAAM2F,KAAK,GAAG7D,cAAH,aAAGA,cAAH,gDAAGA,cAAc,CAAEpC,UAAnB,oFAAG,sBAA4B+C,UAA/B,2DAAG,uBAAwCkD,KAAtD;AACA,UAAMC,UAAU,GAAGD,KAAK,GAAG;AAAEA,MAAAA,KAAK,EAAE;AAAE,iBAAS,OAAX;AAAoBZ,QAAAA,IAAI,EAAEY;AAA1B;AAAT,KAAH,GAAkD,EAA1E;AACA,UAAME,iBAAiB,GAAGnJ,IAAI,CAACoJ,YAAL,CAAkB7L,oBAAoB,CAACwC,KAAD,CAAtC,EAA+C;AACvEsJ,MAAAA,qBAAqB,EAAE,CADgD;AAEvEC,MAAAA,qBAAqB,EAAE;AAFgD,KAA/C,CAA1B;AAIA,UAAMC,YAAY,GAAG,0BAAAnE,cAAc,CAACmE,YAAf,0GAA6BvG,UAA7B,kFAAyCwG,QAAzC,KAAqD,CAA1E;AACA,UAAMC,kBAAkB,GACtBF,YAAY,GAAG,CAAf,GAAmB,4BAAnB,GAAkD,+BADpD;AAGA,UAAMG,UAAU,gBACd,oBAAC,SAAD;AACE,MAAA,SAAS,EAAE/J,GAAG,CAACgK,cADjB;AAEE,MAAA,IAAI,EAAC,aAFP;AAGE,MAAA,MAAM,EAAE5I,MAHV;AAIE,MAAA,EAAE,EAAE;AAAEuC,QAAAA,IAAI,EAAE;AAAR,OAJN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAMGiE,iBANH,CADF;AAWA,UAAMqC,cAAc,GAAGjN,0BAA0B,CAAC,WAAD,EAAciI,YAAY,CAACiF,OAA3B,CAAjD;AACA,UAAMC,eAAe,GAAGnN,0BAA0B,CAAC,UAAD,EAAaiI,YAAY,CAACiF,OAA1B,CAAlD;AACA,UAAME,QAAQ,GACZhE,UAAU,IAAIA,UAAU,CAACgE,QAAzB,gBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG3J,aAAa,CAAC0J,eAAD,EAAkB/D,UAAU,CAACgE,QAA7B,CADhB,eAEE;AAAM,MAAA,SAAS,EAAEpK,GAAG,CAACqK,SAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,CADF,GAKI,IANN;AAQA,wBACE,oBAAC,IAAD;AACE,MAAA,KAAK,EAAElB,WADT;AAEE,MAAA,iBAAiB,EAAE1E,iBAFrB;AAGE,MAAA,MAAM,EAAEmD,iBAHV;AAIE,MAAA,WAAW,EAAC,SAJd;AAKE,MAAA,WAAW,EAAE1B,WALf;AAME,MAAA,cAAc,EAAE0C,cANlB;AAOE,MAAA,aAAa,EAAEC,aAPjB;AAQE,MAAA,MAAM,EAAE;AACN,oBAAY,mBADN;AAEN,iBAAS,SAFH;AAGN3C,QAAAA,WAAW,EAAEA,WAHP;AAINwC,QAAAA,IAAI,EAAES,WAJA;AAKNd,QAAAA,KAAK,EAAES,YALD;AAMN,WAAGS,UANG;AAONe,QAAAA,MAAM,EAAE;AACN,mBAAS,OADH;AAENrB,UAAAA,GAAG,EAAEG,UAFC;AAGNmB,UAAAA,aAAa,EAAEnK,KAAK,CAACE,QAHf;AAINF,UAAAA,KAAK,EAAEoJ,iBAJD;AAKNgB,UAAAA,YAAY,EAAEV;AALR;AAPF,OARV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAwBE,oBAAC,kBAAD;AAAoB,MAAA,SAAS,EAAE9J,GAAG,CAAC8G,QAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAsBF,MAAtB,CADF,eAEE,oBAAC,iBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,aAAD;AACE,MAAA,KAAK,EAAEtD,KADT;AAEE,MAAA,OAAO,EAAEmC,cAFX;AAGE,MAAA,YAAY,EAAE+B,YAHhB;AAIE,MAAA,UAAU,EAAE;AACV/F,QAAAA,EAAE,EAAEU,SAAS,CAACgB,IADJ;AAEVC,QAAAA,IAAI,EAAEsC,WAFI;AAGV+E,QAAAA,IAAI,EAAE9E,WAHI;AAIV+E,QAAAA,GAAG,EAAE9E;AAJK,OAJd;AAUE,MAAA,iBAAiB,EAAE,KAAKvE,KAAL,CAAWE,iBAVhC;AAWE,MAAA,oBAAoB,EAAE,MAAM,KAAKqC,QAAL,CAAc;AAAErC,QAAAA,iBAAiB,EAAE;AAArB,OAAd,CAX9B;AAYE,MAAA,qBAAqB,EAAE2F,qBAZzB;AAaE,MAAA,wBAAwB,EAAE3C,wBAb5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAgBE;AAAK,MAAA,SAAS,EAAEvE,GAAG,CAAC2K,2BAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,aAAD;AAAe,MAAA,IAAI,EAAEjD,aAArB;AAAoC,MAAA,MAAM,EAAEtG,MAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAEE;AAAK,MAAA,SAAS,EAAEpB,GAAG,CAAC4K,uBAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,cAAD;AACE,MAAA,UAAU,EAAEpK,UADd;AAEE,MAAA,cAAc,EAAED,cAFlB;AAGE,MAAA,SAAS,EAAE8F,SAHb;AAIE,MAAA,QAAQ,EAAE+D,QAJZ;AAKE,MAAA,UAAU,EAAEL,UALd;AAME,MAAA,eAAe,EAAEtC,eANnB;AAOE,MAAA,aAAa,EAAE,KAAK7F,aAPtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,eAUE,oBAAC,uBAAD;AAAyB,MAAA,WAAW,EAAEsE,WAAtC;AAAmD,MAAA,YAAY,EAAEG,SAAjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAVF,eAWE,oBAAC,mBAAD;AAAqB,MAAA,UAAU,EAAED,UAAjC;AAA6C,MAAA,YAAY,EAAEnB,YAA3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAXF,eAYE,oBAAC,oBAAD;AACE,MAAA,eAAe,EAAC,WADlB;AAEE,MAAA,OAAO,EAAEgF,cAFX;AAGE,MAAA,UAAU,EAAE7D,UAHd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAZF,eAiBE,oBAAC,iBAAD;AAAmB,MAAA,UAAU,EAAEA,UAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAjBF,eAkBE,oBAAC,eAAD;AACE,MAAA,WAAW,EAAED,WADf;AAEE,MAAA,UAAU,EAAEC,UAFd;AAGE,MAAA,SAAS,EAAEX,cAAc,CAAChE,EAH5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAlBF,eAuBE,oBAAC,cAAD;AAAgB,MAAA,OAAO,EAAEkD,OAAzB;AAAkC,MAAA,iBAAiB,EAAEC,iBAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAvBF,eAwBE,oBAAC,kBAAD;AACE,MAAA,KAAK,EAAEtB,KADT;AAEE,MAAA,OAAO,EAAEmC,cAFX;AAGE,MAAA,iBAAiB,EAAEmC,iBAHrB;AAIE,MAAA,aAAa,EAAE,KAAKhG,aAJtB;AAKE,MAAA,kBAAkB,EAAEyC,eAAe,IAAI,KAAKhD,KAAL,CAAWG,gBALpD;AAME,MAAA,mBAAmB,EAAE,MAAM,KAAKoC,QAAL,CAAc;AAAEpC,QAAAA,gBAAgB,EAAE;AAApB,OAAd,CAN7B;AAOE,MAAA,gBAAgB,EAAEsD,gBAPpB;AAQE,MAAA,qBAAqB,EAAED,qBARzB;AASE,MAAA,eAAe,EAAE,KAAKhD,eATxB;AAUE,MAAA,WAAW,EAAEmB,WAVf;AAWE,MAAA,wBAAwB,EAAEuB,wBAX5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAxBF,CAFF,eAwCE;AAAK,MAAA,SAAS,EAAEvE,GAAG,CAAC6K,wBAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,UAAD;AACE,MAAA,SAAS,EAAE7K,GAAG,CAAC8K,UADjB;AAEE,MAAA,OAAO,EAAErF,cAFX;AAGE,MAAA,YAAY,EAAE+B,YAHhB;AAIE,MAAA,QAAQ,EAAEpD,QAJZ;AAKE,MAAA,QAAQ,EAAEyD,iBALZ;AAME,MAAA,KAAK,EAAEpB,YANT;AAOE,MAAA,QAAQ,EAAEC,eAPZ;AAQE,MAAA,iBAAiB,EAAEkB,iBARrB;AASE,MAAA,wBAAwB,EAAErD,wBAT5B;AAUE,MAAA,SAAS,EAAEQ,SAVb;AAWE,MAAA,mBAAmB,EAAEC,mBAXvB;AAYE,MAAA,2BAA2B,EAAEE,2BAZ/B;AAaE,MAAA,aAAa,EAAE,KAAKtD,aAbtB;AAcE,MAAA,SAAS,EAAEuD,SAdb;AAeE,MAAA,wBAAwB,EAAEC,wBAf5B;AAgBE,MAAA,mBAAmB,EAAEC,mBAhBvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAxCF,CAhBF,CADF,CAFF,eAkFE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAlFF,CAxBF,CADF;AAiHD;;AA9biD;AAicpDrE,oBAAoB,CAAC+J,YAArB,GAAoC;AAClC3G,EAAAA,QAAQ,EAAEzH,MAAM,CAACqO,gBADiB;AAElChI,EAAAA,WAAW,EAAE,IAFqB;AAGlC7B,EAAAA,4BAA4B,EAAE,IAHI;AAIlCuD,EAAAA,gBAAgB,EAAE,IAJgB;AAKlCC,EAAAA,OAAO,EAAE,EALyB;AAMlCC,EAAAA,iBAAiB,EAAE,IANe;AAOlCG,EAAAA,SAAS,EAAE,IAPuB;AAQlCC,EAAAA,mBAAmB,EAAE,IARa;AASlCF,EAAAA,gBAAgB,EAAE,IATgB;AAUlCG,EAAAA,YAAY,EAAEtI,MAAM,CAACsO,MAVa;AAWlC9F,EAAAA,SAAS,EAAE,IAXuB;AAYlCE,EAAAA,mBAAmB,EAAE;AAZa,CAApC;AAeArE,oBAAoB,CAAC7D,SAArB,GAAiC;AAC/B;AACA4E,EAAAA,OAAO,EAAE3F,KAAK,CAAC;AACb8G,IAAAA,IAAI,EAAE/G,IAAI,CAAC+O;AADE,GAAD,CAAL,CAENA,UAJ4B;AAK/B3H,EAAAA,QAAQ,EAAEnH,KAAK,CAAC;AACdsH,IAAAA,MAAM,EAAErH;AADM,GAAD,CAAL,CAEP6O,UAP4B;AAS/B9G,EAAAA,QAAQ,EAAEjH,SAAS,CAAC6N,gBATW;AAU/B;AACA3K,EAAAA,IAAI,EAAEvD,SAAS,CAACoO,UAXe;AAa/B9J,EAAAA,MAAM,EAAEhF,KAAK,CAAC;AACZqF,IAAAA,EAAE,EAAEpF,MAAM,CAAC6O,UADC;AAEZ9H,IAAAA,IAAI,EAAE/G,MAFM;AAGZkJ,IAAAA,OAAO,EAAEjJ,KAAK,CAAC,CAACgB,0BAAD,EAA6BC,qCAA7B,CAAD;AAHF,GAAD,CAAL,CAIL2N,UAjB4B;AAmB/B7G,EAAAA,eAAe,EAAEnI,IAAI,CAACgP,UAnBS;AAoB/BlI,EAAAA,WAAW,EAAE7F,SAAS,CAAC6F,WApBQ;AAqB/BhB,EAAAA,UAAU,EAAE7F,IAAI,CAAC+O,UArBc;AAsB/B5G,EAAAA,aAAa,EAAEnI,IAAI,CAAC+O,UAtBW;AAuB/B3G,EAAAA,wBAAwB,EAAEpI,IAAI,CAAC+O,UAvBA;AAwB/BzG,EAAAA,iBAAiB,EAAEvI,IAAI,CAACgP,UAxBO;AAyB/B/J,EAAAA,4BAA4B,EAAE9E,MAzBC;AA0B/BqI,EAAAA,gBAAgB,EAAEvH,SAAS,CAACgO,KA1BG;AA2B/BlJ,EAAAA,oBAAoB,EAAE9F,IAAI,CAAC+O,UA3BI;AA4B/BvG,EAAAA,OAAO,EAAE1I,OAAO,CAACkB,SAAS,CAACiO,MAAX,CA5Be;AA6B/BxG,EAAAA,iBAAiB,EAAEzH,SAAS,CAACgO,KA7BE;AA8B/BpG,EAAAA,SAAS,EAAE9I,OAAO,CAACkB,SAAS,CAACkO,QAAX,CA9Ba;AA+B/BrG,EAAAA,mBAAmB,EAAE7H,SAAS,CAACgO,KA/BA;AAgC/BtG,EAAAA,qBAAqB,EAAE3I,IAAI,CAACgP,UAhCG;AAiC/BpG,EAAAA,gBAAgB,EAAE3H,SAAS,CAACgO,KAjCG;AAkC/BtH,EAAAA,aAAa,EAAE1H,IAAI,CAAC+O,UAlCW;AAmC/BhJ,EAAAA,2BAA2B,EAAE/F,IAAI,CAAC+O,UAnCH;AAoC/BjG,EAAAA,YAAY,EAAE1I,MApCiB;AAqC/B2I,EAAAA,2BAA2B,EAAE/I,IAAI,CAAC+O,UArCH;AAsC/B/F,EAAAA,SAAS,EAAEnJ,KAtCoB;AAuC/BoJ,EAAAA,wBAAwB,EAAElJ,IAAI,CAACgP,UAvCA;AAwC/B7F,EAAAA,mBAAmB,EAAElI,SAAS,CAACgO;AAxCA,CAAjC;;AA2CA,MAAMG,eAAe,GAAGjK,KAAK,IAAI;AAC/B,QAAM;AAAEgD,IAAAA;AAAF,MAAsBhD,KAAK,CAACkK,IAAlC;AACA,QAAM;AACJ7G,IAAAA,gBADI;AAEJC,IAAAA,OAFI;AAGJC,IAAAA,iBAHI;AAIJG,IAAAA,SAJI;AAKJC,IAAAA,mBALI;AAMJH,IAAAA,qBANI;AAOJC,IAAAA,gBAPI;AAQJK,IAAAA,SARI;AASJC,IAAAA,wBATI;AAUJC,IAAAA,mBAVI;AAWJlE,IAAAA;AAXI,MAYFE,KAAK,CAACmK,WAZV;AAaA,QAAM;AAAExI,IAAAA;AAAF,MAAkB3B,KAAK,CAACoK,IAA9B;;AAEA,QAAMzJ,UAAU,GAAGP,EAAE,IAAI;AACvB,UAAMiK,GAAG,GAAG;AAAEjK,MAAAA,EAAF;AAAMgJ,MAAAA,IAAI,EAAE;AAAZ,KAAZ;AACA,UAAMkB,QAAQ,GAAGvN,sBAAsB,CAACiD,KAAD,EAAQ,CAACqK,GAAD,CAAR,CAAvC;AACA,WAAOC,QAAQ,CAACC,MAAT,KAAoB,CAApB,GAAwBD,QAAQ,CAAC,CAAD,CAAhC,GAAsC,IAA7C;AACD,GAJD;;AAMA,QAAMrH,aAAa,GAAG7C,EAAE,IAAI;AAC1B,UAAMiK,GAAG,GAAG;AAAEjK,MAAAA,EAAF;AAAMgJ,MAAAA,IAAI,EAAE;AAAZ,KAAZ;AACA,UAAMkB,QAAQ,GAAGvN,sBAAsB,CAACiD,KAAD,EAAQ,CAACqK,GAAD,CAAR,CAAvC;AACA,WAAOC,QAAQ,CAACC,MAAT,KAAoB,CAApB,GAAwBD,QAAQ,CAAC,CAAD,CAAhC,GAAsC,IAA7C;AACD,GAJD;;AAMA,SAAO;AACLtH,IAAAA,eADK;AAELrB,IAAAA,WAFK;AAGLhB,IAAAA,UAHK;AAILsC,IAAAA,aAJK;AAKLG,IAAAA,iBAAiB,EAAEnG,mBAAmB,CAAC+C,KAAD,CALjC;AAMLF,IAAAA,4BANK;AAOLuD,IAAAA,gBAPK;AAQLC,IAAAA,OARK;AASLC,IAAAA,iBATK;AAULG,IAAAA,SAVK;AAWLC,IAAAA,mBAXK;AAYLG,IAAAA,SAZK;AAaLC,IAAAA,wBAbK;AAcLC,IAAAA,mBAdK;AAeLR,IAAAA,qBAfK;AAgBLC,IAAAA;AAhBK,GAAP;AAkBD,CA/CD;;AAiDA,MAAM+G,kBAAkB,GAAGC,QAAQ,KAAK;AACtCvH,EAAAA,wBAAwB,EAAE,CAACwH,WAAD,EAAcC,gBAAd,KACxBF,QAAQ,CAACzN,sBAAsB,CAAC0N,WAAD,EAAcC,gBAAd,CAAvB,CAF4B;AAGtC/J,EAAAA,oBAAoB,EAAE,CAAC5C,gBAAD,EAAmByC,MAAnB,EAA2BiB,oBAA3B,KACpB+I,QAAQ,CAACzM,gBAAgB,CAACyC,MAAD,EAASiB,oBAAT,CAAjB,CAJ4B;AAKtCmC,EAAAA,2BAA2B,EAAE,CAACrC,SAAD,EAAYV,SAAZ,EAAuBqF,YAAvB,KAC3BsE,QAAQ,CAAC1M,yBAAyB,CAACyD,SAAD,EAAYV,SAAZ,EAAuBqF,YAAvB,CAA1B,CAN4B;AAOtC3D,EAAAA,aAAa,EAAE,CAAC1B,SAAD,EAAY2B,OAAZ,KAAwBgI,QAAQ,CAAC3M,WAAW,CAACgD,SAAD,EAAY2B,OAAZ,CAAZ,CAPT;AAQtC5B,EAAAA,2BAA2B,EAAE,MAAM4J,QAAQ,CAACvN,yBAAyB,EAA1B;AARL,CAAL,CAAnC,C,CAWA;AACA;AACA;AACA;AACA;AACA;;;AACA,MAAMiN,WAAW,GAAGhP,OAAO,CACzBE,UADyB,EAEzBD,OAAO,CACL6O,eADK,EAELO,kBAFK,CAFkB,EAMzB9O,UANyB,CAAP,CAOlBiE,oBAPkB,CAApB;AASA,eAAewK,WAAf","sourcesContent":["import React, { Component } from 'react';\r\nimport { array, arrayOf, bool, func, shape, string, oneOf, object } from 'prop-types';\r\nimport { compose } from 'redux';\r\nimport { connect } from 'react-redux';\r\nimport { withRouter } from 'react-router-dom';\r\n\r\nimport config from '../../config';\r\nimport routeConfiguration from '../../routing/routeConfiguration';\r\nimport { FormattedMessage, intlShape, injectIntl } from '../../util/reactIntl';\r\nimport { findOptionsForSelectFilter } from '../../util/search';\r\nimport { LISTING_STATE_PENDING_APPROVAL, LISTING_STATE_CLOSED, propTypes } from '../../util/types';\r\nimport { types as sdkTypes } from '../../util/sdkLoader';\r\nimport {\r\n  LISTING_PAGE_DRAFT_VARIANT,\r\n  LISTING_PAGE_PENDING_APPROVAL_VARIANT,\r\n  LISTING_PAGE_PARAM_TYPE_DRAFT,\r\n  LISTING_PAGE_PARAM_TYPE_EDIT,\r\n  createSlug,\r\n} from '../../util/urlHelpers';\r\nimport { formatMoney, convertMoneyToNumber } from '../../util/currency';\r\nimport { createResourceLocatorString, findRouteByRouteName } from '../../util/routes';\r\nimport {\r\n  ensureListing,\r\n  ensureOwnListing,\r\n  ensureUser,\r\n  userDisplayNameAsString,\r\n} from '../../util/data';\r\nimport { richText } from '../../util/richText';\r\nimport { getMarketplaceEntities } from '../../ducks/marketplaceData.duck';\r\nimport { manageDisableScrolling, isScrollingDisabled } from '../../ducks/UI.duck';\r\nimport { initializeCardPaymentData } from '../../ducks/stripe.duck.js';\r\n\r\nimport {\r\n  Page,\r\n  NamedLink,\r\n  NamedRedirect,\r\n  LayoutSingleColumn,\r\n  LayoutWrapperTopbar,\r\n  LayoutWrapperMain,\r\n  LayoutWrapperFooter,\r\n  Footer,\r\n  OrderPanel,\r\n} from '../../components';\r\nimport TopbarContainer from '../../containers/TopbarContainer/TopbarContainer';\r\nimport NotFoundPage from '../../containers/NotFoundPage/NotFoundPage';\r\n\r\nimport { sendEnquiry, fetchTransactionLineItems, setInitialValues } from './ListingPage.duck';\r\nimport SectionImages from './SectionImages';\r\nimport SectionAvatar from './SectionAvatar';\r\nimport SectionHeading from './SectionHeading';\r\nimport SectionDescriptionMaybe from './SectionDescriptionMaybe';\r\nimport SectionDetailsMaybe from './SectionDetailsMaybe';\r\nimport SectionFeaturesMaybe from './SectionFeaturesMaybe';\r\nimport SectionReviews from './SectionReviews';\r\nimport SectionAuthorMaybe from './SectionAuthorMaybe';\r\nimport SectionRulesMaybe from './SectionRulesMaybe';\r\nimport SectionMapMaybe from './SectionMapMaybe';\r\nimport css from './ListingPage.module.css';\r\n\r\nconst MIN_LENGTH_FOR_LONG_WORDS_IN_TITLE = 16;\r\n\r\nconst { UUID } = sdkTypes;\r\n\r\nconst priceData = (price, intl) => {\r\n  if (price && price.currency === config.currency) {\r\n    const formattedPrice = formatMoney(intl, price);\r\n    return { formattedPrice, priceTitle: formattedPrice };\r\n  } else if (price) {\r\n    return {\r\n      formattedPrice: `(${price.currency})`,\r\n      priceTitle: `Unsupported currency (${price.currency})`,\r\n    };\r\n  }\r\n  return {};\r\n};\r\n\r\nconst categoryLabel = (categories, key) => {\r\n  const cat = categories.find(c => c.key === key);\r\n  return cat ? cat.label : key;\r\n};\r\n\r\nexport class ListingPageComponent extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    const { enquiryModalOpenForListingId, params } = props;\r\n    this.state = {\r\n      pageClassNames: [],\r\n      imageCarouselOpen: false,\r\n      enquiryModalOpen: enquiryModalOpenForListingId === params.id,\r\n    };\r\n\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.onContactUser = this.onContactUser.bind(this);\r\n    this.onSubmitEnquiry = this.onSubmitEnquiry.bind(this);\r\n  }\r\n\r\n  handleSubmit(values) {\r\n    const {\r\n      history,\r\n      getListing,\r\n      params,\r\n      callSetInitialValues,\r\n      onInitializeCardPaymentData,\r\n    } = this.props;\r\n    const listingId = new UUID(params.id);\r\n    const listing = getListing(listingId);\r\n\r\n    const { bookingDates, ...otherOrderData } = values;\r\n    const bookingDatesMaybe = bookingDates\r\n      ? {\r\n          bookingDates: {\r\n            bookingStart: bookingDates.startDate,\r\n            bookingEnd: bookingDates.endDate,\r\n          },\r\n        }\r\n      : {};\r\n\r\n    const initialValues = {\r\n      listing,\r\n      orderData: {\r\n        ...bookingDatesMaybe,\r\n        ...otherOrderData,\r\n      },\r\n      confirmPaymentError: null,\r\n    };\r\n\r\n    const saveToSessionStorage = !this.props.currentUser;\r\n\r\n    const routes = routeConfiguration();\r\n    // Customize checkout page state with current listing and selected orderData\r\n    const { setInitialValues } = findRouteByRouteName('CheckoutPage', routes);\r\n\r\n    callSetInitialValues(setInitialValues, initialValues, saveToSessionStorage);\r\n\r\n    // Clear previous Stripe errors from store if there is any\r\n    onInitializeCardPaymentData();\r\n\r\n    // Redirect to CheckoutPage\r\n    history.push(\r\n      createResourceLocatorString(\r\n        'CheckoutPage',\r\n        routes,\r\n        { id: listing.id.uuid, slug: createSlug(listing.attributes.title) },\r\n        {}\r\n      )\r\n    );\r\n  }\r\n\r\n  onContactUser() {\r\n    const { currentUser, history, callSetInitialValues, params, location } = this.props;\r\n\r\n    if (!currentUser) {\r\n      const state = { from: `${location.pathname}${location.search}${location.hash}` };\r\n\r\n      // We need to log in before showing the modal, but first we need to ensure\r\n      // that modal does open when user is redirected back to this listingpage\r\n      callSetInitialValues(setInitialValues, { enquiryModalOpenForListingId: params.id });\r\n\r\n      // signup and return back to listingPage.\r\n      history.push(createResourceLocatorString('SignupPage', routeConfiguration(), {}, {}), state);\r\n    } else {\r\n      this.setState({ enquiryModalOpen: true });\r\n    }\r\n  }\r\n\r\n  onSubmitEnquiry(values) {\r\n    const { history, params, onSendEnquiry } = this.props;\r\n    const routes = routeConfiguration();\r\n    const listingId = new UUID(params.id);\r\n    const { message } = values;\r\n\r\n    onSendEnquiry(listingId, message.trim())\r\n      .then(txId => {\r\n        this.setState({ enquiryModalOpen: false });\r\n\r\n        // Redirect to OrderDetailsPage\r\n        history.push(\r\n          createResourceLocatorString('OrderDetailsPage', routes, { id: txId.uuid }, {})\r\n        );\r\n      })\r\n      .catch(() => {\r\n        // Ignore, error handling in duck file\r\n      });\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      unitType,\r\n      isAuthenticated,\r\n      currentUser,\r\n      getListing,\r\n      getOwnListing,\r\n      intl,\r\n      onManageDisableScrolling,\r\n      params: rawParams,\r\n      location,\r\n      scrollingDisabled,\r\n      showListingError,\r\n      reviews,\r\n      fetchReviewsError,\r\n      sendEnquiryInProgress,\r\n      sendEnquiryError,\r\n      timeSlots,\r\n      fetchTimeSlotsError,\r\n      customConfig,\r\n      onFetchTransactionLineItems,\r\n      lineItems,\r\n      fetchLineItemsInProgress,\r\n      fetchLineItemsError,\r\n    } = this.props;\r\n\r\n    const listingId = new UUID(rawParams.id);\r\n    const isPendingApprovalVariant = rawParams.variant === LISTING_PAGE_PENDING_APPROVAL_VARIANT;\r\n    const isDraftVariant = rawParams.variant === LISTING_PAGE_DRAFT_VARIANT;\r\n    const currentListing =\r\n      isPendingApprovalVariant || isDraftVariant\r\n        ? ensureOwnListing(getOwnListing(listingId))\r\n        : ensureListing(getListing(listingId));\r\n\r\n    const listingSlug = rawParams.slug || createSlug(currentListing.attributes.title || '');\r\n    const params = { slug: listingSlug, ...rawParams };\r\n\r\n    const listingType = isDraftVariant\r\n      ? LISTING_PAGE_PARAM_TYPE_DRAFT\r\n      : LISTING_PAGE_PARAM_TYPE_EDIT;\r\n    const listingTab = isDraftVariant ? 'photos' : 'details';\r\n\r\n    const isApproved =\r\n      currentListing.id && currentListing.attributes.state !== LISTING_STATE_PENDING_APPROVAL;\r\n\r\n    const pendingIsApproved = isPendingApprovalVariant && isApproved;\r\n\r\n    // If a /pending-approval URL is shared, the UI requires\r\n    // authentication and attempts to fetch the listing from own\r\n    // listings. This will fail with 403 Forbidden if the author is\r\n    // another user. We use this information to try to fetch the\r\n    // public listing.\r\n    const pendingOtherUsersListing =\r\n      (isPendingApprovalVariant || isDraftVariant) &&\r\n      showListingError &&\r\n      showListingError.status === 403;\r\n    const shouldShowPublicListingPage = pendingIsApproved || pendingOtherUsersListing;\r\n\r\n    if (shouldShowPublicListingPage) {\r\n      return <NamedRedirect name=\"ListingPage\" params={params} search={location.search} />;\r\n    }\r\n\r\n    const {\r\n      description = '',\r\n      geolocation = null,\r\n      price = null,\r\n      title = '',\r\n      publicData,\r\n    } = currentListing.attributes;\r\n\r\n    const richTitle = (\r\n      <span>\r\n        {richText(title, {\r\n          longWordMinLength: MIN_LENGTH_FOR_LONG_WORDS_IN_TITLE,\r\n          longWordClass: css.longWord,\r\n        })}\r\n      </span>\r\n    );\r\n\r\n    const bookingTitle = (\r\n      <FormattedMessage id=\"ListingPage.bookingTitle\" values={{ title: richTitle }} />\r\n    );\r\n    const bookingSubTitle = intl.formatMessage({ id: 'ListingPage.bookingSubTitle' });\r\n\r\n    const topbar = <TopbarContainer />;\r\n\r\n    if (showListingError && showListingError.status === 404) {\r\n      // 404 listing not found\r\n\r\n      return <NotFoundPage />;\r\n    } else if (showListingError) {\r\n      // Other error in fetching listing\r\n\r\n      const errorTitle = intl.formatMessage({\r\n        id: 'ListingPage.errorLoadingListingTitle',\r\n      });\r\n\r\n      return (\r\n        <Page title={errorTitle} scrollingDisabled={scrollingDisabled}>\r\n          <LayoutSingleColumn className={css.pageRoot}>\r\n            <LayoutWrapperTopbar>{topbar}</LayoutWrapperTopbar>\r\n            <LayoutWrapperMain>\r\n              <p className={css.errorText}>\r\n                <FormattedMessage id=\"ListingPage.errorLoadingListingMessage\" />\r\n              </p>\r\n            </LayoutWrapperMain>\r\n            <LayoutWrapperFooter>\r\n              <Footer />\r\n            </LayoutWrapperFooter>\r\n          </LayoutSingleColumn>\r\n        </Page>\r\n      );\r\n    } else if (!currentListing.id) {\r\n      // Still loading the listing\r\n\r\n      const loadingTitle = intl.formatMessage({\r\n        id: 'ListingPage.loadingListingTitle',\r\n      });\r\n\r\n      return (\r\n        <Page title={loadingTitle} scrollingDisabled={scrollingDisabled}>\r\n          <LayoutSingleColumn className={css.pageRoot}>\r\n            <LayoutWrapperTopbar>{topbar}</LayoutWrapperTopbar>\r\n            <LayoutWrapperMain>\r\n              <p className={css.loadingText}>\r\n                <FormattedMessage id=\"ListingPage.loadingListingMessage\" />\r\n              </p>\r\n            </LayoutWrapperMain>\r\n            <LayoutWrapperFooter>\r\n              <Footer />\r\n            </LayoutWrapperFooter>\r\n          </LayoutSingleColumn>\r\n        </Page>\r\n      );\r\n    }\r\n\r\n    const handleViewPhotosClick = e => {\r\n      // Stop event from bubbling up to prevent image click handler\r\n      // trying to open the carousel as well.\r\n      e.stopPropagation();\r\n      this.setState({\r\n        imageCarouselOpen: true,\r\n      });\r\n    };\r\n    const authorAvailable = currentListing && currentListing.author;\r\n    const userAndListingAuthorAvailable = !!(currentUser && authorAvailable);\r\n    const isOwnListing =\r\n      userAndListingAuthorAvailable && currentListing.author.id.uuid === currentUser.id.uuid;\r\n    const showContactUser = authorAvailable && (!currentUser || (currentUser && !isOwnListing));\r\n\r\n    const currentAuthor = authorAvailable ? currentListing.author : null;\r\n    const ensuredAuthor = ensureUser(currentAuthor);\r\n\r\n    // When user is banned or deleted the listing is also deleted.\r\n    // Because listing can be never showed with banned or deleted user we don't have to provide\r\n    // banned or deleted display names for the function\r\n    const authorDisplayName = userDisplayNameAsString(ensuredAuthor, '');\r\n\r\n    const { formattedPrice, priceTitle } = priceData(price, intl);\r\n\r\n    const handleOrderSubmit = values => {\r\n      const isCurrentlyClosed = currentListing.attributes.state === LISTING_STATE_CLOSED;\r\n      if (isOwnListing || isCurrentlyClosed) {\r\n        window.scrollTo(0, 0);\r\n      } else {\r\n        this.handleSubmit(values);\r\n      }\r\n    };\r\n\r\n    const listingImages = (listing, variantName) =>\r\n      (listing.images || [])\r\n        .map(image => {\r\n          const variants = image.attributes.variants;\r\n          const variant = variants ? variants[variantName] : null;\r\n\r\n          // deprecated\r\n          // for backwards combatility only\r\n          const sizes = image.attributes.sizes;\r\n          const size = sizes ? sizes.find(i => i.name === variantName) : null;\r\n\r\n          return variant || size;\r\n        })\r\n        .filter(variant => variant != null);\r\n\r\n    const facebookImages = listingImages(currentListing, 'facebook');\r\n    const twitterImages = listingImages(currentListing, 'twitter');\r\n    const schemaImages = listingImages(currentListing, `${config.listing.variantPrefix}-2x`).map(\r\n      img => img.url\r\n    );\r\n    const siteTitle = config.siteTitle;\r\n    const schemaTitle = intl.formatMessage(\r\n      { id: 'ListingPage.schemaTitle' },\r\n      { title, price: formattedPrice, siteTitle }\r\n    );\r\n    // You could add reviews, sku, etc. into page schema\r\n    // Read more about product schema\r\n    // https://developers.google.com/search/docs/advanced/structured-data/product\r\n    const productURL = `${config.canonicalRootURL}${location.pathname}${location.search}${location.hash}`;\r\n    const brand = currentListing?.attributes?.publicData?.brand;\r\n    const brandMaybe = brand ? { brand: { '@type': 'Brand', name: brand } } : {};\r\n    const schemaPriceNumber = intl.formatNumber(convertMoneyToNumber(price), {\r\n      minimumFractionDigits: 2,\r\n      maximumFractionDigits: 2,\r\n    });\r\n    const currentStock = currentListing.currentStock?.attributes?.quantity || 0;\r\n    const schemaAvailability =\r\n      currentStock > 0 ? 'https://schema.org/InStock' : 'https://schema.org/OutOfStock';\r\n\r\n    const authorLink = (\r\n      <NamedLink\r\n        className={css.authorNameLink}\r\n        name=\"ListingPage\"\r\n        params={params}\r\n        to={{ hash: '#author' }}\r\n      >\r\n        {authorDisplayName}\r\n      </NamedLink>\r\n    );\r\n\r\n    const amenityOptions = findOptionsForSelectFilter('amenities', customConfig.filters);\r\n    const categoryOptions = findOptionsForSelectFilter('category', customConfig.filters);\r\n    const category =\r\n      publicData && publicData.category ? (\r\n        <span>\r\n          {categoryLabel(categoryOptions, publicData.category)}\r\n          <span className={css.separator}></span>\r\n        </span>\r\n      ) : null;\r\n\r\n    return (\r\n      <Page\r\n        title={schemaTitle}\r\n        scrollingDisabled={scrollingDisabled}\r\n        author={authorDisplayName}\r\n        contentType=\"website\"\r\n        description={description}\r\n        facebookImages={facebookImages}\r\n        twitterImages={twitterImages}\r\n        schema={{\r\n          '@context': 'http://schema.org',\r\n          '@type': 'Product',\r\n          description: description,\r\n          name: schemaTitle,\r\n          image: schemaImages,\r\n          ...brandMaybe,\r\n          offers: {\r\n            '@type': 'Offer',\r\n            url: productURL,\r\n            priceCurrency: price.currency,\r\n            price: schemaPriceNumber,\r\n            availability: schemaAvailability,\r\n          },\r\n        }}\r\n      >\r\n        <LayoutSingleColumn className={css.pageRoot}>\r\n          <LayoutWrapperTopbar>{topbar}</LayoutWrapperTopbar>\r\n          <LayoutWrapperMain>\r\n            <div>\r\n              <SectionImages\r\n                title={title}\r\n                listing={currentListing}\r\n                isOwnListing={isOwnListing}\r\n                editParams={{\r\n                  id: listingId.uuid,\r\n                  slug: listingSlug,\r\n                  type: listingType,\r\n                  tab: listingTab,\r\n                }}\r\n                imageCarouselOpen={this.state.imageCarouselOpen}\r\n                onImageCarouselClose={() => this.setState({ imageCarouselOpen: false })}\r\n                handleViewPhotosClick={handleViewPhotosClick}\r\n                onManageDisableScrolling={onManageDisableScrolling}\r\n              />\r\n              <div className={css.contentWrapperForHeroLayout}>\r\n                <SectionAvatar user={currentAuthor} params={params} />\r\n                <div className={css.mainColumnForHeroLayout}>\r\n                  <SectionHeading\r\n                    priceTitle={priceTitle}\r\n                    formattedPrice={formattedPrice}\r\n                    richTitle={richTitle}\r\n                    category={category}\r\n                    authorLink={authorLink}\r\n                    showContactUser={showContactUser}\r\n                    onContactUser={this.onContactUser}\r\n                  />\r\n                  <SectionDescriptionMaybe description={description} listingTitle={richTitle} />\r\n                  <SectionDetailsMaybe publicData={publicData} customConfig={customConfig} />\r\n                  <SectionFeaturesMaybe\r\n                    extendedDataKey=\"amenities\"\r\n                    options={amenityOptions}\r\n                    publicData={publicData}\r\n                  />\r\n                  <SectionRulesMaybe publicData={publicData} />\r\n                  <SectionMapMaybe\r\n                    geolocation={geolocation}\r\n                    publicData={publicData}\r\n                    listingId={currentListing.id}\r\n                  />\r\n                  <SectionReviews reviews={reviews} fetchReviewsError={fetchReviewsError} />\r\n                  <SectionAuthorMaybe\r\n                    title={title}\r\n                    listing={currentListing}\r\n                    authorDisplayName={authorDisplayName}\r\n                    onContactUser={this.onContactUser}\r\n                    isEnquiryModalOpen={isAuthenticated && this.state.enquiryModalOpen}\r\n                    onCloseEnquiryModal={() => this.setState({ enquiryModalOpen: false })}\r\n                    sendEnquiryError={sendEnquiryError}\r\n                    sendEnquiryInProgress={sendEnquiryInProgress}\r\n                    onSubmitEnquiry={this.onSubmitEnquiry}\r\n                    currentUser={currentUser}\r\n                    onManageDisableScrolling={onManageDisableScrolling}\r\n                  />\r\n                </div>\r\n                <div className={css.orderColumnForHeroLayout}>\r\n                  <OrderPanel\r\n                    className={css.orderPanel}\r\n                    listing={currentListing}\r\n                    isOwnListing={isOwnListing}\r\n                    unitType={unitType}\r\n                    onSubmit={handleOrderSubmit}\r\n                    title={bookingTitle}\r\n                    subTitle={bookingSubTitle}\r\n                    authorDisplayName={authorDisplayName}\r\n                    onManageDisableScrolling={onManageDisableScrolling}\r\n                    timeSlots={timeSlots}\r\n                    fetchTimeSlotsError={fetchTimeSlotsError}\r\n                    onFetchTransactionLineItems={onFetchTransactionLineItems}\r\n                    onContactUser={this.onContactUser}\r\n                    lineItems={lineItems}\r\n                    fetchLineItemsInProgress={fetchLineItemsInProgress}\r\n                    fetchLineItemsError={fetchLineItemsError}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </LayoutWrapperMain>\r\n          <LayoutWrapperFooter>\r\n            <Footer />\r\n          </LayoutWrapperFooter>\r\n        </LayoutSingleColumn>\r\n      </Page>\r\n    );\r\n  }\r\n}\r\n\r\nListingPageComponent.defaultProps = {\r\n  unitType: config.lineItemUnitType,\r\n  currentUser: null,\r\n  enquiryModalOpenForListingId: null,\r\n  showListingError: null,\r\n  reviews: [],\r\n  fetchReviewsError: null,\r\n  timeSlots: null,\r\n  fetchTimeSlotsError: null,\r\n  sendEnquiryError: null,\r\n  customConfig: config.custom,\r\n  lineItems: null,\r\n  fetchLineItemsError: null,\r\n};\r\n\r\nListingPageComponent.propTypes = {\r\n  // from withRouter\r\n  history: shape({\r\n    push: func.isRequired,\r\n  }).isRequired,\r\n  location: shape({\r\n    search: string,\r\n  }).isRequired,\r\n\r\n  unitType: propTypes.lineItemUnitType,\r\n  // from injectIntl\r\n  intl: intlShape.isRequired,\r\n\r\n  params: shape({\r\n    id: string.isRequired,\r\n    slug: string,\r\n    variant: oneOf([LISTING_PAGE_DRAFT_VARIANT, LISTING_PAGE_PENDING_APPROVAL_VARIANT]),\r\n  }).isRequired,\r\n\r\n  isAuthenticated: bool.isRequired,\r\n  currentUser: propTypes.currentUser,\r\n  getListing: func.isRequired,\r\n  getOwnListing: func.isRequired,\r\n  onManageDisableScrolling: func.isRequired,\r\n  scrollingDisabled: bool.isRequired,\r\n  enquiryModalOpenForListingId: string,\r\n  showListingError: propTypes.error,\r\n  callSetInitialValues: func.isRequired,\r\n  reviews: arrayOf(propTypes.review),\r\n  fetchReviewsError: propTypes.error,\r\n  timeSlots: arrayOf(propTypes.timeSlot),\r\n  fetchTimeSlotsError: propTypes.error,\r\n  sendEnquiryInProgress: bool.isRequired,\r\n  sendEnquiryError: propTypes.error,\r\n  onSendEnquiry: func.isRequired,\r\n  onInitializeCardPaymentData: func.isRequired,\r\n  customConfig: object,\r\n  onFetchTransactionLineItems: func.isRequired,\r\n  lineItems: array,\r\n  fetchLineItemsInProgress: bool.isRequired,\r\n  fetchLineItemsError: propTypes.error,\r\n};\r\n\r\nconst mapStateToProps = state => {\r\n  const { isAuthenticated } = state.Auth;\r\n  const {\r\n    showListingError,\r\n    reviews,\r\n    fetchReviewsError,\r\n    timeSlots,\r\n    fetchTimeSlotsError,\r\n    sendEnquiryInProgress,\r\n    sendEnquiryError,\r\n    lineItems,\r\n    fetchLineItemsInProgress,\r\n    fetchLineItemsError,\r\n    enquiryModalOpenForListingId,\r\n  } = state.ListingPage;\r\n  const { currentUser } = state.user;\r\n\r\n  const getListing = id => {\r\n    const ref = { id, type: 'listing' };\r\n    const listings = getMarketplaceEntities(state, [ref]);\r\n    return listings.length === 1 ? listings[0] : null;\r\n  };\r\n\r\n  const getOwnListing = id => {\r\n    const ref = { id, type: 'ownListing' };\r\n    const listings = getMarketplaceEntities(state, [ref]);\r\n    return listings.length === 1 ? listings[0] : null;\r\n  };\r\n\r\n  return {\r\n    isAuthenticated,\r\n    currentUser,\r\n    getListing,\r\n    getOwnListing,\r\n    scrollingDisabled: isScrollingDisabled(state),\r\n    enquiryModalOpenForListingId,\r\n    showListingError,\r\n    reviews,\r\n    fetchReviewsError,\r\n    timeSlots,\r\n    fetchTimeSlotsError,\r\n    lineItems,\r\n    fetchLineItemsInProgress,\r\n    fetchLineItemsError,\r\n    sendEnquiryInProgress,\r\n    sendEnquiryError,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  onManageDisableScrolling: (componentId, disableScrolling) =>\r\n    dispatch(manageDisableScrolling(componentId, disableScrolling)),\r\n  callSetInitialValues: (setInitialValues, values, saveToSessionStorage) =>\r\n    dispatch(setInitialValues(values, saveToSessionStorage)),\r\n  onFetchTransactionLineItems: (orderData, listingId, isOwnListing) =>\r\n    dispatch(fetchTransactionLineItems(orderData, listingId, isOwnListing)),\r\n  onSendEnquiry: (listingId, message) => dispatch(sendEnquiry(listingId, message)),\r\n  onInitializeCardPaymentData: () => dispatch(initializeCardPaymentData()),\r\n});\r\n\r\n// Note: it is important that the withRouter HOC is **outside** the\r\n// connect HOC, otherwise React Router won't rerender any Route\r\n// components since connect implements a shouldComponentUpdate\r\n// lifecycle hook.\r\n//\r\n// See: https://github.com/ReactTraining/react-router/issues/4671\r\nconst ListingPage = compose(\r\n  withRouter,\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  ),\r\n  injectIntl\r\n)(ListingPageComponent);\r\n\r\nexport default ListingPage;\r\n"]},"metadata":{},"sourceType":"module"}