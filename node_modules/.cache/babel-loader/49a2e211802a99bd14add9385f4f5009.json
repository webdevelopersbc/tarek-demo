{"ast":null,"code":"var _jsxFileName = \"D:\\\\Amardeep\\\\tarek_project\\\\ftw-product\\\\src\\\\containers\\\\ListingPage\\\\ListingPageFullImage.js\";\nimport React, { Component } from 'react';\nimport { array, arrayOf, bool, func, shape, string, oneOf, object } from 'prop-types';\nimport { compose } from 'redux';\nimport { connect } from 'react-redux';\nimport { withRouter } from 'react-router-dom';\nimport config from '../../config';\nimport routeConfiguration from '../../routing/routeConfiguration';\nimport { FormattedMessage, intlShape, injectIntl } from '../../util/reactIntl';\nimport { findOptionsForSelectFilter } from '../../util/search';\nimport { LISTING_STATE_PENDING_APPROVAL, LISTING_STATE_CLOSED, propTypes } from '../../util/types';\nimport { types as sdkTypes } from '../../util/sdkLoader';\nimport { LISTING_PAGE_DRAFT_VARIANT, LISTING_PAGE_PENDING_APPROVAL_VARIANT, LISTING_PAGE_PARAM_TYPE_DRAFT, LISTING_PAGE_PARAM_TYPE_EDIT, createSlug } from '../../util/urlHelpers';\nimport { formatMoney, convertMoneyToNumber } from '../../util/currency';\nimport { createResourceLocatorString, findRouteByRouteName } from '../../util/routes';\nimport { ensureListing, ensureOwnListing, ensureUser, userDisplayNameAsString } from '../../util/data';\nimport { richText } from '../../util/richText';\nimport { getMarketplaceEntities } from '../../ducks/marketplaceData.duck';\nimport { manageDisableScrolling, isScrollingDisabled } from '../../ducks/UI.duck';\nimport { initializeCardPaymentData } from '../../ducks/stripe.duck.js';\nimport { Page, NamedLink, NamedRedirect, LayoutSingleColumn, LayoutWrapperTopbar, LayoutWrapperMain, LayoutWrapperFooter, Footer, OrderPanel } from '../../components';\nimport TopbarContainer from '../../containers/TopbarContainer/TopbarContainer';\nimport NotFoundPage from '../../containers/NotFoundPage/NotFoundPage';\nimport { sendEnquiry, fetchTransactionLineItems, setInitialValues } from './ListingPage.duck';\nimport SectionAvatar from './SectionAvatar';\nimport ActionBarMaybe from './ActionBarMaybe';\nimport SectionHeading from './SectionHeading';\nimport SectionDescriptionMaybe from './SectionDescriptionMaybe';\nimport SectionDetailsMaybe from './SectionDetailsMaybe';\nimport SectionFeaturesMaybe from './SectionFeaturesMaybe';\nimport SectionReviews from './SectionReviews';\nimport SectionAuthorMaybe from './SectionAuthorMaybe';\nimport SectionRulesMaybe from './SectionRulesMaybe';\nimport SectionMapMaybe from './SectionMapMaybe';\nimport SectionGallery from './SectionGallery';\nimport css from './ListingPage.module.css';\nconst MIN_LENGTH_FOR_LONG_WORDS_IN_TITLE = 16;\nconst {\n  UUID\n} = sdkTypes;\n\nconst priceData = (price, intl) => {\n  if (price && price.currency === config.currency) {\n    const formattedPrice = formatMoney(intl, price);\n    return {\n      formattedPrice,\n      priceTitle: formattedPrice\n    };\n  } else if (price) {\n    return {\n      formattedPrice: `(${price.currency})`,\n      priceTitle: `Unsupported currency (${price.currency})`\n    };\n  }\n\n  return {};\n};\n\nconst categoryLabel = (categories, key) => {\n  const cat = categories.find(c => c.key === key);\n  return cat ? cat.label : key;\n};\n\nexport class ListingPageComponent extends Component {\n  constructor(props) {\n    super(props);\n    const {\n      enquiryModalOpenForListingId,\n      params\n    } = props;\n    this.state = {\n      pageClassNames: [],\n      imageCarouselOpen: false,\n      enquiryModalOpen: enquiryModalOpenForListingId === params.id\n    };\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.onContactUser = this.onContactUser.bind(this);\n    this.onSubmitEnquiry = this.onSubmitEnquiry.bind(this);\n  }\n\n  handleSubmit(values) {\n    const {\n      history,\n      getListing,\n      params,\n      callSetInitialValues,\n      onInitializeCardPaymentData\n    } = this.props;\n    const listingId = new UUID(params.id);\n    const listing = getListing(listingId);\n    const {\n      bookingDates,\n      quantity: quantityRaw,\n      deliveryMethod,\n      ...otherOrderData\n    } = values;\n    const bookingDatesMaybe = bookingDates ? {\n      bookingDates: {\n        bookingStart: bookingDates.startDate,\n        bookingEnd: bookingDates.endDate\n      }\n    } : {};\n    const initialValues = {\n      listing,\n      orderData: { ...bookingDatesMaybe,\n        quantity: Number.parseInt(quantityRaw, 10),\n        deliveryMethod,\n        ...otherOrderData\n      },\n      confirmPaymentError: null\n    };\n    const saveToSessionStorage = !this.props.currentUser;\n    const routes = routeConfiguration(); // Customize checkout page state with current listing and selected orderData\n\n    const {\n      setInitialValues\n    } = findRouteByRouteName('CheckoutPage', routes);\n    callSetInitialValues(setInitialValues, initialValues, saveToSessionStorage); // Clear previous Stripe errors from store if there is any\n\n    onInitializeCardPaymentData(); // Redirect to CheckoutPage\n\n    history.push(createResourceLocatorString('CheckoutPage', routes, {\n      id: listing.id.uuid,\n      slug: createSlug(listing.attributes.title)\n    }, {}));\n  }\n\n  onContactUser() {\n    const {\n      currentUser,\n      history,\n      callSetInitialValues,\n      params,\n      location\n    } = this.props;\n\n    if (!currentUser) {\n      const state = {\n        from: `${location.pathname}${location.search}${location.hash}`\n      }; // We need to log in before showing the modal, but first we need to ensure\n      // that modal does open when user is redirected back to this listingpage\n\n      callSetInitialValues(setInitialValues, {\n        enquiryModalOpenForListingId: params.id\n      }); // signup and return back to listingPage.\n\n      history.push(createResourceLocatorString('SignupPage', routeConfiguration(), {}, {}), state);\n    } else {\n      this.setState({\n        enquiryModalOpen: true\n      });\n    }\n  }\n\n  onSubmitEnquiry(values) {\n    const {\n      history,\n      params,\n      onSendEnquiry\n    } = this.props;\n    const routes = routeConfiguration();\n    const listingId = new UUID(params.id);\n    const {\n      message\n    } = values;\n    onSendEnquiry(listingId, message.trim()).then(txId => {\n      this.setState({\n        enquiryModalOpen: false\n      }); // Redirect to OrderDetailsPage\n\n      history.push(createResourceLocatorString('OrderDetailsPage', routes, {\n        id: txId.uuid\n      }, {}));\n    }).catch(() => {// Ignore, error handling in duck file\n    });\n  }\n\n  render() {\n    var _currentListing$attri, _currentListing$attri2, _currentListing$curre, _currentListing$curre2;\n\n    const {\n      unitType,\n      isAuthenticated,\n      currentUser,\n      getListing,\n      getOwnListing,\n      intl,\n      onManageDisableScrolling,\n      params: rawParams,\n      location,\n      scrollingDisabled,\n      showListingError,\n      reviews,\n      fetchReviewsError,\n      sendEnquiryInProgress,\n      sendEnquiryError,\n      timeSlots,\n      fetchTimeSlotsError,\n      customConfig,\n      onFetchTransactionLineItems,\n      lineItems,\n      fetchLineItemsInProgress,\n      fetchLineItemsError\n    } = this.props;\n    const listingId = new UUID(rawParams.id);\n    const isPendingApprovalVariant = rawParams.variant === LISTING_PAGE_PENDING_APPROVAL_VARIANT;\n    const isDraftVariant = rawParams.variant === LISTING_PAGE_DRAFT_VARIANT;\n    const currentListing = isPendingApprovalVariant || isDraftVariant ? ensureOwnListing(getOwnListing(listingId)) : ensureListing(getListing(listingId));\n    const listingSlug = rawParams.slug || createSlug(currentListing.attributes.title || '');\n    const params = {\n      slug: listingSlug,\n      ...rawParams\n    };\n    const listingType = isDraftVariant ? LISTING_PAGE_PARAM_TYPE_DRAFT : LISTING_PAGE_PARAM_TYPE_EDIT;\n    const listingTab = isDraftVariant ? 'photos' : 'details';\n    const isApproved = currentListing.id && currentListing.attributes.state !== LISTING_STATE_PENDING_APPROVAL;\n    const pendingIsApproved = isPendingApprovalVariant && isApproved; // If a /pending-approval URL is shared, the UI requires\n    // authentication and attempts to fetch the listing from own\n    // listings. This will fail with 403 Forbidden if the author is\n    // another user. We use this information to try to fetch the\n    // public listing.\n\n    const pendingOtherUsersListing = (isPendingApprovalVariant || isDraftVariant) && showListingError && showListingError.status === 403;\n    const shouldShowPublicListingPage = pendingIsApproved || pendingOtherUsersListing;\n\n    if (shouldShowPublicListingPage) {\n      return /*#__PURE__*/React.createElement(NamedRedirect, {\n        name: \"ListingPage\",\n        params: params,\n        search: location.search,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 14\n        }\n      });\n    }\n\n    const {\n      description = '',\n      geolocation = null,\n      price = null,\n      title = '',\n      publicData\n    } = currentListing.attributes;\n    const richTitle = /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 7\n      }\n    }, richText(title, {\n      longWordMinLength: MIN_LENGTH_FOR_LONG_WORDS_IN_TITLE,\n      longWordClass: css.longWord\n    }));\n    const bookingTitle = /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: \"ListingPage.bookingTitle\",\n      values: {\n        title: richTitle\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 7\n      }\n    });\n    const topbar = /*#__PURE__*/React.createElement(TopbarContainer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 20\n      }\n    });\n\n    if (showListingError && showListingError.status === 404) {\n      // 404 listing not found\n      return /*#__PURE__*/React.createElement(NotFoundPage, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 14\n        }\n      });\n    } else if (showListingError) {\n      // Other error in fetching listing\n      const errorTitle = intl.formatMessage({\n        id: 'ListingPage.errorLoadingListingTitle'\n      });\n      return /*#__PURE__*/React.createElement(Page, {\n        title: errorTitle,\n        scrollingDisabled: scrollingDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(LayoutSingleColumn, {\n        className: css.pageRoot,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(LayoutWrapperTopbar, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 13\n        }\n      }, topbar), /*#__PURE__*/React.createElement(LayoutWrapperMain, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        className: css.errorText,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(FormattedMessage, {\n        id: \"ListingPage.errorLoadingListingMessage\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 17\n        }\n      }))), /*#__PURE__*/React.createElement(LayoutWrapperFooter, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Footer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 15\n        }\n      }))));\n    } else if (!currentListing.id) {\n      // Still loading the listing\n      const loadingTitle = intl.formatMessage({\n        id: 'ListingPage.loadingListingTitle'\n      });\n      return /*#__PURE__*/React.createElement(Page, {\n        title: loadingTitle,\n        scrollingDisabled: scrollingDisabled,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(LayoutSingleColumn, {\n        className: css.pageRoot,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(LayoutWrapperTopbar, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 13\n        }\n      }, topbar), /*#__PURE__*/React.createElement(LayoutWrapperMain, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        className: css.loadingText,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 313,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(FormattedMessage, {\n        id: \"ListingPage.loadingListingMessage\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 17\n        }\n      }))), /*#__PURE__*/React.createElement(LayoutWrapperFooter, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(Footer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 15\n        }\n      }))));\n    }\n\n    const handleViewPhotosClick = e => {\n      // Stop event from bubbling up to prevent image click handler\n      // trying to open the carousel as well.\n      e.stopPropagation();\n      this.setState({\n        imageCarouselOpen: true\n      });\n    };\n\n    const authorAvailable = currentListing && currentListing.author;\n    const userAndListingAuthorAvailable = !!(currentUser && authorAvailable);\n    const isOwnListing = userAndListingAuthorAvailable && currentListing.author.id.uuid === currentUser.id.uuid;\n    const showContactUser = authorAvailable && (!currentUser || currentUser && !isOwnListing);\n    const currentAuthor = authorAvailable ? currentListing.author : null;\n    const ensuredAuthor = ensureUser(currentAuthor); // When user is banned or deleted the listing is also deleted.\n    // Because listing can be never showed with banned or deleted user we don't have to provide\n    // banned or deleted display names for the function\n\n    const authorDisplayName = userDisplayNameAsString(ensuredAuthor, '');\n    const {\n      formattedPrice,\n      priceTitle\n    } = priceData(price, intl);\n\n    const handleOrderSubmit = values => {\n      const isCurrentlyClosed = currentListing.attributes.state === LISTING_STATE_CLOSED;\n\n      if (isOwnListing || isCurrentlyClosed) {\n        window.scrollTo(0, 0);\n      } else {\n        this.handleSubmit(values);\n      }\n    };\n\n    const listingImages = (listing, variantName) => (listing.images || []).map(image => {\n      const variants = image.attributes.variants;\n      const variant = variants ? variants[variantName] : null; // deprecated\n      // for backwards combatility only\n\n      const sizes = image.attributes.sizes;\n      const size = sizes ? sizes.find(i => i.name === variantName) : null;\n      return variant || size;\n    }).filter(variant => variant != null);\n\n    const facebookImages = listingImages(currentListing, 'facebook');\n    const twitterImages = listingImages(currentListing, 'twitter');\n    const schemaImages = listingImages(currentListing, `${config.listing.variantPrefix}-2x`).map(img => img.url);\n    const siteTitle = config.siteTitle;\n    const schemaTitle = intl.formatMessage({\n      id: 'ListingPage.schemaTitle'\n    }, {\n      title,\n      price: formattedPrice,\n      siteTitle\n    }); // You could add reviews, sku, etc. into page schema\n    // Read more about product schema\n    // https://developers.google.com/search/docs/advanced/structured-data/product\n\n    const productURL = `${config.canonicalRootURL}${location.pathname}${location.search}${location.hash}`;\n    const brand = currentListing === null || currentListing === void 0 ? void 0 : (_currentListing$attri = currentListing.attributes) === null || _currentListing$attri === void 0 ? void 0 : (_currentListing$attri2 = _currentListing$attri.publicData) === null || _currentListing$attri2 === void 0 ? void 0 : _currentListing$attri2.brand;\n    const brandMaybe = brand ? {\n      brand: {\n        '@type': 'Brand',\n        name: brand\n      }\n    } : {};\n    const schemaPriceNumber = intl.formatNumber(convertMoneyToNumber(price), {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2\n    });\n    const currentStock = ((_currentListing$curre = currentListing.currentStock) === null || _currentListing$curre === void 0 ? void 0 : (_currentListing$curre2 = _currentListing$curre.attributes) === null || _currentListing$curre2 === void 0 ? void 0 : _currentListing$curre2.quantity) || 0;\n    const schemaAvailability = currentStock > 0 ? 'https://schema.org/InStock' : 'https://schema.org/OutOfStock';\n    const authorLink = /*#__PURE__*/React.createElement(NamedLink, {\n      className: css.authorNameLink,\n      name: \"ListingPage\",\n      params: params,\n      to: {\n        hash: '#author'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 398,\n        columnNumber: 7\n      }\n    }, authorDisplayName);\n    const amenityOptions = findOptionsForSelectFilter('amenities', customConfig.filters);\n    const categoryOptions = findOptionsForSelectFilter('category', customConfig.filters);\n    const category = publicData && publicData.category ? /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 412,\n        columnNumber: 9\n      }\n    }, categoryLabel(categoryOptions, publicData.category), /*#__PURE__*/React.createElement(\"span\", {\n      className: css.separator,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 11\n      }\n    }, \"\\u2022\")) : null;\n    return /*#__PURE__*/React.createElement(Page, {\n      title: schemaTitle,\n      scrollingDisabled: scrollingDisabled,\n      author: authorDisplayName,\n      contentType: \"website\",\n      description: description,\n      facebookImages: facebookImages,\n      twitterImages: twitterImages,\n      schema: {\n        '@context': 'http://schema.org',\n        '@type': 'Product',\n        description: description,\n        name: schemaTitle,\n        image: schemaImages,\n        ...brandMaybe,\n        offers: {\n          '@type': 'Offer',\n          url: productURL,\n          priceCurrency: price.currency,\n          price: schemaPriceNumber,\n          availability: schemaAvailability\n        }\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(LayoutSingleColumn, {\n      className: css.pageRoot,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 443,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(LayoutWrapperTopbar, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 444,\n        columnNumber: 11\n      }\n    }, topbar), /*#__PURE__*/React.createElement(LayoutWrapperMain, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 445,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: css.contentWrapperForProductLayout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: css.mainColumnForProductLayout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 447,\n        columnNumber: 15\n      }\n    }, currentListing.id ? /*#__PURE__*/React.createElement(ActionBarMaybe, {\n      className: css.actionBarForProductLayout,\n      isOwnListing: isOwnListing,\n      listing: currentListing,\n      editParams: {\n        id: listingId.uuid,\n        slug: listingSlug,\n        type: listingType,\n        tab: listingTab\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 449,\n        columnNumber: 19\n      }\n    }) : null, /*#__PURE__*/React.createElement(SectionGallery, {\n      listing: currentListing,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: css.productMobileHeading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 462,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(SectionHeading, {\n      priceTitle: priceTitle,\n      formattedPrice: formattedPrice,\n      richTitle: richTitle,\n      category: category,\n      authorLink: authorLink,\n      showContactUser: showContactUser,\n      onContactUser: this.onContactUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 463,\n        columnNumber: 19\n      }\n    })), /*#__PURE__*/React.createElement(SectionDescriptionMaybe, {\n      description: description,\n      listingTitle: richTitle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 473,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(SectionDetailsMaybe, {\n      publicData: publicData,\n      customConfig: customConfig,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 474,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(SectionFeaturesMaybe, {\n      extendedDataKey: \"amenities\",\n      options: amenityOptions,\n      publicData: publicData,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 475,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(SectionRulesMaybe, {\n      publicData: publicData,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 480,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(SectionMapMaybe, {\n      geolocation: geolocation,\n      publicData: publicData,\n      listingId: currentListing.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 481,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(SectionReviews, {\n      reviews: reviews,\n      fetchReviewsError: fetchReviewsError,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 486,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(SectionAuthorMaybe, {\n      title: title,\n      listing: currentListing,\n      authorDisplayName: authorDisplayName,\n      onContactUser: this.onContactUser,\n      isEnquiryModalOpen: isAuthenticated && this.state.enquiryModalOpen,\n      onCloseEnquiryModal: () => this.setState({\n        enquiryModalOpen: false\n      }),\n      sendEnquiryError: sendEnquiryError,\n      sendEnquiryInProgress: sendEnquiryInProgress,\n      onSubmitEnquiry: this.onSubmitEnquiry,\n      currentUser: currentUser,\n      onManageDisableScrolling: onManageDisableScrolling,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: css.orderColumnForProductLayout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 501,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(OrderPanel, {\n      className: css.productOrderPanel,\n      listing: currentListing,\n      isOwnListing: isOwnListing,\n      unitType: unitType,\n      onSubmit: handleOrderSubmit,\n      title: bookingTitle,\n      author: ensuredAuthor,\n      onManageDisableScrolling: onManageDisableScrolling,\n      onContactUser: this.onContactUser,\n      timeSlots: timeSlots,\n      fetchTimeSlotsError: fetchTimeSlotsError,\n      onFetchTransactionLineItems: onFetchTransactionLineItems,\n      lineItems: lineItems,\n      fetchLineItemsInProgress: fetchLineItemsInProgress,\n      fetchLineItemsError: fetchLineItemsError,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 502,\n        columnNumber: 17\n      }\n    })))), /*#__PURE__*/React.createElement(LayoutWrapperFooter, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 522,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Footer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 523,\n        columnNumber: 13\n      }\n    }))));\n  }\n\n}\nListingPageComponent.defaultProps = {\n  unitType: config.lineItemUnitType,\n  currentUser: null,\n  enquiryModalOpenForListingId: null,\n  showListingError: null,\n  reviews: [],\n  fetchReviewsError: null,\n  timeSlots: null,\n  fetchTimeSlotsError: null,\n  sendEnquiryError: null,\n  customConfig: config.custom,\n  lineItems: null,\n  fetchLineItemsError: null\n};\nListingPageComponent.propTypes = {\n  // from withRouter\n  history: shape({\n    push: func.isRequired\n  }).isRequired,\n  location: shape({\n    search: string\n  }).isRequired,\n  unitType: propTypes.lineItemUnitType,\n  // from injectIntl\n  intl: intlShape.isRequired,\n  params: shape({\n    id: string.isRequired,\n    slug: string,\n    variant: oneOf([LISTING_PAGE_DRAFT_VARIANT, LISTING_PAGE_PENDING_APPROVAL_VARIANT])\n  }).isRequired,\n  isAuthenticated: bool.isRequired,\n  currentUser: propTypes.currentUser,\n  getListing: func.isRequired,\n  getOwnListing: func.isRequired,\n  onManageDisableScrolling: func.isRequired,\n  scrollingDisabled: bool.isRequired,\n  enquiryModalOpenForListingId: string,\n  showListingError: propTypes.error,\n  callSetInitialValues: func.isRequired,\n  reviews: arrayOf(propTypes.review),\n  fetchReviewsError: propTypes.error,\n  timeSlots: arrayOf(propTypes.timeSlot),\n  fetchTimeSlotsError: propTypes.error,\n  sendEnquiryInProgress: bool.isRequired,\n  sendEnquiryError: propTypes.error,\n  onSendEnquiry: func.isRequired,\n  onInitializeCardPaymentData: func.isRequired,\n  customConfig: object,\n  onFetchTransactionLineItems: func.isRequired,\n  lineItems: array,\n  fetchLineItemsInProgress: bool.isRequired,\n  fetchLineItemsError: propTypes.error\n};\n\nconst mapStateToProps = state => {\n  const {\n    isAuthenticated\n  } = state.Auth;\n  const {\n    showListingError,\n    reviews,\n    fetchReviewsError,\n    timeSlots,\n    fetchTimeSlotsError,\n    sendEnquiryInProgress,\n    sendEnquiryError,\n    lineItems,\n    fetchLineItemsInProgress,\n    fetchLineItemsError,\n    enquiryModalOpenForListingId\n  } = state.ListingPage;\n  const {\n    currentUser\n  } = state.user;\n\n  const getListing = id => {\n    const ref = {\n      id,\n      type: 'listing'\n    };\n    const listings = getMarketplaceEntities(state, [ref]);\n    return listings.length === 1 ? listings[0] : null;\n  };\n\n  const getOwnListing = id => {\n    const ref = {\n      id,\n      type: 'ownListing'\n    };\n    const listings = getMarketplaceEntities(state, [ref]);\n    return listings.length === 1 ? listings[0] : null;\n  };\n\n  return {\n    isAuthenticated,\n    currentUser,\n    getListing,\n    getOwnListing,\n    scrollingDisabled: isScrollingDisabled(state),\n    enquiryModalOpenForListingId,\n    showListingError,\n    reviews,\n    fetchReviewsError,\n    timeSlots,\n    fetchTimeSlotsError,\n    lineItems,\n    fetchLineItemsInProgress,\n    fetchLineItemsError,\n    sendEnquiryInProgress,\n    sendEnquiryError\n  };\n};\n\nconst mapDispatchToProps = dispatch => ({\n  onManageDisableScrolling: (componentId, disableScrolling) => dispatch(manageDisableScrolling(componentId, disableScrolling)),\n  callSetInitialValues: (setInitialValues, values, saveToSessionStorage) => dispatch(setInitialValues(values, saveToSessionStorage)),\n  onFetchTransactionLineItems: (orderData, listingId, isOwnListing) => dispatch(fetchTransactionLineItems(orderData, listingId, isOwnListing)),\n  onSendEnquiry: (listingId, message) => dispatch(sendEnquiry(listingId, message)),\n  onInitializeCardPaymentData: () => dispatch(initializeCardPaymentData())\n}); // Note: it is important that the withRouter HOC is **outside** the\n// connect HOC, otherwise React Router won't rerender any Route\n// components since connect implements a shouldComponentUpdate\n// lifecycle hook.\n//\n// See: https://github.com/ReactTraining/react-router/issues/4671\n\n\nconst ListingPage = compose(withRouter, connect(mapStateToProps, mapDispatchToProps), injectIntl)(ListingPageComponent);\nexport default ListingPage;","map":{"version":3,"sources":["D:/Amardeep/tarek_project/ftw-product/src/containers/ListingPage/ListingPageFullImage.js"],"names":["React","Component","array","arrayOf","bool","func","shape","string","oneOf","object","compose","connect","withRouter","config","routeConfiguration","FormattedMessage","intlShape","injectIntl","findOptionsForSelectFilter","LISTING_STATE_PENDING_APPROVAL","LISTING_STATE_CLOSED","propTypes","types","sdkTypes","LISTING_PAGE_DRAFT_VARIANT","LISTING_PAGE_PENDING_APPROVAL_VARIANT","LISTING_PAGE_PARAM_TYPE_DRAFT","LISTING_PAGE_PARAM_TYPE_EDIT","createSlug","formatMoney","convertMoneyToNumber","createResourceLocatorString","findRouteByRouteName","ensureListing","ensureOwnListing","ensureUser","userDisplayNameAsString","richText","getMarketplaceEntities","manageDisableScrolling","isScrollingDisabled","initializeCardPaymentData","Page","NamedLink","NamedRedirect","LayoutSingleColumn","LayoutWrapperTopbar","LayoutWrapperMain","LayoutWrapperFooter","Footer","OrderPanel","TopbarContainer","NotFoundPage","sendEnquiry","fetchTransactionLineItems","setInitialValues","SectionAvatar","ActionBarMaybe","SectionHeading","SectionDescriptionMaybe","SectionDetailsMaybe","SectionFeaturesMaybe","SectionReviews","SectionAuthorMaybe","SectionRulesMaybe","SectionMapMaybe","SectionGallery","css","MIN_LENGTH_FOR_LONG_WORDS_IN_TITLE","UUID","priceData","price","intl","currency","formattedPrice","priceTitle","categoryLabel","categories","key","cat","find","c","label","ListingPageComponent","constructor","props","enquiryModalOpenForListingId","params","state","pageClassNames","imageCarouselOpen","enquiryModalOpen","id","handleSubmit","bind","onContactUser","onSubmitEnquiry","values","history","getListing","callSetInitialValues","onInitializeCardPaymentData","listingId","listing","bookingDates","quantity","quantityRaw","deliveryMethod","otherOrderData","bookingDatesMaybe","bookingStart","startDate","bookingEnd","endDate","initialValues","orderData","Number","parseInt","confirmPaymentError","saveToSessionStorage","currentUser","routes","push","uuid","slug","attributes","title","location","from","pathname","search","hash","setState","onSendEnquiry","message","trim","then","txId","catch","render","unitType","isAuthenticated","getOwnListing","onManageDisableScrolling","rawParams","scrollingDisabled","showListingError","reviews","fetchReviewsError","sendEnquiryInProgress","sendEnquiryError","timeSlots","fetchTimeSlotsError","customConfig","onFetchTransactionLineItems","lineItems","fetchLineItemsInProgress","fetchLineItemsError","isPendingApprovalVariant","variant","isDraftVariant","currentListing","listingSlug","listingType","listingTab","isApproved","pendingIsApproved","pendingOtherUsersListing","status","shouldShowPublicListingPage","description","geolocation","publicData","richTitle","longWordMinLength","longWordClass","longWord","bookingTitle","topbar","errorTitle","formatMessage","pageRoot","errorText","loadingTitle","loadingText","handleViewPhotosClick","e","stopPropagation","authorAvailable","author","userAndListingAuthorAvailable","isOwnListing","showContactUser","currentAuthor","ensuredAuthor","authorDisplayName","handleOrderSubmit","isCurrentlyClosed","window","scrollTo","listingImages","variantName","images","map","image","variants","sizes","size","i","name","filter","facebookImages","twitterImages","schemaImages","variantPrefix","img","url","siteTitle","schemaTitle","productURL","canonicalRootURL","brand","brandMaybe","schemaPriceNumber","formatNumber","minimumFractionDigits","maximumFractionDigits","currentStock","schemaAvailability","authorLink","authorNameLink","amenityOptions","filters","categoryOptions","category","separator","offers","priceCurrency","availability","contentWrapperForProductLayout","mainColumnForProductLayout","actionBarForProductLayout","type","tab","productMobileHeading","orderColumnForProductLayout","productOrderPanel","defaultProps","lineItemUnitType","custom","isRequired","error","review","timeSlot","mapStateToProps","Auth","ListingPage","user","ref","listings","length","mapDispatchToProps","dispatch","componentId","disableScrolling"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,KAAT,EAAgBC,OAAhB,EAAyBC,IAAzB,EAA+BC,IAA/B,EAAqCC,KAArC,EAA4CC,MAA5C,EAAoDC,KAApD,EAA2DC,MAA3D,QAAyE,YAAzE;AACA,SAASC,OAAT,QAAwB,OAAxB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AAEA,OAAOC,MAAP,MAAmB,cAAnB;AACA,OAAOC,kBAAP,MAA+B,kCAA/B;AACA,SAASC,gBAAT,EAA2BC,SAA3B,EAAsCC,UAAtC,QAAwD,sBAAxD;AACA,SAASC,0BAAT,QAA2C,mBAA3C;AACA,SAASC,8BAAT,EAAyCC,oBAAzC,EAA+DC,SAA/D,QAAgF,kBAAhF;AACA,SAASC,KAAK,IAAIC,QAAlB,QAAkC,sBAAlC;AACA,SACEC,0BADF,EAEEC,qCAFF,EAGEC,6BAHF,EAIEC,4BAJF,EAKEC,UALF,QAMO,uBANP;AAOA,SAASC,WAAT,EAAsBC,oBAAtB,QAAkD,qBAAlD;AACA,SAASC,2BAAT,EAAsCC,oBAAtC,QAAkE,mBAAlE;AACA,SACEC,aADF,EAEEC,gBAFF,EAGEC,UAHF,EAIEC,uBAJF,QAKO,iBALP;AAMA,SAASC,QAAT,QAAyB,qBAAzB;AACA,SAASC,sBAAT,QAAuC,kCAAvC;AACA,SAASC,sBAAT,EAAiCC,mBAAjC,QAA4D,qBAA5D;AACA,SAASC,yBAAT,QAA0C,4BAA1C;AAEA,SACEC,IADF,EAEEC,SAFF,EAGEC,aAHF,EAIEC,kBAJF,EAKEC,mBALF,EAMEC,iBANF,EAOEC,mBAPF,EAQEC,MARF,EASEC,UATF,QAUO,kBAVP;AAWA,OAAOC,eAAP,MAA4B,kDAA5B;AACA,OAAOC,YAAP,MAAyB,4CAAzB;AAEA,SAASC,WAAT,EAAsBC,yBAAtB,EAAiDC,gBAAjD,QAAyE,oBAAzE;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,uBAAP,MAAoC,2BAApC;AACA,OAAOC,mBAAP,MAAgC,uBAAhC;AACA,OAAOC,oBAAP,MAAiC,wBAAjC;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,kBAAP,MAA+B,sBAA/B;AACA,OAAOC,iBAAP,MAA8B,qBAA9B;AACA,OAAOC,eAAP,MAA4B,mBAA5B;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AAEA,OAAOC,GAAP,MAAgB,0BAAhB;AAEA,MAAMC,kCAAkC,GAAG,EAA3C;AAEA,MAAM;AAAEC,EAAAA;AAAF,IAAW9C,QAAjB;;AAEA,MAAM+C,SAAS,GAAG,CAACC,KAAD,EAAQC,IAAR,KAAiB;AACjC,MAAID,KAAK,IAAIA,KAAK,CAACE,QAAN,KAAmB5D,MAAM,CAAC4D,QAAvC,EAAiD;AAC/C,UAAMC,cAAc,GAAG7C,WAAW,CAAC2C,IAAD,EAAOD,KAAP,CAAlC;AACA,WAAO;AAAEG,MAAAA,cAAF;AAAkBC,MAAAA,UAAU,EAAED;AAA9B,KAAP;AACD,GAHD,MAGO,IAAIH,KAAJ,EAAW;AAChB,WAAO;AACLG,MAAAA,cAAc,EAAG,IAAGH,KAAK,CAACE,QAAS,GAD9B;AAELE,MAAAA,UAAU,EAAG,yBAAwBJ,KAAK,CAACE,QAAS;AAF/C,KAAP;AAID;;AACD,SAAO,EAAP;AACD,CAXD;;AAaA,MAAMG,aAAa,GAAG,CAACC,UAAD,EAAaC,GAAb,KAAqB;AACzC,QAAMC,GAAG,GAAGF,UAAU,CAACG,IAAX,CAAgBC,CAAC,IAAIA,CAAC,CAACH,GAAF,KAAUA,GAA/B,CAAZ;AACA,SAAOC,GAAG,GAAGA,GAAG,CAACG,KAAP,GAAeJ,GAAzB;AACD,CAHD;;AAKA,OAAO,MAAMK,oBAAN,SAAmClF,SAAnC,CAA6C;AAClDmF,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,UAAM;AAAEC,MAAAA,4BAAF;AAAgCC,MAAAA;AAAhC,QAA2CF,KAAjD;AACA,SAAKG,KAAL,GAAa;AACXC,MAAAA,cAAc,EAAE,EADL;AAEXC,MAAAA,iBAAiB,EAAE,KAFR;AAGXC,MAAAA,gBAAgB,EAAEL,4BAA4B,KAAKC,MAAM,CAACK;AAH/C,KAAb;AAMA,SAAKC,YAAL,GAAoB,KAAKA,YAAL,CAAkBC,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKC,aAAL,GAAqB,KAAKA,aAAL,CAAmBD,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKE,eAAL,GAAuB,KAAKA,eAAL,CAAqBF,IAArB,CAA0B,IAA1B,CAAvB;AACD;;AAEDD,EAAAA,YAAY,CAACI,MAAD,EAAS;AACnB,UAAM;AACJC,MAAAA,OADI;AAEJC,MAAAA,UAFI;AAGJZ,MAAAA,MAHI;AAIJa,MAAAA,oBAJI;AAKJC,MAAAA;AALI,QAMF,KAAKhB,KANT;AAOA,UAAMiB,SAAS,GAAG,IAAIjC,IAAJ,CAASkB,MAAM,CAACK,EAAhB,CAAlB;AACA,UAAMW,OAAO,GAAGJ,UAAU,CAACG,SAAD,CAA1B;AAEA,UAAM;AAAEE,MAAAA,YAAF;AAAgBC,MAAAA,QAAQ,EAAEC,WAA1B;AAAuCC,MAAAA,cAAvC;AAAuD,SAAGC;AAA1D,QAA6EX,MAAnF;AACA,UAAMY,iBAAiB,GAAGL,YAAY,GAClC;AACEA,MAAAA,YAAY,EAAE;AACZM,QAAAA,YAAY,EAAEN,YAAY,CAACO,SADf;AAEZC,QAAAA,UAAU,EAAER,YAAY,CAACS;AAFb;AADhB,KADkC,GAOlC,EAPJ;AASA,UAAMC,aAAa,GAAG;AACpBX,MAAAA,OADoB;AAEpBY,MAAAA,SAAS,EAAE,EACT,GAAGN,iBADM;AAETJ,QAAAA,QAAQ,EAAEW,MAAM,CAACC,QAAP,CAAgBX,WAAhB,EAA6B,EAA7B,CAFD;AAGTC,QAAAA,cAHS;AAIT,WAAGC;AAJM,OAFS;AAQpBU,MAAAA,mBAAmB,EAAE;AARD,KAAtB;AAWA,UAAMC,oBAAoB,GAAG,CAAC,KAAKlC,KAAL,CAAWmC,WAAzC;AAEA,UAAMC,MAAM,GAAG3G,kBAAkB,EAAjC,CAlCmB,CAmCnB;;AACA,UAAM;AAAEyC,MAAAA;AAAF,QAAuBvB,oBAAoB,CAAC,cAAD,EAAiByF,MAAjB,CAAjD;AAEArB,IAAAA,oBAAoB,CAAC7C,gBAAD,EAAmB2D,aAAnB,EAAkCK,oBAAlC,CAApB,CAtCmB,CAwCnB;;AACAlB,IAAAA,2BAA2B,GAzCR,CA2CnB;;AACAH,IAAAA,OAAO,CAACwB,IAAR,CACE3F,2BAA2B,CACzB,cADyB,EAEzB0F,MAFyB,EAGzB;AAAE7B,MAAAA,EAAE,EAAEW,OAAO,CAACX,EAAR,CAAW+B,IAAjB;AAAuBC,MAAAA,IAAI,EAAEhG,UAAU,CAAC2E,OAAO,CAACsB,UAAR,CAAmBC,KAApB;AAAvC,KAHyB,EAIzB,EAJyB,CAD7B;AAQD;;AAED/B,EAAAA,aAAa,GAAG;AACd,UAAM;AAAEyB,MAAAA,WAAF;AAAetB,MAAAA,OAAf;AAAwBE,MAAAA,oBAAxB;AAA8Cb,MAAAA,MAA9C;AAAsDwC,MAAAA;AAAtD,QAAmE,KAAK1C,KAA9E;;AAEA,QAAI,CAACmC,WAAL,EAAkB;AAChB,YAAMhC,KAAK,GAAG;AAAEwC,QAAAA,IAAI,EAAG,GAAED,QAAQ,CAACE,QAAS,GAAEF,QAAQ,CAACG,MAAO,GAAEH,QAAQ,CAACI,IAAK;AAA/D,OAAd,CADgB,CAGhB;AACA;;AACA/B,MAAAA,oBAAoB,CAAC7C,gBAAD,EAAmB;AAAE+B,QAAAA,4BAA4B,EAAEC,MAAM,CAACK;AAAvC,OAAnB,CAApB,CALgB,CAOhB;;AACAM,MAAAA,OAAO,CAACwB,IAAR,CAAa3F,2BAA2B,CAAC,YAAD,EAAejB,kBAAkB,EAAjC,EAAqC,EAArC,EAAyC,EAAzC,CAAxC,EAAsF0E,KAAtF;AACD,KATD,MASO;AACL,WAAK4C,QAAL,CAAc;AAAEzC,QAAAA,gBAAgB,EAAE;AAApB,OAAd;AACD;AACF;;AAEDK,EAAAA,eAAe,CAACC,MAAD,EAAS;AACtB,UAAM;AAAEC,MAAAA,OAAF;AAAWX,MAAAA,MAAX;AAAmB8C,MAAAA;AAAnB,QAAqC,KAAKhD,KAAhD;AACA,UAAMoC,MAAM,GAAG3G,kBAAkB,EAAjC;AACA,UAAMwF,SAAS,GAAG,IAAIjC,IAAJ,CAASkB,MAAM,CAACK,EAAhB,CAAlB;AACA,UAAM;AAAE0C,MAAAA;AAAF,QAAcrC,MAApB;AAEAoC,IAAAA,aAAa,CAAC/B,SAAD,EAAYgC,OAAO,CAACC,IAAR,EAAZ,CAAb,CACGC,IADH,CACQC,IAAI,IAAI;AACZ,WAAKL,QAAL,CAAc;AAAEzC,QAAAA,gBAAgB,EAAE;AAApB,OAAd,EADY,CAGZ;;AACAO,MAAAA,OAAO,CAACwB,IAAR,CACE3F,2BAA2B,CAAC,kBAAD,EAAqB0F,MAArB,EAA6B;AAAE7B,QAAAA,EAAE,EAAE6C,IAAI,CAACd;AAAX,OAA7B,EAAgD,EAAhD,CAD7B;AAGD,KARH,EASGe,KATH,CASS,MAAM,CACX;AACD,KAXH;AAYD;;AAEDC,EAAAA,MAAM,GAAG;AAAA;;AACP,UAAM;AACJC,MAAAA,QADI;AAEJC,MAAAA,eAFI;AAGJrB,MAAAA,WAHI;AAIJrB,MAAAA,UAJI;AAKJ2C,MAAAA,aALI;AAMJtE,MAAAA,IANI;AAOJuE,MAAAA,wBAPI;AAQJxD,MAAAA,MAAM,EAAEyD,SARJ;AASJjB,MAAAA,QATI;AAUJkB,MAAAA,iBAVI;AAWJC,MAAAA,gBAXI;AAYJC,MAAAA,OAZI;AAaJC,MAAAA,iBAbI;AAcJC,MAAAA,qBAdI;AAeJC,MAAAA,gBAfI;AAgBJC,MAAAA,SAhBI;AAiBJC,MAAAA,mBAjBI;AAkBJC,MAAAA,YAlBI;AAmBJC,MAAAA,2BAnBI;AAoBJC,MAAAA,SApBI;AAqBJC,MAAAA,wBArBI;AAsBJC,MAAAA;AAtBI,QAuBF,KAAKxE,KAvBT;AAyBA,UAAMiB,SAAS,GAAG,IAAIjC,IAAJ,CAAS2E,SAAS,CAACpD,EAAnB,CAAlB;AACA,UAAMkE,wBAAwB,GAAGd,SAAS,CAACe,OAAV,KAAsBtI,qCAAvD;AACA,UAAMuI,cAAc,GAAGhB,SAAS,CAACe,OAAV,KAAsBvI,0BAA7C;AACA,UAAMyI,cAAc,GAClBH,wBAAwB,IAAIE,cAA5B,GACI9H,gBAAgB,CAAC4G,aAAa,CAACxC,SAAD,CAAd,CADpB,GAEIrE,aAAa,CAACkE,UAAU,CAACG,SAAD,CAAX,CAHnB;AAKA,UAAM4D,WAAW,GAAGlB,SAAS,CAACpB,IAAV,IAAkBhG,UAAU,CAACqI,cAAc,CAACpC,UAAf,CAA0BC,KAA1B,IAAmC,EAApC,CAAhD;AACA,UAAMvC,MAAM,GAAG;AAAEqC,MAAAA,IAAI,EAAEsC,WAAR;AAAqB,SAAGlB;AAAxB,KAAf;AAEA,UAAMmB,WAAW,GAAGH,cAAc,GAC9BtI,6BAD8B,GAE9BC,4BAFJ;AAGA,UAAMyI,UAAU,GAAGJ,cAAc,GAAG,QAAH,GAAc,SAA/C;AAEA,UAAMK,UAAU,GACdJ,cAAc,CAACrE,EAAf,IAAqBqE,cAAc,CAACpC,UAAf,CAA0BrC,KAA1B,KAAoCrE,8BAD3D;AAGA,UAAMmJ,iBAAiB,GAAGR,wBAAwB,IAAIO,UAAtD,CA7CO,CA+CP;AACA;AACA;AACA;AACA;;AACA,UAAME,wBAAwB,GAC5B,CAACT,wBAAwB,IAAIE,cAA7B,KACAd,gBADA,IAEAA,gBAAgB,CAACsB,MAAjB,KAA4B,GAH9B;AAIA,UAAMC,2BAA2B,GAAGH,iBAAiB,IAAIC,wBAAzD;;AAEA,QAAIE,2BAAJ,EAAiC;AAC/B,0BAAO,oBAAC,aAAD;AAAe,QAAA,IAAI,EAAC,aAApB;AAAkC,QAAA,MAAM,EAAElF,MAA1C;AAAkD,QAAA,MAAM,EAAEwC,QAAQ,CAACG,MAAnE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AACD;;AAED,UAAM;AACJwC,MAAAA,WAAW,GAAG,EADV;AAEJC,MAAAA,WAAW,GAAG,IAFV;AAGJpG,MAAAA,KAAK,GAAG,IAHJ;AAIJuD,MAAAA,KAAK,GAAG,EAJJ;AAKJ8C,MAAAA;AALI,QAMFX,cAAc,CAACpC,UANnB;AAQA,UAAMgD,SAAS,gBACb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACGxI,QAAQ,CAACyF,KAAD,EAAQ;AACfgD,MAAAA,iBAAiB,EAAE1G,kCADJ;AAEf2G,MAAAA,aAAa,EAAE5G,GAAG,CAAC6G;AAFJ,KAAR,CADX,CADF;AASA,UAAMC,YAAY,gBAChB,oBAAC,gBAAD;AAAkB,MAAA,EAAE,EAAC,0BAArB;AAAgD,MAAA,MAAM,EAAE;AAAEnD,QAAAA,KAAK,EAAE+C;AAAT,OAAxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF;AAIA,UAAMK,MAAM,gBAAG,oBAAC,eAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAf;;AAEA,QAAIhC,gBAAgB,IAAIA,gBAAgB,CAACsB,MAAjB,KAA4B,GAApD,EAAyD;AACvD;AAEA,0BAAO,oBAAC,YAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AACD,KAJD,MAIO,IAAItB,gBAAJ,EAAsB;AAC3B;AAEA,YAAMiC,UAAU,GAAG3G,IAAI,CAAC4G,aAAL,CAAmB;AACpCxF,QAAAA,EAAE,EAAE;AADgC,OAAnB,CAAnB;AAIA,0BACE,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAEuF,UAAb;AAAyB,QAAA,iBAAiB,EAAElC,iBAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,kBAAD;AAAoB,QAAA,SAAS,EAAE9E,GAAG,CAACkH,QAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAsBH,MAAtB,CADF,eAEE,oBAAC,iBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAG,QAAA,SAAS,EAAE/G,GAAG,CAACmH,SAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,gBAAD;AAAkB,QAAA,EAAE,EAAC,wCAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CADF,CAFF,eAOE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAPF,CADF,CADF;AAeD,KAtBM,MAsBA,IAAI,CAACrB,cAAc,CAACrE,EAApB,EAAwB;AAC7B;AAEA,YAAM2F,YAAY,GAAG/G,IAAI,CAAC4G,aAAL,CAAmB;AACtCxF,QAAAA,EAAE,EAAE;AADkC,OAAnB,CAArB;AAIA,0BACE,oBAAC,IAAD;AAAM,QAAA,KAAK,EAAE2F,YAAb;AAA2B,QAAA,iBAAiB,EAAEtC,iBAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,kBAAD;AAAoB,QAAA,SAAS,EAAE9E,GAAG,CAACkH,QAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAsBH,MAAtB,CADF,eAEE,oBAAC,iBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAG,QAAA,SAAS,EAAE/G,GAAG,CAACqH,WAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,gBAAD;AAAkB,QAAA,EAAE,EAAC,mCAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CADF,CAFF,eAOE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAPF,CADF,CADF;AAeD;;AAED,UAAMC,qBAAqB,GAAGC,CAAC,IAAI;AACjC;AACA;AACAA,MAAAA,CAAC,CAACC,eAAF;AACA,WAAKvD,QAAL,CAAc;AACZ1C,QAAAA,iBAAiB,EAAE;AADP,OAAd;AAGD,KAPD;;AAQA,UAAMkG,eAAe,GAAG3B,cAAc,IAAIA,cAAc,CAAC4B,MAAzD;AACA,UAAMC,6BAA6B,GAAG,CAAC,EAAEtE,WAAW,IAAIoE,eAAjB,CAAvC;AACA,UAAMG,YAAY,GAChBD,6BAA6B,IAAI7B,cAAc,CAAC4B,MAAf,CAAsBjG,EAAtB,CAAyB+B,IAAzB,KAAkCH,WAAW,CAAC5B,EAAZ,CAAe+B,IADpF;AAEA,UAAMqE,eAAe,GAAGJ,eAAe,KAAK,CAACpE,WAAD,IAAiBA,WAAW,IAAI,CAACuE,YAAtC,CAAvC;AAEA,UAAME,aAAa,GAAGL,eAAe,GAAG3B,cAAc,CAAC4B,MAAlB,GAA2B,IAAhE;AACA,UAAMK,aAAa,GAAG/J,UAAU,CAAC8J,aAAD,CAAhC,CAtJO,CAwJP;AACA;AACA;;AACA,UAAME,iBAAiB,GAAG/J,uBAAuB,CAAC8J,aAAD,EAAgB,EAAhB,CAAjD;AAEA,UAAM;AAAExH,MAAAA,cAAF;AAAkBC,MAAAA;AAAlB,QAAiCL,SAAS,CAACC,KAAD,EAAQC,IAAR,CAAhD;;AAEA,UAAM4H,iBAAiB,GAAGnG,MAAM,IAAI;AAClC,YAAMoG,iBAAiB,GAAGpC,cAAc,CAACpC,UAAf,CAA0BrC,KAA1B,KAAoCpE,oBAA9D;;AACA,UAAI2K,YAAY,IAAIM,iBAApB,EAAuC;AACrCC,QAAAA,MAAM,CAACC,QAAP,CAAgB,CAAhB,EAAmB,CAAnB;AACD,OAFD,MAEO;AACL,aAAK1G,YAAL,CAAkBI,MAAlB;AACD;AACF,KAPD;;AASA,UAAMuG,aAAa,GAAG,CAACjG,OAAD,EAAUkG,WAAV,KACpB,CAAClG,OAAO,CAACmG,MAAR,IAAkB,EAAnB,EACGC,GADH,CACOC,KAAK,IAAI;AACZ,YAAMC,QAAQ,GAAGD,KAAK,CAAC/E,UAAN,CAAiBgF,QAAlC;AACA,YAAM9C,OAAO,GAAG8C,QAAQ,GAAGA,QAAQ,CAACJ,WAAD,CAAX,GAA2B,IAAnD,CAFY,CAIZ;AACA;;AACA,YAAMK,KAAK,GAAGF,KAAK,CAAC/E,UAAN,CAAiBiF,KAA/B;AACA,YAAMC,IAAI,GAAGD,KAAK,GAAGA,KAAK,CAAC9H,IAAN,CAAWgI,CAAC,IAAIA,CAAC,CAACC,IAAF,KAAWR,WAA3B,CAAH,GAA6C,IAA/D;AAEA,aAAO1C,OAAO,IAAIgD,IAAlB;AACD,KAXH,EAYGG,MAZH,CAYUnD,OAAO,IAAIA,OAAO,IAAI,IAZhC,CADF;;AAeA,UAAMoD,cAAc,GAAGX,aAAa,CAACvC,cAAD,EAAiB,UAAjB,CAApC;AACA,UAAMmD,aAAa,GAAGZ,aAAa,CAACvC,cAAD,EAAiB,SAAjB,CAAnC;AACA,UAAMoD,YAAY,GAAGb,aAAa,CAACvC,cAAD,EAAkB,GAAEpJ,MAAM,CAAC0F,OAAP,CAAe+G,aAAc,KAAjD,CAAb,CAAoEX,GAApE,CACnBY,GAAG,IAAIA,GAAG,CAACC,GADQ,CAArB;AAGA,UAAMC,SAAS,GAAG5M,MAAM,CAAC4M,SAAzB;AACA,UAAMC,WAAW,GAAGlJ,IAAI,CAAC4G,aAAL,CAClB;AAAExF,MAAAA,EAAE,EAAE;AAAN,KADkB,EAElB;AAAEkC,MAAAA,KAAF;AAASvD,MAAAA,KAAK,EAAEG,cAAhB;AAAgC+I,MAAAA;AAAhC,KAFkB,CAApB,CA7LO,CAiMP;AACA;AACA;;AACA,UAAME,UAAU,GAAI,GAAE9M,MAAM,CAAC+M,gBAAiB,GAAE7F,QAAQ,CAACE,QAAS,GAAEF,QAAQ,CAACG,MAAO,GAAEH,QAAQ,CAACI,IAAK,EAApG;AACA,UAAM0F,KAAK,GAAG5D,cAAH,aAAGA,cAAH,gDAAGA,cAAc,CAAEpC,UAAnB,oFAAG,sBAA4B+C,UAA/B,2DAAG,uBAAwCiD,KAAtD;AACA,UAAMC,UAAU,GAAGD,KAAK,GAAG;AAAEA,MAAAA,KAAK,EAAE;AAAE,iBAAS,OAAX;AAAoBZ,QAAAA,IAAI,EAAEY;AAA1B;AAAT,KAAH,GAAkD,EAA1E;AACA,UAAME,iBAAiB,GAAGvJ,IAAI,CAACwJ,YAAL,CAAkBlM,oBAAoB,CAACyC,KAAD,CAAtC,EAA+C;AACvE0J,MAAAA,qBAAqB,EAAE,CADgD;AAEvEC,MAAAA,qBAAqB,EAAE;AAFgD,KAA/C,CAA1B;AAIA,UAAMC,YAAY,GAAG,0BAAAlE,cAAc,CAACkE,YAAf,0GAA6BtG,UAA7B,kFAAyCpB,QAAzC,KAAqD,CAA1E;AACA,UAAM2H,kBAAkB,GACtBD,YAAY,GAAG,CAAf,GAAmB,4BAAnB,GAAkD,+BADpD;AAGA,UAAME,UAAU,gBACd,oBAAC,SAAD;AACE,MAAA,SAAS,EAAElK,GAAG,CAACmK,cADjB;AAEE,MAAA,IAAI,EAAC,aAFP;AAGE,MAAA,MAAM,EAAE/I,MAHV;AAIE,MAAA,EAAE,EAAE;AAAE4C,QAAAA,IAAI,EAAE;AAAR,OAJN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAMGgE,iBANH,CADF;AAWA,UAAMoC,cAAc,GAAGrN,0BAA0B,CAAC,WAAD,EAAcuI,YAAY,CAAC+E,OAA3B,CAAjD;AACA,UAAMC,eAAe,GAAGvN,0BAA0B,CAAC,UAAD,EAAauI,YAAY,CAAC+E,OAA1B,CAAlD;AACA,UAAME,QAAQ,GACZ9D,UAAU,IAAIA,UAAU,CAAC8D,QAAzB,gBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG9J,aAAa,CAAC6J,eAAD,EAAkB7D,UAAU,CAAC8D,QAA7B,CADhB,eAEE;AAAM,MAAA,SAAS,EAAEvK,GAAG,CAACwK,SAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,CADF,GAKI,IANN;AAQA,wBACE,oBAAC,IAAD;AACE,MAAA,KAAK,EAAEjB,WADT;AAEE,MAAA,iBAAiB,EAAEzE,iBAFrB;AAGE,MAAA,MAAM,EAAEkD,iBAHV;AAIE,MAAA,WAAW,EAAC,SAJd;AAKE,MAAA,WAAW,EAAEzB,WALf;AAME,MAAA,cAAc,EAAEyC,cANlB;AAOE,MAAA,aAAa,EAAEC,aAPjB;AAQE,MAAA,MAAM,EAAE;AACN,oBAAY,mBADN;AAEN,iBAAS,SAFH;AAGN1C,QAAAA,WAAW,EAAEA,WAHP;AAINuC,QAAAA,IAAI,EAAES,WAJA;AAKNd,QAAAA,KAAK,EAAES,YALD;AAMN,WAAGS,UANG;AAONc,QAAAA,MAAM,EAAE;AACN,mBAAS,OADH;AAENpB,UAAAA,GAAG,EAAEG,UAFC;AAGNkB,UAAAA,aAAa,EAAEtK,KAAK,CAACE,QAHf;AAINF,UAAAA,KAAK,EAAEwJ,iBAJD;AAKNe,UAAAA,YAAY,EAAEV;AALR;AAPF,OARV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAwBE,oBAAC,kBAAD;AAAoB,MAAA,SAAS,EAAEjK,GAAG,CAACkH,QAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAsBH,MAAtB,CADF,eAEE,oBAAC,iBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAE/G,GAAG,CAAC4K,8BAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAK,MAAA,SAAS,EAAE5K,GAAG,CAAC6K,0BAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG/E,cAAc,CAACrE,EAAf,gBACC,oBAAC,cAAD;AACE,MAAA,SAAS,EAAEzB,GAAG,CAAC8K,yBADjB;AAEE,MAAA,YAAY,EAAElD,YAFhB;AAGE,MAAA,OAAO,EAAE9B,cAHX;AAIE,MAAA,UAAU,EAAE;AACVrE,QAAAA,EAAE,EAAEU,SAAS,CAACqB,IADJ;AAEVC,QAAAA,IAAI,EAAEsC,WAFI;AAGVgF,QAAAA,IAAI,EAAE/E,WAHI;AAIVgF,QAAAA,GAAG,EAAE/E;AAJK,OAJd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADD,GAYG,IAbN,eAcE,oBAAC,cAAD;AAAgB,MAAA,OAAO,EAAEH,cAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAdF,eAeE;AAAK,MAAA,SAAS,EAAE9F,GAAG,CAACiL,oBAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,cAAD;AACE,MAAA,UAAU,EAAEzK,UADd;AAEE,MAAA,cAAc,EAAED,cAFlB;AAGE,MAAA,SAAS,EAAEmG,SAHb;AAIE,MAAA,QAAQ,EAAE6D,QAJZ;AAKE,MAAA,UAAU,EAAEL,UALd;AAME,MAAA,eAAe,EAAErC,eANnB;AAOE,MAAA,aAAa,EAAE,KAAKjG,aAPtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAfF,eA0BE,oBAAC,uBAAD;AAAyB,MAAA,WAAW,EAAE2E,WAAtC;AAAmD,MAAA,YAAY,EAAEG,SAAjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA1BF,eA2BE,oBAAC,mBAAD;AAAqB,MAAA,UAAU,EAAED,UAAjC;AAA6C,MAAA,YAAY,EAAEnB,YAA3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA3BF,eA4BE,oBAAC,oBAAD;AACE,MAAA,eAAe,EAAC,WADlB;AAEE,MAAA,OAAO,EAAE8E,cAFX;AAGE,MAAA,UAAU,EAAE3D,UAHd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA5BF,eAiCE,oBAAC,iBAAD;AAAmB,MAAA,UAAU,EAAEA,UAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAjCF,eAkCE,oBAAC,eAAD;AACE,MAAA,WAAW,EAAED,WADf;AAEE,MAAA,UAAU,EAAEC,UAFd;AAGE,MAAA,SAAS,EAAEX,cAAc,CAACrE,EAH5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAlCF,eAuCE,oBAAC,cAAD;AAAgB,MAAA,OAAO,EAAEuD,OAAzB;AAAkC,MAAA,iBAAiB,EAAEC,iBAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAvCF,eAwCE,oBAAC,kBAAD;AACE,MAAA,KAAK,EAAEtB,KADT;AAEE,MAAA,OAAO,EAAEmC,cAFX;AAGE,MAAA,iBAAiB,EAAEkC,iBAHrB;AAIE,MAAA,aAAa,EAAE,KAAKpG,aAJtB;AAKE,MAAA,kBAAkB,EAAE8C,eAAe,IAAI,KAAKrD,KAAL,CAAWG,gBALpD;AAME,MAAA,mBAAmB,EAAE,MAAM,KAAKyC,QAAL,CAAc;AAAEzC,QAAAA,gBAAgB,EAAE;AAApB,OAAd,CAN7B;AAOE,MAAA,gBAAgB,EAAE2D,gBAPpB;AAQE,MAAA,qBAAqB,EAAED,qBARzB;AASE,MAAA,eAAe,EAAE,KAAKrD,eATxB;AAUE,MAAA,WAAW,EAAEwB,WAVf;AAWE,MAAA,wBAAwB,EAAEuB,wBAX5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAxCF,CADF,eAuDE;AAAK,MAAA,SAAS,EAAE5E,GAAG,CAACkL,2BAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,UAAD;AACE,MAAA,SAAS,EAAElL,GAAG,CAACmL,iBADjB;AAEE,MAAA,OAAO,EAAErF,cAFX;AAGE,MAAA,YAAY,EAAE8B,YAHhB;AAIE,MAAA,QAAQ,EAAEnD,QAJZ;AAKE,MAAA,QAAQ,EAAEwD,iBALZ;AAME,MAAA,KAAK,EAAEnB,YANT;AAOE,MAAA,MAAM,EAAEiB,aAPV;AAQE,MAAA,wBAAwB,EAAEnD,wBAR5B;AASE,MAAA,aAAa,EAAE,KAAKhD,aATtB;AAUE,MAAA,SAAS,EAAEwD,SAVb;AAWE,MAAA,mBAAmB,EAAEC,mBAXvB;AAYE,MAAA,2BAA2B,EAAEE,2BAZ/B;AAaE,MAAA,SAAS,EAAEC,SAbb;AAcE,MAAA,wBAAwB,EAAEC,wBAd5B;AAeE,MAAA,mBAAmB,EAAEC,mBAfvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAvDF,CADF,CAFF,eA+EE,oBAAC,mBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CA/EF,CAxBF,CADF;AA8GD;;AA5biD;AA+bpD1E,oBAAoB,CAACoK,YAArB,GAAoC;AAClC3G,EAAAA,QAAQ,EAAE/H,MAAM,CAAC2O,gBADiB;AAElChI,EAAAA,WAAW,EAAE,IAFqB;AAGlClC,EAAAA,4BAA4B,EAAE,IAHI;AAIlC4D,EAAAA,gBAAgB,EAAE,IAJgB;AAKlCC,EAAAA,OAAO,EAAE,EALyB;AAMlCC,EAAAA,iBAAiB,EAAE,IANe;AAOlCG,EAAAA,SAAS,EAAE,IAPuB;AAQlCC,EAAAA,mBAAmB,EAAE,IARa;AASlCF,EAAAA,gBAAgB,EAAE,IATgB;AAUlCG,EAAAA,YAAY,EAAE5I,MAAM,CAAC4O,MAVa;AAWlC9F,EAAAA,SAAS,EAAE,IAXuB;AAYlCE,EAAAA,mBAAmB,EAAE;AAZa,CAApC;AAeA1E,oBAAoB,CAAC9D,SAArB,GAAiC;AAC/B;AACA6E,EAAAA,OAAO,EAAE5F,KAAK,CAAC;AACboH,IAAAA,IAAI,EAAErH,IAAI,CAACqP;AADE,GAAD,CAAL,CAENA,UAJ4B;AAK/B3H,EAAAA,QAAQ,EAAEzH,KAAK,CAAC;AACd4H,IAAAA,MAAM,EAAE3H;AADM,GAAD,CAAL,CAEPmP,UAP4B;AAS/B9G,EAAAA,QAAQ,EAAEvH,SAAS,CAACmO,gBATW;AAU/B;AACAhL,EAAAA,IAAI,EAAExD,SAAS,CAAC0O,UAXe;AAa/BnK,EAAAA,MAAM,EAAEjF,KAAK,CAAC;AACZsF,IAAAA,EAAE,EAAErF,MAAM,CAACmP,UADC;AAEZ9H,IAAAA,IAAI,EAAErH,MAFM;AAGZwJ,IAAAA,OAAO,EAAEvJ,KAAK,CAAC,CAACgB,0BAAD,EAA6BC,qCAA7B,CAAD;AAHF,GAAD,CAAL,CAILiO,UAjB4B;AAmB/B7G,EAAAA,eAAe,EAAEzI,IAAI,CAACsP,UAnBS;AAoB/BlI,EAAAA,WAAW,EAAEnG,SAAS,CAACmG,WApBQ;AAqB/BrB,EAAAA,UAAU,EAAE9F,IAAI,CAACqP,UArBc;AAsB/B5G,EAAAA,aAAa,EAAEzI,IAAI,CAACqP,UAtBW;AAuB/B3G,EAAAA,wBAAwB,EAAE1I,IAAI,CAACqP,UAvBA;AAwB/BzG,EAAAA,iBAAiB,EAAE7I,IAAI,CAACsP,UAxBO;AAyB/BpK,EAAAA,4BAA4B,EAAE/E,MAzBC;AA0B/B2I,EAAAA,gBAAgB,EAAE7H,SAAS,CAACsO,KA1BG;AA2B/BvJ,EAAAA,oBAAoB,EAAE/F,IAAI,CAACqP,UA3BI;AA4B/BvG,EAAAA,OAAO,EAAEhJ,OAAO,CAACkB,SAAS,CAACuO,MAAX,CA5Be;AA6B/BxG,EAAAA,iBAAiB,EAAE/H,SAAS,CAACsO,KA7BE;AA8B/BpG,EAAAA,SAAS,EAAEpJ,OAAO,CAACkB,SAAS,CAACwO,QAAX,CA9Ba;AA+B/BrG,EAAAA,mBAAmB,EAAEnI,SAAS,CAACsO,KA/BA;AAgC/BtG,EAAAA,qBAAqB,EAAEjJ,IAAI,CAACsP,UAhCG;AAiC/BpG,EAAAA,gBAAgB,EAAEjI,SAAS,CAACsO,KAjCG;AAkC/BtH,EAAAA,aAAa,EAAEhI,IAAI,CAACqP,UAlCW;AAmC/BrJ,EAAAA,2BAA2B,EAAEhG,IAAI,CAACqP,UAnCH;AAoC/BjG,EAAAA,YAAY,EAAEhJ,MApCiB;AAqC/BiJ,EAAAA,2BAA2B,EAAErJ,IAAI,CAACqP,UArCH;AAsC/B/F,EAAAA,SAAS,EAAEzJ,KAtCoB;AAuC/B0J,EAAAA,wBAAwB,EAAExJ,IAAI,CAACsP,UAvCA;AAwC/B7F,EAAAA,mBAAmB,EAAExI,SAAS,CAACsO;AAxCA,CAAjC;;AA2CA,MAAMG,eAAe,GAAGtK,KAAK,IAAI;AAC/B,QAAM;AAAEqD,IAAAA;AAAF,MAAsBrD,KAAK,CAACuK,IAAlC;AACA,QAAM;AACJ7G,IAAAA,gBADI;AAEJC,IAAAA,OAFI;AAGJC,IAAAA,iBAHI;AAIJG,IAAAA,SAJI;AAKJC,IAAAA,mBALI;AAMJH,IAAAA,qBANI;AAOJC,IAAAA,gBAPI;AAQJK,IAAAA,SARI;AASJC,IAAAA,wBATI;AAUJC,IAAAA,mBAVI;AAWJvE,IAAAA;AAXI,MAYFE,KAAK,CAACwK,WAZV;AAaA,QAAM;AAAExI,IAAAA;AAAF,MAAkBhC,KAAK,CAACyK,IAA9B;;AAEA,QAAM9J,UAAU,GAAGP,EAAE,IAAI;AACvB,UAAMsK,GAAG,GAAG;AAAEtK,MAAAA,EAAF;AAAMsJ,MAAAA,IAAI,EAAE;AAAZ,KAAZ;AACA,UAAMiB,QAAQ,GAAG7N,sBAAsB,CAACkD,KAAD,EAAQ,CAAC0K,GAAD,CAAR,CAAvC;AACA,WAAOC,QAAQ,CAACC,MAAT,KAAoB,CAApB,GAAwBD,QAAQ,CAAC,CAAD,CAAhC,GAAsC,IAA7C;AACD,GAJD;;AAMA,QAAMrH,aAAa,GAAGlD,EAAE,IAAI;AAC1B,UAAMsK,GAAG,GAAG;AAAEtK,MAAAA,EAAF;AAAMsJ,MAAAA,IAAI,EAAE;AAAZ,KAAZ;AACA,UAAMiB,QAAQ,GAAG7N,sBAAsB,CAACkD,KAAD,EAAQ,CAAC0K,GAAD,CAAR,CAAvC;AACA,WAAOC,QAAQ,CAACC,MAAT,KAAoB,CAApB,GAAwBD,QAAQ,CAAC,CAAD,CAAhC,GAAsC,IAA7C;AACD,GAJD;;AAMA,SAAO;AACLtH,IAAAA,eADK;AAELrB,IAAAA,WAFK;AAGLrB,IAAAA,UAHK;AAIL2C,IAAAA,aAJK;AAKLG,IAAAA,iBAAiB,EAAEzG,mBAAmB,CAACgD,KAAD,CALjC;AAMLF,IAAAA,4BANK;AAOL4D,IAAAA,gBAPK;AAQLC,IAAAA,OARK;AASLC,IAAAA,iBATK;AAULG,IAAAA,SAVK;AAWLC,IAAAA,mBAXK;AAYLG,IAAAA,SAZK;AAaLC,IAAAA,wBAbK;AAcLC,IAAAA,mBAdK;AAeLR,IAAAA,qBAfK;AAgBLC,IAAAA;AAhBK,GAAP;AAkBD,CA/CD;;AAiDA,MAAM+G,kBAAkB,GAAGC,QAAQ,KAAK;AACtCvH,EAAAA,wBAAwB,EAAE,CAACwH,WAAD,EAAcC,gBAAd,KACxBF,QAAQ,CAAC/N,sBAAsB,CAACgO,WAAD,EAAcC,gBAAd,CAAvB,CAF4B;AAGtCpK,EAAAA,oBAAoB,EAAE,CAAC7C,gBAAD,EAAmB0C,MAAnB,EAA2BsB,oBAA3B,KACpB+I,QAAQ,CAAC/M,gBAAgB,CAAC0C,MAAD,EAASsB,oBAAT,CAAjB,CAJ4B;AAKtCmC,EAAAA,2BAA2B,EAAE,CAACvC,SAAD,EAAYb,SAAZ,EAAuByF,YAAvB,KAC3BuE,QAAQ,CAAChN,yBAAyB,CAAC6D,SAAD,EAAYb,SAAZ,EAAuByF,YAAvB,CAA1B,CAN4B;AAOtC1D,EAAAA,aAAa,EAAE,CAAC/B,SAAD,EAAYgC,OAAZ,KAAwBgI,QAAQ,CAACjN,WAAW,CAACiD,SAAD,EAAYgC,OAAZ,CAAZ,CAPT;AAQtCjC,EAAAA,2BAA2B,EAAE,MAAMiK,QAAQ,CAAC7N,yBAAyB,EAA1B;AARL,CAAL,CAAnC,C,CAWA;AACA;AACA;AACA;AACA;AACA;;;AACA,MAAMuN,WAAW,GAAGtP,OAAO,CACzBE,UADyB,EAEzBD,OAAO,CACLmP,eADK,EAELO,kBAFK,CAFkB,EAMzBpP,UANyB,CAAP,CAOlBkE,oBAPkB,CAApB;AASA,eAAe6K,WAAf","sourcesContent":["import React, { Component } from 'react';\r\nimport { array, arrayOf, bool, func, shape, string, oneOf, object } from 'prop-types';\r\nimport { compose } from 'redux';\r\nimport { connect } from 'react-redux';\r\nimport { withRouter } from 'react-router-dom';\r\n\r\nimport config from '../../config';\r\nimport routeConfiguration from '../../routing/routeConfiguration';\r\nimport { FormattedMessage, intlShape, injectIntl } from '../../util/reactIntl';\r\nimport { findOptionsForSelectFilter } from '../../util/search';\r\nimport { LISTING_STATE_PENDING_APPROVAL, LISTING_STATE_CLOSED, propTypes } from '../../util/types';\r\nimport { types as sdkTypes } from '../../util/sdkLoader';\r\nimport {\r\n  LISTING_PAGE_DRAFT_VARIANT,\r\n  LISTING_PAGE_PENDING_APPROVAL_VARIANT,\r\n  LISTING_PAGE_PARAM_TYPE_DRAFT,\r\n  LISTING_PAGE_PARAM_TYPE_EDIT,\r\n  createSlug,\r\n} from '../../util/urlHelpers';\r\nimport { formatMoney, convertMoneyToNumber } from '../../util/currency';\r\nimport { createResourceLocatorString, findRouteByRouteName } from '../../util/routes';\r\nimport {\r\n  ensureListing,\r\n  ensureOwnListing,\r\n  ensureUser,\r\n  userDisplayNameAsString,\r\n} from '../../util/data';\r\nimport { richText } from '../../util/richText';\r\nimport { getMarketplaceEntities } from '../../ducks/marketplaceData.duck';\r\nimport { manageDisableScrolling, isScrollingDisabled } from '../../ducks/UI.duck';\r\nimport { initializeCardPaymentData } from '../../ducks/stripe.duck.js';\r\n\r\nimport {\r\n  Page,\r\n  NamedLink,\r\n  NamedRedirect,\r\n  LayoutSingleColumn,\r\n  LayoutWrapperTopbar,\r\n  LayoutWrapperMain,\r\n  LayoutWrapperFooter,\r\n  Footer,\r\n  OrderPanel,\r\n} from '../../components';\r\nimport TopbarContainer from '../../containers/TopbarContainer/TopbarContainer';\r\nimport NotFoundPage from '../../containers/NotFoundPage/NotFoundPage';\r\n\r\nimport { sendEnquiry, fetchTransactionLineItems, setInitialValues } from './ListingPage.duck';\r\nimport SectionAvatar from './SectionAvatar';\r\nimport ActionBarMaybe from './ActionBarMaybe';\r\nimport SectionHeading from './SectionHeading';\r\nimport SectionDescriptionMaybe from './SectionDescriptionMaybe';\r\nimport SectionDetailsMaybe from './SectionDetailsMaybe';\r\nimport SectionFeaturesMaybe from './SectionFeaturesMaybe';\r\nimport SectionReviews from './SectionReviews';\r\nimport SectionAuthorMaybe from './SectionAuthorMaybe';\r\nimport SectionRulesMaybe from './SectionRulesMaybe';\r\nimport SectionMapMaybe from './SectionMapMaybe';\r\nimport SectionGallery from './SectionGallery';\r\n\r\nimport css from './ListingPage.module.css';\r\n\r\nconst MIN_LENGTH_FOR_LONG_WORDS_IN_TITLE = 16;\r\n\r\nconst { UUID } = sdkTypes;\r\n\r\nconst priceData = (price, intl) => {\r\n  if (price && price.currency === config.currency) {\r\n    const formattedPrice = formatMoney(intl, price);\r\n    return { formattedPrice, priceTitle: formattedPrice };\r\n  } else if (price) {\r\n    return {\r\n      formattedPrice: `(${price.currency})`,\r\n      priceTitle: `Unsupported currency (${price.currency})`,\r\n    };\r\n  }\r\n  return {};\r\n};\r\n\r\nconst categoryLabel = (categories, key) => {\r\n  const cat = categories.find(c => c.key === key);\r\n  return cat ? cat.label : key;\r\n};\r\n\r\nexport class ListingPageComponent extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    const { enquiryModalOpenForListingId, params } = props;\r\n    this.state = {\r\n      pageClassNames: [],\r\n      imageCarouselOpen: false,\r\n      enquiryModalOpen: enquiryModalOpenForListingId === params.id,\r\n    };\r\n\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.onContactUser = this.onContactUser.bind(this);\r\n    this.onSubmitEnquiry = this.onSubmitEnquiry.bind(this);\r\n  }\r\n\r\n  handleSubmit(values) {\r\n    const {\r\n      history,\r\n      getListing,\r\n      params,\r\n      callSetInitialValues,\r\n      onInitializeCardPaymentData,\r\n    } = this.props;\r\n    const listingId = new UUID(params.id);\r\n    const listing = getListing(listingId);\r\n\r\n    const { bookingDates, quantity: quantityRaw, deliveryMethod, ...otherOrderData } = values;\r\n    const bookingDatesMaybe = bookingDates\r\n      ? {\r\n          bookingDates: {\r\n            bookingStart: bookingDates.startDate,\r\n            bookingEnd: bookingDates.endDate,\r\n          },\r\n        }\r\n      : {};\r\n\r\n    const initialValues = {\r\n      listing,\r\n      orderData: {\r\n        ...bookingDatesMaybe,\r\n        quantity: Number.parseInt(quantityRaw, 10),\r\n        deliveryMethod,\r\n        ...otherOrderData,\r\n      },\r\n      confirmPaymentError: null,\r\n    };\r\n\r\n    const saveToSessionStorage = !this.props.currentUser;\r\n\r\n    const routes = routeConfiguration();\r\n    // Customize checkout page state with current listing and selected orderData\r\n    const { setInitialValues } = findRouteByRouteName('CheckoutPage', routes);\r\n\r\n    callSetInitialValues(setInitialValues, initialValues, saveToSessionStorage);\r\n\r\n    // Clear previous Stripe errors from store if there is any\r\n    onInitializeCardPaymentData();\r\n\r\n    // Redirect to CheckoutPage\r\n    history.push(\r\n      createResourceLocatorString(\r\n        'CheckoutPage',\r\n        routes,\r\n        { id: listing.id.uuid, slug: createSlug(listing.attributes.title) },\r\n        {}\r\n      )\r\n    );\r\n  }\r\n\r\n  onContactUser() {\r\n    const { currentUser, history, callSetInitialValues, params, location } = this.props;\r\n\r\n    if (!currentUser) {\r\n      const state = { from: `${location.pathname}${location.search}${location.hash}` };\r\n\r\n      // We need to log in before showing the modal, but first we need to ensure\r\n      // that modal does open when user is redirected back to this listingpage\r\n      callSetInitialValues(setInitialValues, { enquiryModalOpenForListingId: params.id });\r\n\r\n      // signup and return back to listingPage.\r\n      history.push(createResourceLocatorString('SignupPage', routeConfiguration(), {}, {}), state);\r\n    } else {\r\n      this.setState({ enquiryModalOpen: true });\r\n    }\r\n  }\r\n\r\n  onSubmitEnquiry(values) {\r\n    const { history, params, onSendEnquiry } = this.props;\r\n    const routes = routeConfiguration();\r\n    const listingId = new UUID(params.id);\r\n    const { message } = values;\r\n\r\n    onSendEnquiry(listingId, message.trim())\r\n      .then(txId => {\r\n        this.setState({ enquiryModalOpen: false });\r\n\r\n        // Redirect to OrderDetailsPage\r\n        history.push(\r\n          createResourceLocatorString('OrderDetailsPage', routes, { id: txId.uuid }, {})\r\n        );\r\n      })\r\n      .catch(() => {\r\n        // Ignore, error handling in duck file\r\n      });\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      unitType,\r\n      isAuthenticated,\r\n      currentUser,\r\n      getListing,\r\n      getOwnListing,\r\n      intl,\r\n      onManageDisableScrolling,\r\n      params: rawParams,\r\n      location,\r\n      scrollingDisabled,\r\n      showListingError,\r\n      reviews,\r\n      fetchReviewsError,\r\n      sendEnquiryInProgress,\r\n      sendEnquiryError,\r\n      timeSlots,\r\n      fetchTimeSlotsError,\r\n      customConfig,\r\n      onFetchTransactionLineItems,\r\n      lineItems,\r\n      fetchLineItemsInProgress,\r\n      fetchLineItemsError,\r\n    } = this.props;\r\n\r\n    const listingId = new UUID(rawParams.id);\r\n    const isPendingApprovalVariant = rawParams.variant === LISTING_PAGE_PENDING_APPROVAL_VARIANT;\r\n    const isDraftVariant = rawParams.variant === LISTING_PAGE_DRAFT_VARIANT;\r\n    const currentListing =\r\n      isPendingApprovalVariant || isDraftVariant\r\n        ? ensureOwnListing(getOwnListing(listingId))\r\n        : ensureListing(getListing(listingId));\r\n\r\n    const listingSlug = rawParams.slug || createSlug(currentListing.attributes.title || '');\r\n    const params = { slug: listingSlug, ...rawParams };\r\n\r\n    const listingType = isDraftVariant\r\n      ? LISTING_PAGE_PARAM_TYPE_DRAFT\r\n      : LISTING_PAGE_PARAM_TYPE_EDIT;\r\n    const listingTab = isDraftVariant ? 'photos' : 'details';\r\n\r\n    const isApproved =\r\n      currentListing.id && currentListing.attributes.state !== LISTING_STATE_PENDING_APPROVAL;\r\n\r\n    const pendingIsApproved = isPendingApprovalVariant && isApproved;\r\n\r\n    // If a /pending-approval URL is shared, the UI requires\r\n    // authentication and attempts to fetch the listing from own\r\n    // listings. This will fail with 403 Forbidden if the author is\r\n    // another user. We use this information to try to fetch the\r\n    // public listing.\r\n    const pendingOtherUsersListing =\r\n      (isPendingApprovalVariant || isDraftVariant) &&\r\n      showListingError &&\r\n      showListingError.status === 403;\r\n    const shouldShowPublicListingPage = pendingIsApproved || pendingOtherUsersListing;\r\n\r\n    if (shouldShowPublicListingPage) {\r\n      return <NamedRedirect name=\"ListingPage\" params={params} search={location.search} />;\r\n    }\r\n\r\n    const {\r\n      description = '',\r\n      geolocation = null,\r\n      price = null,\r\n      title = '',\r\n      publicData,\r\n    } = currentListing.attributes;\r\n\r\n    const richTitle = (\r\n      <span>\r\n        {richText(title, {\r\n          longWordMinLength: MIN_LENGTH_FOR_LONG_WORDS_IN_TITLE,\r\n          longWordClass: css.longWord,\r\n        })}\r\n      </span>\r\n    );\r\n\r\n    const bookingTitle = (\r\n      <FormattedMessage id=\"ListingPage.bookingTitle\" values={{ title: richTitle }} />\r\n    );\r\n\r\n    const topbar = <TopbarContainer />;\r\n\r\n    if (showListingError && showListingError.status === 404) {\r\n      // 404 listing not found\r\n\r\n      return <NotFoundPage />;\r\n    } else if (showListingError) {\r\n      // Other error in fetching listing\r\n\r\n      const errorTitle = intl.formatMessage({\r\n        id: 'ListingPage.errorLoadingListingTitle',\r\n      });\r\n\r\n      return (\r\n        <Page title={errorTitle} scrollingDisabled={scrollingDisabled}>\r\n          <LayoutSingleColumn className={css.pageRoot}>\r\n            <LayoutWrapperTopbar>{topbar}</LayoutWrapperTopbar>\r\n            <LayoutWrapperMain>\r\n              <p className={css.errorText}>\r\n                <FormattedMessage id=\"ListingPage.errorLoadingListingMessage\" />\r\n              </p>\r\n            </LayoutWrapperMain>\r\n            <LayoutWrapperFooter>\r\n              <Footer />\r\n            </LayoutWrapperFooter>\r\n          </LayoutSingleColumn>\r\n        </Page>\r\n      );\r\n    } else if (!currentListing.id) {\r\n      // Still loading the listing\r\n\r\n      const loadingTitle = intl.formatMessage({\r\n        id: 'ListingPage.loadingListingTitle',\r\n      });\r\n\r\n      return (\r\n        <Page title={loadingTitle} scrollingDisabled={scrollingDisabled}>\r\n          <LayoutSingleColumn className={css.pageRoot}>\r\n            <LayoutWrapperTopbar>{topbar}</LayoutWrapperTopbar>\r\n            <LayoutWrapperMain>\r\n              <p className={css.loadingText}>\r\n                <FormattedMessage id=\"ListingPage.loadingListingMessage\" />\r\n              </p>\r\n            </LayoutWrapperMain>\r\n            <LayoutWrapperFooter>\r\n              <Footer />\r\n            </LayoutWrapperFooter>\r\n          </LayoutSingleColumn>\r\n        </Page>\r\n      );\r\n    }\r\n\r\n    const handleViewPhotosClick = e => {\r\n      // Stop event from bubbling up to prevent image click handler\r\n      // trying to open the carousel as well.\r\n      e.stopPropagation();\r\n      this.setState({\r\n        imageCarouselOpen: true,\r\n      });\r\n    };\r\n    const authorAvailable = currentListing && currentListing.author;\r\n    const userAndListingAuthorAvailable = !!(currentUser && authorAvailable);\r\n    const isOwnListing =\r\n      userAndListingAuthorAvailable && currentListing.author.id.uuid === currentUser.id.uuid;\r\n    const showContactUser = authorAvailable && (!currentUser || (currentUser && !isOwnListing));\r\n\r\n    const currentAuthor = authorAvailable ? currentListing.author : null;\r\n    const ensuredAuthor = ensureUser(currentAuthor);\r\n\r\n    // When user is banned or deleted the listing is also deleted.\r\n    // Because listing can be never showed with banned or deleted user we don't have to provide\r\n    // banned or deleted display names for the function\r\n    const authorDisplayName = userDisplayNameAsString(ensuredAuthor, '');\r\n\r\n    const { formattedPrice, priceTitle } = priceData(price, intl);\r\n\r\n    const handleOrderSubmit = values => {\r\n      const isCurrentlyClosed = currentListing.attributes.state === LISTING_STATE_CLOSED;\r\n      if (isOwnListing || isCurrentlyClosed) {\r\n        window.scrollTo(0, 0);\r\n      } else {\r\n        this.handleSubmit(values);\r\n      }\r\n    };\r\n\r\n    const listingImages = (listing, variantName) =>\r\n      (listing.images || [])\r\n        .map(image => {\r\n          const variants = image.attributes.variants;\r\n          const variant = variants ? variants[variantName] : null;\r\n\r\n          // deprecated\r\n          // for backwards combatility only\r\n          const sizes = image.attributes.sizes;\r\n          const size = sizes ? sizes.find(i => i.name === variantName) : null;\r\n\r\n          return variant || size;\r\n        })\r\n        .filter(variant => variant != null);\r\n\r\n    const facebookImages = listingImages(currentListing, 'facebook');\r\n    const twitterImages = listingImages(currentListing, 'twitter');\r\n    const schemaImages = listingImages(currentListing, `${config.listing.variantPrefix}-2x`).map(\r\n      img => img.url\r\n    );\r\n    const siteTitle = config.siteTitle;\r\n    const schemaTitle = intl.formatMessage(\r\n      { id: 'ListingPage.schemaTitle' },\r\n      { title, price: formattedPrice, siteTitle }\r\n    );\r\n    // You could add reviews, sku, etc. into page schema\r\n    // Read more about product schema\r\n    // https://developers.google.com/search/docs/advanced/structured-data/product\r\n    const productURL = `${config.canonicalRootURL}${location.pathname}${location.search}${location.hash}`;\r\n    const brand = currentListing?.attributes?.publicData?.brand;\r\n    const brandMaybe = brand ? { brand: { '@type': 'Brand', name: brand } } : {};\r\n    const schemaPriceNumber = intl.formatNumber(convertMoneyToNumber(price), {\r\n      minimumFractionDigits: 2,\r\n      maximumFractionDigits: 2,\r\n    });\r\n    const currentStock = currentListing.currentStock?.attributes?.quantity || 0;\r\n    const schemaAvailability =\r\n      currentStock > 0 ? 'https://schema.org/InStock' : 'https://schema.org/OutOfStock';\r\n\r\n    const authorLink = (\r\n      <NamedLink\r\n        className={css.authorNameLink}\r\n        name=\"ListingPage\"\r\n        params={params}\r\n        to={{ hash: '#author' }}\r\n      >\r\n        {authorDisplayName}\r\n      </NamedLink>\r\n    );\r\n\r\n    const amenityOptions = findOptionsForSelectFilter('amenities', customConfig.filters);\r\n    const categoryOptions = findOptionsForSelectFilter('category', customConfig.filters);\r\n    const category =\r\n      publicData && publicData.category ? (\r\n        <span>\r\n          {categoryLabel(categoryOptions, publicData.category)}\r\n          <span className={css.separator}>•</span>\r\n        </span>\r\n      ) : null;\r\n\r\n    return (\r\n      <Page\r\n        title={schemaTitle}\r\n        scrollingDisabled={scrollingDisabled}\r\n        author={authorDisplayName}\r\n        contentType=\"website\"\r\n        description={description}\r\n        facebookImages={facebookImages}\r\n        twitterImages={twitterImages}\r\n        schema={{\r\n          '@context': 'http://schema.org',\r\n          '@type': 'Product',\r\n          description: description,\r\n          name: schemaTitle,\r\n          image: schemaImages,\r\n          ...brandMaybe,\r\n          offers: {\r\n            '@type': 'Offer',\r\n            url: productURL,\r\n            priceCurrency: price.currency,\r\n            price: schemaPriceNumber,\r\n            availability: schemaAvailability,\r\n          },\r\n        }}\r\n      >\r\n        <LayoutSingleColumn className={css.pageRoot}>\r\n          <LayoutWrapperTopbar>{topbar}</LayoutWrapperTopbar>\r\n          <LayoutWrapperMain>\r\n            <div className={css.contentWrapperForProductLayout}>\r\n              <div className={css.mainColumnForProductLayout}>\r\n                {currentListing.id ? (\r\n                  <ActionBarMaybe\r\n                    className={css.actionBarForProductLayout}\r\n                    isOwnListing={isOwnListing}\r\n                    listing={currentListing}\r\n                    editParams={{\r\n                      id: listingId.uuid,\r\n                      slug: listingSlug,\r\n                      type: listingType,\r\n                      tab: listingTab,\r\n                    }}\r\n                  />\r\n                ) : null}\r\n                <SectionGallery listing={currentListing} />\r\n                <div className={css.productMobileHeading}>\r\n                  <SectionHeading\r\n                    priceTitle={priceTitle}\r\n                    formattedPrice={formattedPrice}\r\n                    richTitle={richTitle}\r\n                    category={category}\r\n                    authorLink={authorLink}\r\n                    showContactUser={showContactUser}\r\n                    onContactUser={this.onContactUser}\r\n                  />\r\n                </div>\r\n                <SectionDescriptionMaybe description={description} listingTitle={richTitle} />\r\n                <SectionDetailsMaybe publicData={publicData} customConfig={customConfig} />\r\n                <SectionFeaturesMaybe\r\n                  extendedDataKey=\"amenities\"\r\n                  options={amenityOptions}\r\n                  publicData={publicData}\r\n                />\r\n                <SectionRulesMaybe publicData={publicData} />\r\n                <SectionMapMaybe\r\n                  geolocation={geolocation}\r\n                  publicData={publicData}\r\n                  listingId={currentListing.id}\r\n                />\r\n                <SectionReviews reviews={reviews} fetchReviewsError={fetchReviewsError} />\r\n                <SectionAuthorMaybe\r\n                  title={title}\r\n                  listing={currentListing}\r\n                  authorDisplayName={authorDisplayName}\r\n                  onContactUser={this.onContactUser}\r\n                  isEnquiryModalOpen={isAuthenticated && this.state.enquiryModalOpen}\r\n                  onCloseEnquiryModal={() => this.setState({ enquiryModalOpen: false })}\r\n                  sendEnquiryError={sendEnquiryError}\r\n                  sendEnquiryInProgress={sendEnquiryInProgress}\r\n                  onSubmitEnquiry={this.onSubmitEnquiry}\r\n                  currentUser={currentUser}\r\n                  onManageDisableScrolling={onManageDisableScrolling}\r\n                />\r\n              </div>\r\n              <div className={css.orderColumnForProductLayout}>\r\n                <OrderPanel\r\n                  className={css.productOrderPanel}\r\n                  listing={currentListing}\r\n                  isOwnListing={isOwnListing}\r\n                  unitType={unitType}\r\n                  onSubmit={handleOrderSubmit}\r\n                  title={bookingTitle}\r\n                  author={ensuredAuthor}\r\n                  onManageDisableScrolling={onManageDisableScrolling}\r\n                  onContactUser={this.onContactUser}\r\n                  timeSlots={timeSlots}\r\n                  fetchTimeSlotsError={fetchTimeSlotsError}\r\n                  onFetchTransactionLineItems={onFetchTransactionLineItems}\r\n                  lineItems={lineItems}\r\n                  fetchLineItemsInProgress={fetchLineItemsInProgress}\r\n                  fetchLineItemsError={fetchLineItemsError}\r\n                />\r\n              </div>\r\n            </div>\r\n          </LayoutWrapperMain>\r\n          <LayoutWrapperFooter>\r\n            <Footer />\r\n          </LayoutWrapperFooter>\r\n        </LayoutSingleColumn>\r\n      </Page>\r\n    );\r\n  }\r\n}\r\n\r\nListingPageComponent.defaultProps = {\r\n  unitType: config.lineItemUnitType,\r\n  currentUser: null,\r\n  enquiryModalOpenForListingId: null,\r\n  showListingError: null,\r\n  reviews: [],\r\n  fetchReviewsError: null,\r\n  timeSlots: null,\r\n  fetchTimeSlotsError: null,\r\n  sendEnquiryError: null,\r\n  customConfig: config.custom,\r\n  lineItems: null,\r\n  fetchLineItemsError: null,\r\n};\r\n\r\nListingPageComponent.propTypes = {\r\n  // from withRouter\r\n  history: shape({\r\n    push: func.isRequired,\r\n  }).isRequired,\r\n  location: shape({\r\n    search: string,\r\n  }).isRequired,\r\n\r\n  unitType: propTypes.lineItemUnitType,\r\n  // from injectIntl\r\n  intl: intlShape.isRequired,\r\n\r\n  params: shape({\r\n    id: string.isRequired,\r\n    slug: string,\r\n    variant: oneOf([LISTING_PAGE_DRAFT_VARIANT, LISTING_PAGE_PENDING_APPROVAL_VARIANT]),\r\n  }).isRequired,\r\n\r\n  isAuthenticated: bool.isRequired,\r\n  currentUser: propTypes.currentUser,\r\n  getListing: func.isRequired,\r\n  getOwnListing: func.isRequired,\r\n  onManageDisableScrolling: func.isRequired,\r\n  scrollingDisabled: bool.isRequired,\r\n  enquiryModalOpenForListingId: string,\r\n  showListingError: propTypes.error,\r\n  callSetInitialValues: func.isRequired,\r\n  reviews: arrayOf(propTypes.review),\r\n  fetchReviewsError: propTypes.error,\r\n  timeSlots: arrayOf(propTypes.timeSlot),\r\n  fetchTimeSlotsError: propTypes.error,\r\n  sendEnquiryInProgress: bool.isRequired,\r\n  sendEnquiryError: propTypes.error,\r\n  onSendEnquiry: func.isRequired,\r\n  onInitializeCardPaymentData: func.isRequired,\r\n  customConfig: object,\r\n  onFetchTransactionLineItems: func.isRequired,\r\n  lineItems: array,\r\n  fetchLineItemsInProgress: bool.isRequired,\r\n  fetchLineItemsError: propTypes.error,\r\n};\r\n\r\nconst mapStateToProps = state => {\r\n  const { isAuthenticated } = state.Auth;\r\n  const {\r\n    showListingError,\r\n    reviews,\r\n    fetchReviewsError,\r\n    timeSlots,\r\n    fetchTimeSlotsError,\r\n    sendEnquiryInProgress,\r\n    sendEnquiryError,\r\n    lineItems,\r\n    fetchLineItemsInProgress,\r\n    fetchLineItemsError,\r\n    enquiryModalOpenForListingId,\r\n  } = state.ListingPage;\r\n  const { currentUser } = state.user;\r\n\r\n  const getListing = id => {\r\n    const ref = { id, type: 'listing' };\r\n    const listings = getMarketplaceEntities(state, [ref]);\r\n    return listings.length === 1 ? listings[0] : null;\r\n  };\r\n\r\n  const getOwnListing = id => {\r\n    const ref = { id, type: 'ownListing' };\r\n    const listings = getMarketplaceEntities(state, [ref]);\r\n    return listings.length === 1 ? listings[0] : null;\r\n  };\r\n\r\n  return {\r\n    isAuthenticated,\r\n    currentUser,\r\n    getListing,\r\n    getOwnListing,\r\n    scrollingDisabled: isScrollingDisabled(state),\r\n    enquiryModalOpenForListingId,\r\n    showListingError,\r\n    reviews,\r\n    fetchReviewsError,\r\n    timeSlots,\r\n    fetchTimeSlotsError,\r\n    lineItems,\r\n    fetchLineItemsInProgress,\r\n    fetchLineItemsError,\r\n    sendEnquiryInProgress,\r\n    sendEnquiryError,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  onManageDisableScrolling: (componentId, disableScrolling) =>\r\n    dispatch(manageDisableScrolling(componentId, disableScrolling)),\r\n  callSetInitialValues: (setInitialValues, values, saveToSessionStorage) =>\r\n    dispatch(setInitialValues(values, saveToSessionStorage)),\r\n  onFetchTransactionLineItems: (orderData, listingId, isOwnListing) =>\r\n    dispatch(fetchTransactionLineItems(orderData, listingId, isOwnListing)),\r\n  onSendEnquiry: (listingId, message) => dispatch(sendEnquiry(listingId, message)),\r\n  onInitializeCardPaymentData: () => dispatch(initializeCardPaymentData()),\r\n});\r\n\r\n// Note: it is important that the withRouter HOC is **outside** the\r\n// connect HOC, otherwise React Router won't rerender any Route\r\n// components since connect implements a shouldComponentUpdate\r\n// lifecycle hook.\r\n//\r\n// See: https://github.com/ReactTraining/react-router/issues/4671\r\nconst ListingPage = compose(\r\n  withRouter,\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  ),\r\n  injectIntl\r\n)(ListingPageComponent);\r\n\r\nexport default ListingPage;\r\n"]},"metadata":{},"sourceType":"module"}