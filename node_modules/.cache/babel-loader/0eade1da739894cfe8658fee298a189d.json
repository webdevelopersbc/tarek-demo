{"ast":null,"code":"var _jsxFileName = \"D:\\\\Amardeep\\\\tarek_project\\\\ftw-product\\\\src\\\\containers\\\\SearchPage\\\\SearchPageWithMap.js\";\nimport React, { Component } from 'react';\nimport { array, bool, func, oneOf, object, shape, string } from 'prop-types';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { withRouter } from 'react-router-dom';\nimport debounce from 'lodash/debounce';\nimport unionWith from 'lodash/unionWith';\nimport omit from 'lodash/omit';\nimport classNames from 'classnames';\nimport config from '../../config';\nimport { injectIntl, intlShape, FormattedMessage } from '../../util/reactIntl';\nimport routeConfiguration from '../../routing/routeConfiguration';\nimport { createResourceLocatorString, pathByRouteName } from '../../util/routes';\nimport { isAnyFilterActive, isMainSearchTypeKeywords, isOriginInUse } from '../../util/search';\nimport { parse, stringify } from '../../util/urlHelpers';\nimport { propTypes } from '../../util/types';\nimport { getListingsById } from '../../ducks/marketplaceData.duck';\nimport { manageDisableScrolling, isScrollingDisabled } from '../../ducks/UI.duck';\nimport { ModalInMobile, Page } from '../../components';\nimport TopbarContainer from '../../containers/TopbarContainer/TopbarContainer';\nimport { searchMapListings, setActiveListing } from './SearchPage.duck';\nimport { pickSearchParamsOnly, validURLParamsForExtendedData, validFilterParams, createSearchResultSchema } from './SearchPage.helpers';\nimport FilterComponent from './FilterComponent';\nimport SearchMap from './SearchMap/SearchMap';\nimport MainPanelHeader from './MainPanelHeader/MainPanelHeader';\nimport SearchFiltersSecondary from './SearchFiltersSecondary/SearchFiltersSecondary';\nimport SearchFiltersPrimary from './SearchFiltersPrimary/SearchFiltersPrimary';\nimport SearchFiltersMobile from './SearchFiltersMobile/SearchFiltersMobile';\nimport SortBy from './SortBy/SortBy';\nimport SearchResultsPanel from './SearchResultsPanel/SearchResultsPanel';\nimport css from './SearchPage.module.css';\nconst MODAL_BREAKPOINT = 768; // Search is in modal on mobile layout\n\nconst SEARCH_WITH_MAP_DEBOUNCE = 300; // Little bit of debounce before search is initiated.\n// Primary filters have their content in dropdown-popup.\n// With this offset we move the dropdown to the left a few pixels on desktop layout.\n\nconst FILTER_DROPDOWN_OFFSET = -14;\n\nconst validUrlQueryParamsFromProps = props => {\n  const {\n    location,\n    filterConfig\n  } = props; // eslint-disable-next-line no-unused-vars\n\n  const {\n    mapSearch,\n    page,\n    ...searchInURL\n  } = parse(location.search, {\n    latlng: ['origin'],\n    latlngBounds: ['bounds']\n  }); // urlQueryParams doesn't contain page specific url params\n  // like mapSearch, page or origin (origin depends on config.sortSearchByDistance)\n\n  return validURLParamsForExtendedData(searchInURL, filterConfig);\n};\n\nconst cleanSearchFromConflictingParams = (searchParams, sortConfig, filterConfig) => {\n  // Single out filters that should disable SortBy when an active\n  // keyword search sorts the listings according to relevance.\n  // In those cases, sort parameter should be removed.\n  const sortingFiltersActive = isAnyFilterActive(sortConfig.conflictingFilters, searchParams, filterConfig);\n  return sortingFiltersActive ? { ...searchParams,\n    [sortConfig.queryParamName]: null\n  } : searchParams;\n};\n\nexport class SearchPageComponent extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isSearchMapOpenOnMobile: props.tab === 'map',\n      isMobileModalOpen: false,\n      currentQueryParams: validUrlQueryParamsFromProps(props),\n      isSecondaryFiltersOpen: false\n    };\n    this.searchMapListingsInProgress = false;\n    this.onMapMoveEnd = debounce(this.onMapMoveEnd.bind(this), SEARCH_WITH_MAP_DEBOUNCE);\n    this.onOpenMobileModal = this.onOpenMobileModal.bind(this);\n    this.onCloseMobileModal = this.onCloseMobileModal.bind(this); // Filter functions\n\n    this.applyFilters = this.applyFilters.bind(this);\n    this.cancelFilters = this.cancelFilters.bind(this);\n    this.resetAll = this.resetAll.bind(this);\n    this.initialValues = this.initialValues.bind(this);\n    this.getHandleChangedValueFn = this.getHandleChangedValueFn.bind(this); // SortBy\n\n    this.handleSortBy = this.handleSortBy.bind(this);\n  } // Callback to determine if new search is needed\n  // when map is moved by user or viewport has changed\n\n\n  onMapMoveEnd(viewportBoundsChanged, data) {\n    const {\n      viewportBounds,\n      viewportCenter\n    } = data;\n    const routes = routeConfiguration();\n    const searchPagePath = pathByRouteName('SearchPage', routes);\n    const currentPath = typeof window !== 'undefined' && window.location && window.location.pathname; // When using the ReusableMapContainer onMapMoveEnd can fire from other pages than SearchPage too\n\n    const isSearchPage = currentPath === searchPagePath; // If mapSearch url param is given\n    // or original location search is rendered once,\n    // we start to react to \"mapmoveend\" events by generating new searches\n    // (i.e. 'moveend' event in Mapbox and 'bounds_changed' in Google Maps)\n\n    if (viewportBoundsChanged && isSearchPage) {\n      const {\n        history,\n        location,\n        filterConfig\n      } = this.props; // parse query parameters, including a custom attribute named category\n\n      const {\n        address,\n        bounds,\n        mapSearch,\n        ...rest\n      } = parse(location.search, {\n        latlng: ['origin'],\n        latlngBounds: ['bounds']\n      }); //const viewportMapCenter = SearchMap.getMapCenter(map);\n\n      const originMaybe = isOriginInUse(config) ? {\n        origin: viewportCenter\n      } : {};\n      const searchParams = {\n        address,\n        ...originMaybe,\n        bounds: viewportBounds,\n        mapSearch: true,\n        ...validFilterParams(rest, filterConfig)\n      };\n      history.push(createResourceLocatorString('SearchPage', routes, {}, searchParams));\n    }\n  } // Invoked when a modal is opened from a child component,\n  // for example when a filter modal is opened in mobile view\n\n\n  onOpenMobileModal() {\n    this.setState({\n      isMobileModalOpen: true\n    });\n  } // Invoked when a modal is closed from a child component,\n  // for example when a filter modal is opened in mobile view\n\n\n  onCloseMobileModal() {\n    this.setState({\n      isMobileModalOpen: false\n    });\n  } // Apply the filters by redirecting to SearchPage with new filters.\n\n\n  applyFilters() {\n    const {\n      history,\n      sortConfig,\n      filterConfig\n    } = this.props;\n    const urlQueryParams = validUrlQueryParamsFromProps(this.props);\n    const searchParams = { ...urlQueryParams,\n      ...this.state.currentQueryParams\n    };\n    const search = cleanSearchFromConflictingParams(searchParams, sortConfig, filterConfig);\n    history.push(createResourceLocatorString('SearchPage', routeConfiguration(), {}, search));\n  } // Close the filters by clicking cancel, revert to the initial params\n\n\n  cancelFilters() {\n    this.setState({\n      currentQueryParams: {}\n    });\n  } // Reset all filter query parameters\n\n\n  resetAll(e) {\n    const {\n      history,\n      filterConfig\n    } = this.props;\n    const urlQueryParams = validUrlQueryParamsFromProps(this.props);\n    const filterQueryParamNames = filterConfig.map(f => f.queryParamNames); // Reset state\n\n    this.setState({\n      currentQueryParams: {}\n    }); // Reset routing params\n\n    const queryParams = omit(urlQueryParams, filterQueryParamNames);\n    history.push(createResourceLocatorString('SearchPage', routeConfiguration(), {}, queryParams));\n  }\n\n  initialValues(queryParamNames, isLiveEdit) {\n    const urlQueryParams = validUrlQueryParamsFromProps(this.props); // Query parameters that are in state (user might have not yet clicked \"Apply\")\n\n    const currentQueryParams = this.state.currentQueryParams; // Get initial value for a given parameter from state if its there.\n\n    const getInitialValue = paramName => {\n      const currentQueryParam = currentQueryParams[paramName];\n      const hasQueryParamInState = typeof currentQueryParam !== 'undefined';\n      return hasQueryParamInState && !isLiveEdit ? currentQueryParam : urlQueryParams[paramName];\n    }; // Return all the initial values related to given queryParamNames\n    // InitialValues for \"amenities\" filter could be\n    // { amenities: \"has_any:towel,jacuzzi\" }\n\n\n    const isArray = Array.isArray(queryParamNames);\n    return isArray ? queryParamNames.reduce((acc, paramName) => {\n      return { ...acc,\n        [paramName]: getInitialValue(paramName)\n      };\n    }, {}) : {};\n  }\n\n  getHandleChangedValueFn(useHistoryPush) {\n    const {\n      history,\n      sortConfig,\n      filterConfig\n    } = this.props;\n    const urlQueryParams = validUrlQueryParamsFromProps(this.props);\n    return updatedURLParams => {\n      const updater = prevState => {\n        const {\n          address,\n          bounds,\n          keywords\n        } = urlQueryParams;\n        const mergedQueryParams = { ...urlQueryParams,\n          ...prevState.currentQueryParams\n        }; // Address and bounds are handled outside of MainPanel.\n        // I.e. TopbarSearchForm && search by moving the map.\n        // We should always trust urlQueryParams with those.\n        // The same applies to keywords, if the main search type is keyword search.\n\n        const keywordsMaybe = isMainSearchTypeKeywords(config) ? {\n          keywords\n        } : {};\n        return {\n          currentQueryParams: { ...mergedQueryParams,\n            ...updatedURLParams,\n            ...keywordsMaybe,\n            address,\n            bounds\n          }\n        };\n      };\n\n      const callback = () => {\n        if (useHistoryPush) {\n          const searchParams = this.state.currentQueryParams;\n          const search = cleanSearchFromConflictingParams(searchParams, sortConfig, filterConfig);\n          history.push(createResourceLocatorString('SearchPage', routeConfiguration(), {}, search));\n        }\n      };\n\n      this.setState(updater, callback);\n    };\n  }\n\n  handleSortBy(urlParam, values) {\n    const {\n      history\n    } = this.props;\n    const urlQueryParams = validUrlQueryParamsFromProps(this.props);\n    const queryParams = values ? { ...urlQueryParams,\n      [urlParam]: values\n    } : omit(urlQueryParams, urlParam);\n    history.push(createResourceLocatorString('SearchPage', routeConfiguration(), {}, queryParams));\n  }\n\n  render() {\n    var _location$search;\n\n    const {\n      intl,\n      listings,\n      filterConfig,\n      sortConfig,\n      location,\n      mapListings,\n      onManageDisableScrolling,\n      pagination,\n      scrollingDisabled,\n      searchInProgress,\n      searchListingsError,\n      searchParams,\n      activeListingId,\n      onActivateListing\n    } = this.props; // eslint-disable-next-line no-unused-vars\n\n    const {\n      mapSearch,\n      page,\n      ...searchInURL\n    } = parse(location.search, {\n      latlng: ['origin'],\n      latlngBounds: ['bounds']\n    }); // urlQueryParams doesn't contain page specific url params\n    // like mapSearch, page or origin (origin depends on config.sortSearchByDistance)\n\n    const urlQueryParams = pickSearchParamsOnly(searchInURL, filterConfig, sortConfig); // Page transition might initially use values from previous search\n\n    const urlQueryString = stringify(urlQueryParams);\n    const paramsQueryString = stringify(pickSearchParamsOnly(searchParams, filterConfig, sortConfig));\n    const searchParamsAreInSync = urlQueryString === paramsQueryString;\n    const validQueryParams = validURLParamsForExtendedData(searchInURL, filterConfig);\n    const isWindowDefined = typeof window !== 'undefined';\n    const isMobileLayout = isWindowDefined && window.innerWidth < MODAL_BREAKPOINT;\n    const shouldShowSearchMap = !isMobileLayout || isMobileLayout && this.state.isSearchMapOpenOnMobile;\n    const isKeywordSearch = isMainSearchTypeKeywords(config);\n    const availableFilters = isKeywordSearch ? filterConfig.filter(f => f.type !== 'KeywordFilter') : filterConfig;\n    const primaryFilters = availableFilters.filter(f => f.group === 'primary');\n    const secondaryFilters = availableFilters.filter(f => f.group !== 'primary');\n    const hasSecondaryFilters = !!(secondaryFilters && secondaryFilters.length > 0); // Selected aka active filters\n\n    const selectedFilters = validFilterParams(validQueryParams, filterConfig);\n    const keysOfSelectedFilters = Object.keys(selectedFilters);\n    const selectedFiltersCountForMobile = isKeywordSearch ? keysOfSelectedFilters.filter(f => f !== 'keywords').length : keysOfSelectedFilters.length; // Selected aka active secondary filters\n\n    const selectedSecondaryFilters = hasSecondaryFilters ? validFilterParams(validQueryParams, secondaryFilters) : {};\n    const selectedSecondaryFiltersCount = Object.keys(selectedSecondaryFilters).length;\n    const isSecondaryFiltersOpen = !!hasSecondaryFilters && this.state.isSecondaryFiltersOpen;\n    const propsForSecondaryFiltersToggle = hasSecondaryFilters ? {\n      isSecondaryFiltersOpen: this.state.isSecondaryFiltersOpen,\n      toggleSecondaryFiltersOpen: isOpen => {\n        this.setState({\n          isSecondaryFiltersOpen: isOpen,\n          currentQueryParams: {}\n        });\n      },\n      selectedSecondaryFiltersCount\n    } : {};\n    const hasPaginationInfo = !!pagination && pagination.totalItems != null;\n    const totalItems = searchParamsAreInSync && hasPaginationInfo ? pagination.totalItems : 0;\n    const listingsAreLoaded = !searchInProgress && searchParamsAreInSync && hasPaginationInfo;\n\n    const sortBy = mode => {\n      var _sortConfig$conflicti;\n\n      const conflictingFilterActive = isAnyFilterActive(sortConfig.conflictingFilters, validQueryParams, filterConfig);\n      const mobileClassesMaybe = mode === 'mobile' ? {\n        rootClassName: css.sortBy,\n        menuLabelRootClassName: css.sortByMenuLabel\n      } : {\n        className: css.sortByDesktop\n      };\n      return sortConfig.active ? /*#__PURE__*/React.createElement(SortBy, Object.assign({}, mobileClassesMaybe, {\n        sort: validQueryParams[sortConfig.queryParamName],\n        isConflictingFilterActive: !!conflictingFilterActive,\n        hasConflictingFilters: !!(((_sortConfig$conflicti = sortConfig.conflictingFilters) === null || _sortConfig$conflicti === void 0 ? void 0 : _sortConfig$conflicti.length) > 0),\n        selectedFilters: selectedFilters,\n        onSelect: this.handleSortBy,\n        showAsPopup: true,\n        contentPlacementOffset: FILTER_DROPDOWN_OFFSET,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 351,\n          columnNumber: 9\n        }\n      })) : null;\n    };\n\n    const onMapIconClick = () => {\n      this.useLocationSearchBounds = true;\n      this.setState({\n        isSearchMapOpenOnMobile: true\n      });\n    };\n\n    const {\n      bounds,\n      origin\n    } = searchInURL || {};\n    const {\n      title,\n      description,\n      schema\n    } = createSearchResultSchema(listings, searchInURL || {}, intl);\n    const hasNoResult = listingsAreLoaded && totalItems === 0;\n    const hasSearchParams = ((_location$search = location.search) === null || _location$search === void 0 ? void 0 : _location$search.length) > 0;\n    const noResultsInfo = hasNoResult ? /*#__PURE__*/React.createElement(\"div\", {\n      className: css.noSearchResults,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: \"SearchPage.noResults\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 9\n      }\n    }), hasSearchParams ? /*#__PURE__*/React.createElement(\"button\", {\n      className: css.resetAllFiltersButton,\n      onClick: e => this.resetAll(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 383,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: 'SearchPage.resetAllFilters',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 13\n      }\n    })) : null) : null; // Set topbar class based on if a modal is open in\n    // a child component\n\n    const topbarClasses = this.state.isMobileModalOpen ? classNames(css.topbarBehindModal, css.topbar) : css.topbar; // N.B. openMobileMap button is sticky.\n    // For some reason, stickyness doesn't work on Safari, if the element is <button>\n\n    return /*#__PURE__*/React.createElement(Page, {\n      scrollingDisabled: scrollingDisabled,\n      description: description,\n      title: title,\n      schema: schema,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(TopbarContainer, {\n      className: topbarClasses,\n      currentPage: \"SearchPage\",\n      currentSearchParams: urlQueryParams,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 405,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: css.container,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: css.searchResultContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(SearchFiltersMobile, {\n      className: css.searchFiltersMobileMap,\n      urlQueryParams: validQueryParams,\n      sortByComponent: sortBy('mobile'),\n      listingsAreLoaded: listingsAreLoaded,\n      resultsCount: totalItems,\n      searchInProgress: searchInProgress,\n      searchListingsError: searchListingsError,\n      showAsModalMaxWidth: MODAL_BREAKPOINT,\n      onMapIconClick: onMapIconClick,\n      onManageDisableScrolling: onManageDisableScrolling,\n      onOpenModal: this.onOpenMobileModal,\n      onCloseModal: this.onCloseMobileModal,\n      resetAll: this.resetAll,\n      selectedFiltersCount: selectedFiltersCountForMobile,\n      noResultsInfo: noResultsInfo,\n      isMapVariant: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 412,\n        columnNumber: 13\n      }\n    }, availableFilters.map(config => {\n      return /*#__PURE__*/React.createElement(FilterComponent, {\n        key: `SearchFiltersMobile.${config.id}`,\n        idPrefix: \"SearchFiltersMobile\",\n        filterConfig: config,\n        urlQueryParams: validQueryParams,\n        initialValues: this.initialValues,\n        getHandleChangedValueFn: this.getHandleChangedValueFn,\n        liveEdit: true,\n        showAsPopup: false,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 19\n        }\n      });\n    })), /*#__PURE__*/React.createElement(MainPanelHeader, {\n      className: css.mainPanelMapVariant,\n      sortByComponent: sortBy('desktop'),\n      listingsAreLoaded: listingsAreLoaded,\n      resultsCount: totalItems,\n      searchInProgress: searchInProgress,\n      searchListingsError: searchListingsError,\n      noResultsInfo: noResultsInfo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 445,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(SearchFiltersPrimary, Object.assign({}, propsForSecondaryFiltersToggle, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 454,\n        columnNumber: 15\n      }\n    }), primaryFilters.map(config => {\n      return /*#__PURE__*/React.createElement(FilterComponent, {\n        key: `SearchFiltersPrimary.${config.id}`,\n        idPrefix: \"SearchFiltersPrimary\",\n        filterConfig: config,\n        urlQueryParams: validQueryParams,\n        initialValues: this.initialValues,\n        getHandleChangedValueFn: this.getHandleChangedValueFn,\n        showAsPopup: true,\n        contentPlacementOffset: FILTER_DROPDOWN_OFFSET,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 457,\n          columnNumber: 21\n        }\n      });\n    }))), isSecondaryFiltersOpen ? /*#__PURE__*/React.createElement(\"div\", {\n      className: classNames(css.searchFiltersPanel),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 472,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(SearchFiltersSecondary, {\n      urlQueryParams: validQueryParams,\n      listingsAreLoaded: listingsAreLoaded,\n      applyFilters: this.applyFilters,\n      cancelFilters: this.cancelFilters,\n      resetAll: this.resetAll,\n      onClosePanel: () => this.setState({\n        isSecondaryFiltersOpen: false\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 473,\n        columnNumber: 17\n      }\n    }, secondaryFilters.map(config => {\n      return /*#__PURE__*/React.createElement(FilterComponent, {\n        key: `SearchFiltersSecondary.${config.id}`,\n        idPrefix: \"SearchFiltersSecondary\",\n        filterConfig: config,\n        urlQueryParams: validQueryParams,\n        initialValues: this.initialValues,\n        getHandleChangedValueFn: this.getHandleChangedValueFn,\n        showAsPopup: false,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 483,\n          columnNumber: 23\n        }\n      });\n    }))) : /*#__PURE__*/React.createElement(\"div\", {\n      className: classNames(css.listingsForMapVariant, {\n        [css.newSearchInProgress]: !listingsAreLoaded\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 497,\n        columnNumber: 15\n      }\n    }, searchListingsError ? /*#__PURE__*/React.createElement(\"h2\", {\n      className: css.error,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 503,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(FormattedMessage, {\n      id: \"SearchPage.searchError\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 504,\n        columnNumber: 21\n      }\n    })) : null, /*#__PURE__*/React.createElement(SearchResultsPanel, {\n      className: css.searchListingsPanel,\n      listings: listings,\n      pagination: listingsAreLoaded ? pagination : null,\n      search: parse(location.search),\n      setActiveListing: onActivateListing,\n      isMapVariant: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 507,\n        columnNumber: 17\n      }\n    }))), /*#__PURE__*/React.createElement(ModalInMobile, {\n      className: css.mapPanel,\n      id: \"SearchPage.map\",\n      isModalOpenOnMobile: this.state.isSearchMapOpenOnMobile,\n      onClose: () => this.setState({\n        isSearchMapOpenOnMobile: false\n      }),\n      showAsModalMaxWidth: MODAL_BREAKPOINT,\n      onManageDisableScrolling: onManageDisableScrolling,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 518,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: css.mapWrapper,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 526,\n        columnNumber: 13\n      }\n    }, shouldShowSearchMap ? /*#__PURE__*/React.createElement(SearchMap, {\n      reusableContainerClassName: css.map,\n      activeListingId: activeListingId,\n      bounds: bounds,\n      center: origin,\n      isSearchMapOpenOnMobile: this.state.isSearchMapOpenOnMobile,\n      location: location,\n      listings: mapListings || [],\n      onMapMoveEnd: this.onMapMoveEnd,\n      onCloseAsModal: () => {\n        onManageDisableScrolling('SearchPage.map', false);\n      },\n      messages: intl.messages,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 528,\n        columnNumber: 17\n      }\n    }) : null))));\n  }\n\n}\nSearchPageComponent.defaultProps = {\n  listings: [],\n  mapListings: [],\n  pagination: null,\n  searchListingsError: null,\n  searchParams: {},\n  tab: 'listings',\n  filterConfig: config.custom.filters,\n  sortConfig: config.custom.sortConfig,\n  activeListingId: null\n};\nSearchPageComponent.propTypes = {\n  listings: array,\n  mapListings: array,\n  onActivateListing: func.isRequired,\n  onManageDisableScrolling: func.isRequired,\n  onSearchMapListings: func.isRequired,\n  pagination: propTypes.pagination,\n  scrollingDisabled: bool.isRequired,\n  searchInProgress: bool.isRequired,\n  searchListingsError: propTypes.error,\n  searchParams: object,\n  tab: oneOf(['filters', 'listings', 'map']).isRequired,\n  filterConfig: propTypes.filterConfig,\n  sortConfig: propTypes.sortConfig,\n  // from withRouter\n  history: shape({\n    push: func.isRequired\n  }).isRequired,\n  location: shape({\n    search: string.isRequired\n  }).isRequired,\n  // from injectIntl\n  intl: intlShape.isRequired\n};\n\nconst mapStateToProps = state => {\n  const {\n    currentPageResultIds,\n    pagination,\n    searchInProgress,\n    searchListingsError,\n    searchParams,\n    searchMapListingIds,\n    activeListingId\n  } = state.SearchPage;\n  const pageListings = getListingsById(state, currentPageResultIds);\n  const mapListings = getListingsById(state, unionWith(currentPageResultIds, searchMapListingIds, (id1, id2) => id1.uuid === id2.uuid));\n  return {\n    listings: pageListings,\n    mapListings,\n    pagination,\n    scrollingDisabled: isScrollingDisabled(state),\n    searchInProgress,\n    searchListingsError,\n    searchParams,\n    activeListingId\n  };\n};\n\nconst mapDispatchToProps = dispatch => ({\n  onManageDisableScrolling: (componentId, disableScrolling) => dispatch(manageDisableScrolling(componentId, disableScrolling)),\n  onSearchMapListings: searchParams => dispatch(searchMapListings(searchParams)),\n  onActivateListing: listingId => dispatch(setActiveListing(listingId))\n}); // Note: it is important that the withRouter HOC is **outside** the\n// connect HOC, otherwise React Router won't rerender any Route\n// components since connect implements a shouldComponentUpdate\n// lifecycle hook.\n//\n// See: https://github.com/ReactTraining/react-router/issues/4671\n\n\nconst SearchPage = compose(withRouter, connect(mapStateToProps, mapDispatchToProps), injectIntl)(SearchPageComponent);\nexport default SearchPage;","map":{"version":3,"sources":["D:/Amardeep/tarek_project/ftw-product/src/containers/SearchPage/SearchPageWithMap.js"],"names":["React","Component","array","bool","func","oneOf","object","shape","string","connect","compose","withRouter","debounce","unionWith","omit","classNames","config","injectIntl","intlShape","FormattedMessage","routeConfiguration","createResourceLocatorString","pathByRouteName","isAnyFilterActive","isMainSearchTypeKeywords","isOriginInUse","parse","stringify","propTypes","getListingsById","manageDisableScrolling","isScrollingDisabled","ModalInMobile","Page","TopbarContainer","searchMapListings","setActiveListing","pickSearchParamsOnly","validURLParamsForExtendedData","validFilterParams","createSearchResultSchema","FilterComponent","SearchMap","MainPanelHeader","SearchFiltersSecondary","SearchFiltersPrimary","SearchFiltersMobile","SortBy","SearchResultsPanel","css","MODAL_BREAKPOINT","SEARCH_WITH_MAP_DEBOUNCE","FILTER_DROPDOWN_OFFSET","validUrlQueryParamsFromProps","props","location","filterConfig","mapSearch","page","searchInURL","search","latlng","latlngBounds","cleanSearchFromConflictingParams","searchParams","sortConfig","sortingFiltersActive","conflictingFilters","queryParamName","SearchPageComponent","constructor","state","isSearchMapOpenOnMobile","tab","isMobileModalOpen","currentQueryParams","isSecondaryFiltersOpen","searchMapListingsInProgress","onMapMoveEnd","bind","onOpenMobileModal","onCloseMobileModal","applyFilters","cancelFilters","resetAll","initialValues","getHandleChangedValueFn","handleSortBy","viewportBoundsChanged","data","viewportBounds","viewportCenter","routes","searchPagePath","currentPath","window","pathname","isSearchPage","history","address","bounds","rest","originMaybe","origin","push","setState","urlQueryParams","e","filterQueryParamNames","map","f","queryParamNames","queryParams","isLiveEdit","getInitialValue","paramName","currentQueryParam","hasQueryParamInState","isArray","Array","reduce","acc","useHistoryPush","updatedURLParams","updater","prevState","keywords","mergedQueryParams","keywordsMaybe","callback","urlParam","values","render","intl","listings","mapListings","onManageDisableScrolling","pagination","scrollingDisabled","searchInProgress","searchListingsError","activeListingId","onActivateListing","urlQueryString","paramsQueryString","searchParamsAreInSync","validQueryParams","isWindowDefined","isMobileLayout","innerWidth","shouldShowSearchMap","isKeywordSearch","availableFilters","filter","type","primaryFilters","group","secondaryFilters","hasSecondaryFilters","length","selectedFilters","keysOfSelectedFilters","Object","keys","selectedFiltersCountForMobile","selectedSecondaryFilters","selectedSecondaryFiltersCount","propsForSecondaryFiltersToggle","toggleSecondaryFiltersOpen","isOpen","hasPaginationInfo","totalItems","listingsAreLoaded","sortBy","mode","conflictingFilterActive","mobileClassesMaybe","rootClassName","menuLabelRootClassName","sortByMenuLabel","className","sortByDesktop","active","onMapIconClick","useLocationSearchBounds","title","description","schema","hasNoResult","hasSearchParams","noResultsInfo","noSearchResults","resetAllFiltersButton","topbarClasses","topbarBehindModal","topbar","container","searchResultContainer","searchFiltersMobileMap","id","mainPanelMapVariant","searchFiltersPanel","listingsForMapVariant","newSearchInProgress","error","searchListingsPanel","mapPanel","mapWrapper","messages","defaultProps","custom","filters","isRequired","onSearchMapListings","mapStateToProps","currentPageResultIds","searchMapListingIds","SearchPage","pageListings","id1","id2","uuid","mapDispatchToProps","dispatch","componentId","disableScrolling","listingId"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { array, bool, func, oneOf, object, shape, string } from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { compose } from 'redux';\r\nimport { withRouter } from 'react-router-dom';\r\nimport debounce from 'lodash/debounce';\r\nimport unionWith from 'lodash/unionWith';\r\nimport omit from 'lodash/omit';\r\nimport classNames from 'classnames';\r\n\r\nimport config from '../../config';\r\nimport { injectIntl, intlShape, FormattedMessage } from '../../util/reactIntl';\r\nimport routeConfiguration from '../../routing/routeConfiguration';\r\nimport { createResourceLocatorString, pathByRouteName } from '../../util/routes';\r\nimport { isAnyFilterActive, isMainSearchTypeKeywords, isOriginInUse } from '../../util/search';\r\nimport { parse, stringify } from '../../util/urlHelpers';\r\nimport { propTypes } from '../../util/types';\r\nimport { getListingsById } from '../../ducks/marketplaceData.duck';\r\nimport { manageDisableScrolling, isScrollingDisabled } from '../../ducks/UI.duck';\r\n\r\nimport { ModalInMobile, Page } from '../../components';\r\nimport TopbarContainer from '../../containers/TopbarContainer/TopbarContainer';\r\n\r\nimport { searchMapListings, setActiveListing } from './SearchPage.duck';\r\nimport {\r\n  pickSearchParamsOnly,\r\n  validURLParamsForExtendedData,\r\n  validFilterParams,\r\n  createSearchResultSchema,\r\n} from './SearchPage.helpers';\r\n\r\nimport FilterComponent from './FilterComponent';\r\nimport SearchMap from './SearchMap/SearchMap';\r\nimport MainPanelHeader from './MainPanelHeader/MainPanelHeader';\r\nimport SearchFiltersSecondary from './SearchFiltersSecondary/SearchFiltersSecondary';\r\nimport SearchFiltersPrimary from './SearchFiltersPrimary/SearchFiltersPrimary';\r\nimport SearchFiltersMobile from './SearchFiltersMobile/SearchFiltersMobile';\r\nimport SortBy from './SortBy/SortBy';\r\nimport SearchResultsPanel from './SearchResultsPanel/SearchResultsPanel';\r\n\r\nimport css from './SearchPage.module.css';\r\n\r\nconst MODAL_BREAKPOINT = 768; // Search is in modal on mobile layout\r\nconst SEARCH_WITH_MAP_DEBOUNCE = 300; // Little bit of debounce before search is initiated.\r\n\r\n// Primary filters have their content in dropdown-popup.\r\n// With this offset we move the dropdown to the left a few pixels on desktop layout.\r\nconst FILTER_DROPDOWN_OFFSET = -14;\r\n\r\nconst validUrlQueryParamsFromProps = props => {\r\n  const { location, filterConfig } = props;\r\n  // eslint-disable-next-line no-unused-vars\r\n  const { mapSearch, page, ...searchInURL } = parse(location.search, {\r\n    latlng: ['origin'],\r\n    latlngBounds: ['bounds'],\r\n  });\r\n  // urlQueryParams doesn't contain page specific url params\r\n  // like mapSearch, page or origin (origin depends on config.sortSearchByDistance)\r\n  return validURLParamsForExtendedData(searchInURL, filterConfig);\r\n};\r\n\r\nconst cleanSearchFromConflictingParams = (searchParams, sortConfig, filterConfig) => {\r\n  // Single out filters that should disable SortBy when an active\r\n  // keyword search sorts the listings according to relevance.\r\n  // In those cases, sort parameter should be removed.\r\n  const sortingFiltersActive = isAnyFilterActive(\r\n    sortConfig.conflictingFilters,\r\n    searchParams,\r\n    filterConfig\r\n  );\r\n  return sortingFiltersActive\r\n    ? { ...searchParams, [sortConfig.queryParamName]: null }\r\n    : searchParams;\r\n};\r\n\r\nexport class SearchPageComponent extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      isSearchMapOpenOnMobile: props.tab === 'map',\r\n      isMobileModalOpen: false,\r\n      currentQueryParams: validUrlQueryParamsFromProps(props),\r\n      isSecondaryFiltersOpen: false,\r\n    };\r\n\r\n    this.searchMapListingsInProgress = false;\r\n\r\n    this.onMapMoveEnd = debounce(this.onMapMoveEnd.bind(this), SEARCH_WITH_MAP_DEBOUNCE);\r\n    this.onOpenMobileModal = this.onOpenMobileModal.bind(this);\r\n    this.onCloseMobileModal = this.onCloseMobileModal.bind(this);\r\n\r\n    // Filter functions\r\n    this.applyFilters = this.applyFilters.bind(this);\r\n    this.cancelFilters = this.cancelFilters.bind(this);\r\n    this.resetAll = this.resetAll.bind(this);\r\n    this.initialValues = this.initialValues.bind(this);\r\n    this.getHandleChangedValueFn = this.getHandleChangedValueFn.bind(this);\r\n\r\n    // SortBy\r\n    this.handleSortBy = this.handleSortBy.bind(this);\r\n  }\r\n\r\n  // Callback to determine if new search is needed\r\n  // when map is moved by user or viewport has changed\r\n  onMapMoveEnd(viewportBoundsChanged, data) {\r\n    const { viewportBounds, viewportCenter } = data;\r\n\r\n    const routes = routeConfiguration();\r\n    const searchPagePath = pathByRouteName('SearchPage', routes);\r\n    const currentPath =\r\n      typeof window !== 'undefined' && window.location && window.location.pathname;\r\n\r\n    // When using the ReusableMapContainer onMapMoveEnd can fire from other pages than SearchPage too\r\n    const isSearchPage = currentPath === searchPagePath;\r\n\r\n    // If mapSearch url param is given\r\n    // or original location search is rendered once,\r\n    // we start to react to \"mapmoveend\" events by generating new searches\r\n    // (i.e. 'moveend' event in Mapbox and 'bounds_changed' in Google Maps)\r\n    if (viewportBoundsChanged && isSearchPage) {\r\n      const { history, location, filterConfig } = this.props;\r\n\r\n      // parse query parameters, including a custom attribute named category\r\n      const { address, bounds, mapSearch, ...rest } = parse(location.search, {\r\n        latlng: ['origin'],\r\n        latlngBounds: ['bounds'],\r\n      });\r\n\r\n      //const viewportMapCenter = SearchMap.getMapCenter(map);\r\n      const originMaybe = isOriginInUse(config) ? { origin: viewportCenter } : {};\r\n\r\n      const searchParams = {\r\n        address,\r\n        ...originMaybe,\r\n        bounds: viewportBounds,\r\n        mapSearch: true,\r\n        ...validFilterParams(rest, filterConfig),\r\n      };\r\n\r\n      history.push(createResourceLocatorString('SearchPage', routes, {}, searchParams));\r\n    }\r\n  }\r\n\r\n  // Invoked when a modal is opened from a child component,\r\n  // for example when a filter modal is opened in mobile view\r\n  onOpenMobileModal() {\r\n    this.setState({ isMobileModalOpen: true });\r\n  }\r\n\r\n  // Invoked when a modal is closed from a child component,\r\n  // for example when a filter modal is opened in mobile view\r\n  onCloseMobileModal() {\r\n    this.setState({ isMobileModalOpen: false });\r\n  }\r\n\r\n  // Apply the filters by redirecting to SearchPage with new filters.\r\n  applyFilters() {\r\n    const { history, sortConfig, filterConfig } = this.props;\r\n    const urlQueryParams = validUrlQueryParamsFromProps(this.props);\r\n    const searchParams = { ...urlQueryParams, ...this.state.currentQueryParams };\r\n    const search = cleanSearchFromConflictingParams(searchParams, sortConfig, filterConfig);\r\n\r\n    history.push(createResourceLocatorString('SearchPage', routeConfiguration(), {}, search));\r\n  }\r\n\r\n  // Close the filters by clicking cancel, revert to the initial params\r\n  cancelFilters() {\r\n    this.setState({ currentQueryParams: {} });\r\n  }\r\n\r\n  // Reset all filter query parameters\r\n  resetAll(e) {\r\n    const { history, filterConfig } = this.props;\r\n    const urlQueryParams = validUrlQueryParamsFromProps(this.props);\r\n    const filterQueryParamNames = filterConfig.map(f => f.queryParamNames);\r\n\r\n    // Reset state\r\n    this.setState({ currentQueryParams: {} });\r\n\r\n    // Reset routing params\r\n    const queryParams = omit(urlQueryParams, filterQueryParamNames);\r\n    history.push(createResourceLocatorString('SearchPage', routeConfiguration(), {}, queryParams));\r\n  }\r\n\r\n  initialValues(queryParamNames, isLiveEdit) {\r\n    const urlQueryParams = validUrlQueryParamsFromProps(this.props);\r\n\r\n    // Query parameters that are in state (user might have not yet clicked \"Apply\")\r\n    const currentQueryParams = this.state.currentQueryParams;\r\n\r\n    // Get initial value for a given parameter from state if its there.\r\n    const getInitialValue = paramName => {\r\n      const currentQueryParam = currentQueryParams[paramName];\r\n      const hasQueryParamInState = typeof currentQueryParam !== 'undefined';\r\n      return hasQueryParamInState && !isLiveEdit ? currentQueryParam : urlQueryParams[paramName];\r\n    };\r\n\r\n    // Return all the initial values related to given queryParamNames\r\n    // InitialValues for \"amenities\" filter could be\r\n    // { amenities: \"has_any:towel,jacuzzi\" }\r\n    const isArray = Array.isArray(queryParamNames);\r\n    return isArray\r\n      ? queryParamNames.reduce((acc, paramName) => {\r\n          return { ...acc, [paramName]: getInitialValue(paramName) };\r\n        }, {})\r\n      : {};\r\n  }\r\n\r\n  getHandleChangedValueFn(useHistoryPush) {\r\n    const { history, sortConfig, filterConfig } = this.props;\r\n    const urlQueryParams = validUrlQueryParamsFromProps(this.props);\r\n\r\n    return updatedURLParams => {\r\n      const updater = prevState => {\r\n        const { address, bounds, keywords } = urlQueryParams;\r\n        const mergedQueryParams = { ...urlQueryParams, ...prevState.currentQueryParams };\r\n\r\n        // Address and bounds are handled outside of MainPanel.\r\n        // I.e. TopbarSearchForm && search by moving the map.\r\n        // We should always trust urlQueryParams with those.\r\n        // The same applies to keywords, if the main search type is keyword search.\r\n        const keywordsMaybe = isMainSearchTypeKeywords(config) ? { keywords } : {};\r\n        return {\r\n          currentQueryParams: {\r\n            ...mergedQueryParams,\r\n            ...updatedURLParams,\r\n            ...keywordsMaybe,\r\n            address,\r\n            bounds,\r\n          },\r\n        };\r\n      };\r\n\r\n      const callback = () => {\r\n        if (useHistoryPush) {\r\n          const searchParams = this.state.currentQueryParams;\r\n          const search = cleanSearchFromConflictingParams(searchParams, sortConfig, filterConfig);\r\n          history.push(createResourceLocatorString('SearchPage', routeConfiguration(), {}, search));\r\n        }\r\n      };\r\n\r\n      this.setState(updater, callback);\r\n    };\r\n  }\r\n\r\n  handleSortBy(urlParam, values) {\r\n    const { history } = this.props;\r\n    const urlQueryParams = validUrlQueryParamsFromProps(this.props);\r\n\r\n    const queryParams = values\r\n      ? { ...urlQueryParams, [urlParam]: values }\r\n      : omit(urlQueryParams, urlParam);\r\n\r\n    history.push(createResourceLocatorString('SearchPage', routeConfiguration(), {}, queryParams));\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      intl,\r\n      listings,\r\n      filterConfig,\r\n      sortConfig,\r\n      location,\r\n      mapListings,\r\n      onManageDisableScrolling,\r\n      pagination,\r\n      scrollingDisabled,\r\n      searchInProgress,\r\n      searchListingsError,\r\n      searchParams,\r\n      activeListingId,\r\n      onActivateListing,\r\n    } = this.props;\r\n    // eslint-disable-next-line no-unused-vars\r\n    const { mapSearch, page, ...searchInURL } = parse(location.search, {\r\n      latlng: ['origin'],\r\n      latlngBounds: ['bounds'],\r\n    });\r\n\r\n    // urlQueryParams doesn't contain page specific url params\r\n    // like mapSearch, page or origin (origin depends on config.sortSearchByDistance)\r\n    const urlQueryParams = pickSearchParamsOnly(searchInURL, filterConfig, sortConfig);\r\n\r\n    // Page transition might initially use values from previous search\r\n    const urlQueryString = stringify(urlQueryParams);\r\n    const paramsQueryString = stringify(\r\n      pickSearchParamsOnly(searchParams, filterConfig, sortConfig)\r\n    );\r\n    const searchParamsAreInSync = urlQueryString === paramsQueryString;\r\n\r\n    const validQueryParams = validURLParamsForExtendedData(searchInURL, filterConfig);\r\n\r\n    const isWindowDefined = typeof window !== 'undefined';\r\n    const isMobileLayout = isWindowDefined && window.innerWidth < MODAL_BREAKPOINT;\r\n    const shouldShowSearchMap =\r\n      !isMobileLayout || (isMobileLayout && this.state.isSearchMapOpenOnMobile);\r\n\r\n    const isKeywordSearch = isMainSearchTypeKeywords(config);\r\n    const availableFilters = isKeywordSearch\r\n      ? filterConfig.filter(f => f.type !== 'KeywordFilter')\r\n      : filterConfig;\r\n\r\n    const primaryFilters = availableFilters.filter(f => f.group === 'primary');\r\n    const secondaryFilters = availableFilters.filter(f => f.group !== 'primary');\r\n    const hasSecondaryFilters = !!(secondaryFilters && secondaryFilters.length > 0);\r\n\r\n    // Selected aka active filters\r\n    const selectedFilters = validFilterParams(validQueryParams, filterConfig);\r\n    const keysOfSelectedFilters = Object.keys(selectedFilters);\r\n    const selectedFiltersCountForMobile = isKeywordSearch\r\n      ? keysOfSelectedFilters.filter(f => f !== 'keywords').length\r\n      : keysOfSelectedFilters.length;\r\n\r\n    // Selected aka active secondary filters\r\n    const selectedSecondaryFilters = hasSecondaryFilters\r\n      ? validFilterParams(validQueryParams, secondaryFilters)\r\n      : {};\r\n    const selectedSecondaryFiltersCount = Object.keys(selectedSecondaryFilters).length;\r\n\r\n    const isSecondaryFiltersOpen = !!hasSecondaryFilters && this.state.isSecondaryFiltersOpen;\r\n    const propsForSecondaryFiltersToggle = hasSecondaryFilters\r\n      ? {\r\n          isSecondaryFiltersOpen: this.state.isSecondaryFiltersOpen,\r\n          toggleSecondaryFiltersOpen: isOpen => {\r\n            this.setState({ isSecondaryFiltersOpen: isOpen, currentQueryParams: {} });\r\n          },\r\n          selectedSecondaryFiltersCount,\r\n        }\r\n      : {};\r\n\r\n    const hasPaginationInfo = !!pagination && pagination.totalItems != null;\r\n    const totalItems = searchParamsAreInSync && hasPaginationInfo ? pagination.totalItems : 0;\r\n    const listingsAreLoaded = !searchInProgress && searchParamsAreInSync && hasPaginationInfo;\r\n\r\n    const sortBy = mode => {\r\n      const conflictingFilterActive = isAnyFilterActive(\r\n        sortConfig.conflictingFilters,\r\n        validQueryParams,\r\n        filterConfig\r\n      );\r\n\r\n      const mobileClassesMaybe =\r\n        mode === 'mobile'\r\n          ? {\r\n              rootClassName: css.sortBy,\r\n              menuLabelRootClassName: css.sortByMenuLabel,\r\n            }\r\n          : { className: css.sortByDesktop };\r\n      return sortConfig.active ? (\r\n        <SortBy\r\n          {...mobileClassesMaybe}\r\n          sort={validQueryParams[sortConfig.queryParamName]}\r\n          isConflictingFilterActive={!!conflictingFilterActive}\r\n          hasConflictingFilters={!!(sortConfig.conflictingFilters?.length > 0)}\r\n          selectedFilters={selectedFilters}\r\n          onSelect={this.handleSortBy}\r\n          showAsPopup\r\n          contentPlacementOffset={FILTER_DROPDOWN_OFFSET}\r\n        />\r\n      ) : null;\r\n    };\r\n\r\n    const onMapIconClick = () => {\r\n      this.useLocationSearchBounds = true;\r\n      this.setState({ isSearchMapOpenOnMobile: true });\r\n    };\r\n\r\n    const { bounds, origin } = searchInURL || {};\r\n    const { title, description, schema } = createSearchResultSchema(\r\n      listings,\r\n      searchInURL || {},\r\n      intl\r\n    );\r\n\r\n    const hasNoResult = listingsAreLoaded && totalItems === 0;\r\n    const hasSearchParams = location.search?.length > 0;\r\n    const noResultsInfo = hasNoResult ? (\r\n      <div className={css.noSearchResults}>\r\n        <FormattedMessage id=\"SearchPage.noResults\" />\r\n        <br />\r\n        {hasSearchParams ? (\r\n          <button className={css.resetAllFiltersButton} onClick={e => this.resetAll(e)}>\r\n            <FormattedMessage id={'SearchPage.resetAllFilters'} />\r\n          </button>\r\n        ) : null}\r\n      </div>\r\n    ) : null;\r\n\r\n    // Set topbar class based on if a modal is open in\r\n    // a child component\r\n    const topbarClasses = this.state.isMobileModalOpen\r\n      ? classNames(css.topbarBehindModal, css.topbar)\r\n      : css.topbar;\r\n\r\n    // N.B. openMobileMap button is sticky.\r\n    // For some reason, stickyness doesn't work on Safari, if the element is <button>\r\n    return (\r\n      <Page\r\n        scrollingDisabled={scrollingDisabled}\r\n        description={description}\r\n        title={title}\r\n        schema={schema}\r\n      >\r\n        <TopbarContainer\r\n          className={topbarClasses}\r\n          currentPage=\"SearchPage\"\r\n          currentSearchParams={urlQueryParams}\r\n        />\r\n        <div className={css.container}>\r\n          <div className={css.searchResultContainer}>\r\n            <SearchFiltersMobile\r\n              className={css.searchFiltersMobileMap}\r\n              urlQueryParams={validQueryParams}\r\n              sortByComponent={sortBy('mobile')}\r\n              listingsAreLoaded={listingsAreLoaded}\r\n              resultsCount={totalItems}\r\n              searchInProgress={searchInProgress}\r\n              searchListingsError={searchListingsError}\r\n              showAsModalMaxWidth={MODAL_BREAKPOINT}\r\n              onMapIconClick={onMapIconClick}\r\n              onManageDisableScrolling={onManageDisableScrolling}\r\n              onOpenModal={this.onOpenMobileModal}\r\n              onCloseModal={this.onCloseMobileModal}\r\n              resetAll={this.resetAll}\r\n              selectedFiltersCount={selectedFiltersCountForMobile}\r\n              noResultsInfo={noResultsInfo}\r\n              isMapVariant\r\n            >\r\n              {availableFilters.map(config => {\r\n                return (\r\n                  <FilterComponent\r\n                    key={`SearchFiltersMobile.${config.id}`}\r\n                    idPrefix=\"SearchFiltersMobile\"\r\n                    filterConfig={config}\r\n                    urlQueryParams={validQueryParams}\r\n                    initialValues={this.initialValues}\r\n                    getHandleChangedValueFn={this.getHandleChangedValueFn}\r\n                    liveEdit\r\n                    showAsPopup={false}\r\n                  />\r\n                );\r\n              })}\r\n            </SearchFiltersMobile>\r\n            <MainPanelHeader\r\n              className={css.mainPanelMapVariant}\r\n              sortByComponent={sortBy('desktop')}\r\n              listingsAreLoaded={listingsAreLoaded}\r\n              resultsCount={totalItems}\r\n              searchInProgress={searchInProgress}\r\n              searchListingsError={searchListingsError}\r\n              noResultsInfo={noResultsInfo}\r\n            >\r\n              <SearchFiltersPrimary {...propsForSecondaryFiltersToggle}>\r\n                {primaryFilters.map(config => {\r\n                  return (\r\n                    <FilterComponent\r\n                      key={`SearchFiltersPrimary.${config.id}`}\r\n                      idPrefix=\"SearchFiltersPrimary\"\r\n                      filterConfig={config}\r\n                      urlQueryParams={validQueryParams}\r\n                      initialValues={this.initialValues}\r\n                      getHandleChangedValueFn={this.getHandleChangedValueFn}\r\n                      showAsPopup\r\n                      contentPlacementOffset={FILTER_DROPDOWN_OFFSET}\r\n                    />\r\n                  );\r\n                })}\r\n              </SearchFiltersPrimary>\r\n            </MainPanelHeader>\r\n            {isSecondaryFiltersOpen ? (\r\n              <div className={classNames(css.searchFiltersPanel)}>\r\n                <SearchFiltersSecondary\r\n                  urlQueryParams={validQueryParams}\r\n                  listingsAreLoaded={listingsAreLoaded}\r\n                  applyFilters={this.applyFilters}\r\n                  cancelFilters={this.cancelFilters}\r\n                  resetAll={this.resetAll}\r\n                  onClosePanel={() => this.setState({ isSecondaryFiltersOpen: false })}\r\n                >\r\n                  {secondaryFilters.map(config => {\r\n                    return (\r\n                      <FilterComponent\r\n                        key={`SearchFiltersSecondary.${config.id}`}\r\n                        idPrefix=\"SearchFiltersSecondary\"\r\n                        filterConfig={config}\r\n                        urlQueryParams={validQueryParams}\r\n                        initialValues={this.initialValues}\r\n                        getHandleChangedValueFn={this.getHandleChangedValueFn}\r\n                        showAsPopup={false}\r\n                      />\r\n                    );\r\n                  })}\r\n                </SearchFiltersSecondary>\r\n              </div>\r\n            ) : (\r\n              <div\r\n                className={classNames(css.listingsForMapVariant, {\r\n                  [css.newSearchInProgress]: !listingsAreLoaded,\r\n                })}\r\n              >\r\n                {searchListingsError ? (\r\n                  <h2 className={css.error}>\r\n                    <FormattedMessage id=\"SearchPage.searchError\" />\r\n                  </h2>\r\n                ) : null}\r\n                <SearchResultsPanel\r\n                  className={css.searchListingsPanel}\r\n                  listings={listings}\r\n                  pagination={listingsAreLoaded ? pagination : null}\r\n                  search={parse(location.search)}\r\n                  setActiveListing={onActivateListing}\r\n                  isMapVariant\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n          <ModalInMobile\r\n            className={css.mapPanel}\r\n            id=\"SearchPage.map\"\r\n            isModalOpenOnMobile={this.state.isSearchMapOpenOnMobile}\r\n            onClose={() => this.setState({ isSearchMapOpenOnMobile: false })}\r\n            showAsModalMaxWidth={MODAL_BREAKPOINT}\r\n            onManageDisableScrolling={onManageDisableScrolling}\r\n          >\r\n            <div className={css.mapWrapper}>\r\n              {shouldShowSearchMap ? (\r\n                <SearchMap\r\n                  reusableContainerClassName={css.map}\r\n                  activeListingId={activeListingId}\r\n                  bounds={bounds}\r\n                  center={origin}\r\n                  isSearchMapOpenOnMobile={this.state.isSearchMapOpenOnMobile}\r\n                  location={location}\r\n                  listings={mapListings || []}\r\n                  onMapMoveEnd={this.onMapMoveEnd}\r\n                  onCloseAsModal={() => {\r\n                    onManageDisableScrolling('SearchPage.map', false);\r\n                  }}\r\n                  messages={intl.messages}\r\n                />\r\n              ) : null}\r\n            </div>\r\n          </ModalInMobile>\r\n        </div>\r\n      </Page>\r\n    );\r\n  }\r\n}\r\n\r\nSearchPageComponent.defaultProps = {\r\n  listings: [],\r\n  mapListings: [],\r\n  pagination: null,\r\n  searchListingsError: null,\r\n  searchParams: {},\r\n  tab: 'listings',\r\n  filterConfig: config.custom.filters,\r\n  sortConfig: config.custom.sortConfig,\r\n  activeListingId: null,\r\n};\r\n\r\nSearchPageComponent.propTypes = {\r\n  listings: array,\r\n  mapListings: array,\r\n  onActivateListing: func.isRequired,\r\n  onManageDisableScrolling: func.isRequired,\r\n  onSearchMapListings: func.isRequired,\r\n  pagination: propTypes.pagination,\r\n  scrollingDisabled: bool.isRequired,\r\n  searchInProgress: bool.isRequired,\r\n  searchListingsError: propTypes.error,\r\n  searchParams: object,\r\n  tab: oneOf(['filters', 'listings', 'map']).isRequired,\r\n  filterConfig: propTypes.filterConfig,\r\n  sortConfig: propTypes.sortConfig,\r\n\r\n  // from withRouter\r\n  history: shape({\r\n    push: func.isRequired,\r\n  }).isRequired,\r\n  location: shape({\r\n    search: string.isRequired,\r\n  }).isRequired,\r\n\r\n  // from injectIntl\r\n  intl: intlShape.isRequired,\r\n};\r\n\r\nconst mapStateToProps = state => {\r\n  const {\r\n    currentPageResultIds,\r\n    pagination,\r\n    searchInProgress,\r\n    searchListingsError,\r\n    searchParams,\r\n    searchMapListingIds,\r\n    activeListingId,\r\n  } = state.SearchPage;\r\n  const pageListings = getListingsById(state, currentPageResultIds);\r\n  const mapListings = getListingsById(\r\n    state,\r\n    unionWith(currentPageResultIds, searchMapListingIds, (id1, id2) => id1.uuid === id2.uuid)\r\n  );\r\n\r\n  return {\r\n    listings: pageListings,\r\n    mapListings,\r\n    pagination,\r\n    scrollingDisabled: isScrollingDisabled(state),\r\n    searchInProgress,\r\n    searchListingsError,\r\n    searchParams,\r\n    activeListingId,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n  onManageDisableScrolling: (componentId, disableScrolling) =>\r\n    dispatch(manageDisableScrolling(componentId, disableScrolling)),\r\n  onSearchMapListings: searchParams => dispatch(searchMapListings(searchParams)),\r\n  onActivateListing: listingId => dispatch(setActiveListing(listingId)),\r\n});\r\n\r\n// Note: it is important that the withRouter HOC is **outside** the\r\n// connect HOC, otherwise React Router won't rerender any Route\r\n// components since connect implements a shouldComponentUpdate\r\n// lifecycle hook.\r\n//\r\n// See: https://github.com/ReactTraining/react-router/issues/4671\r\nconst SearchPage = compose(\r\n  withRouter,\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  ),\r\n  injectIntl\r\n)(SearchPageComponent);\r\n\r\nexport default SearchPage;\r\n"]},"metadata":{},"sourceType":"module"}